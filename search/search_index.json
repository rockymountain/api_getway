{"config":{"lang":["vi"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\ud83d\udc4b Ch\u00e0o m\u1eebng \u0111\u1ebfn v\u1edbi T\u00e0i li\u1ec7u API Gateway \u2013 D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS","text":"<p>D\u1ef1 \u00e1n API Gateway \u2013 DX VAS l\u00e0 th\u00e0nh ph\u1ea7n trung t\u00e2m trong n\u1ec1n t\u1ea3ng chuy\u1ec3n \u0111\u1ed5i s\u1ed1 c\u1ee7a h\u1ec7 th\u1ed1ng VAS, \u0111\u00f3ng vai tr\u00f2 l\u00e0m c\u1ea7u n\u1ed1i an to\u00e0n, nh\u1ea5t qu\u00e1n gi\u1eefa frontend, backend v\u00e0 c\u00e1c d\u1ecbch v\u1ee5 b\u00ean ngo\u00e0i.</p> <p>\ud83d\udcda \u0110\u00e2y l\u00e0 c\u1ed5ng t\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt ch\u00ednh th\u1ee9c d\u00e0nh cho:</p> <ul> <li>Developer backend, frontend ho\u1eb7c mobile</li> <li>DevOps, SRE v\u00e0 QA</li> <li>Ng\u01b0\u1eddi m\u1edbi tham gia d\u1ef1 \u00e1n (onboarding)</li> <li>Ki\u1ec3m tra v\u00e0 b\u1ea3o tr\u00ec h\u1ea1 t\u1ea7ng</li> </ul>"},{"location":"#noi-dung-chinh","title":"\ud83d\udcd6 N\u1ed9i dung ch\u00ednh","text":"M\u1ee5c M\u00f4 t\u1ea3 \ud83d\ude80 H\u01b0\u1edbng d\u1eabn Dev T\u00e0i li\u1ec7u \"From 0 to Hero\" \u0111\u1ec3 l\u1eadp tr\u00ecnh vi\u00ean tri\u1ec3n khai v\u00e0 hi\u1ec3u to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng \ud83e\udd1d Quy tr\u00ecnh l\u00e0m vi\u1ec7c Quy \u01b0\u1edbc code, review, PR, branch, naming \ud83e\udde0 Ki\u1ebfn tr\u00fac h\u1ec7 th\u1ed1ng &amp; ADRs C\u00e1c quy\u1ebft \u0111\u1ecbnh ki\u1ebfn tr\u00fac \u0111\u01b0\u1ee3c ghi l\u1ea1i ch\u00ednh th\u1ee9c \ud83d\udcda API Reference Tham chi\u1ebfu c\u00e1c endpoint c\u1ee7a API Gateway \ud83d\udc65 Onboarding &amp; Offboarding Checklist cho ng\u01b0\u1eddi m\u1edbi v\u00e0 khi r\u1eddi team"},{"location":"#ve-kien-truc-tong-the","title":"\ud83e\udde0 V\u1ec1 ki\u1ebfn tr\u00fac t\u1ed5ng th\u1ec3","text":"<ul> <li>API Gateway s\u1eed d\u1ee5ng FastAPI v\u00e0 tri\u1ec3n khai qua Google Cloud Run</li> <li>Qu\u1ea3n l\u00fd h\u1ea1 t\u1ea7ng v\u1edbi Terraform</li> <li>CI/CD s\u1eed d\u1ee5ng GitHub Actions</li> <li>Logging, metrics, v\u00e0 tracing theo chu\u1ea9n Observability 3 Pillars</li> <li>Security theo h\u01b0\u1edbng Zero Trust + RBAC + Secret Rotation</li> </ul> <p>\ud83d\udccc C\u00e1c quy\u1ebft \u0111\u1ecbnh ki\u1ebfn tr\u00fac \u0111\u01b0\u1ee3c ghi l\u1ea1i d\u01b0\u1edbi d\u1ea1ng ADR (Architecture Decision Records)</p>"},{"location":"#ong-gop","title":"\ud83d\udcc8 \u0110\u00f3ng g\u00f3p","text":"<p>B\u1ea1n mu\u1ed1n c\u1ea3i thi\u1ec7n t\u00e0i li\u1ec7u n\u00e0y? H\u00e3y xem h\u01b0\u1edbng d\u1eabn \u0111\u00f3ng g\u00f3p ho\u1eb7c t\u1ea1o Pull Request.</p> <p>\u201cCode t\u1ed1t l\u00e0 khi team hi\u1ec3u \u0111\u01b0\u1ee3c, t\u00e0i li\u1ec7u t\u1ed1t l\u00e0 khi ng\u01b0\u1eddi m\u1edbi kh\u00f4ng ph\u1ea3i h\u1ecfi l\u1ea1i.\u201d</p>"},{"location":"API_REFERENCE/","title":"\ud83d\udcd8 API Reference \u2013 API Gateway (DX VAS)","text":"<p>T\u00e0i li\u1ec7u n\u00e0y cung c\u1ea5p c\u00e1i nh\u00ecn t\u1ed5ng quan v\u1ec1 c\u00e1c endpoint ch\u00ednh trong h\u1ec7 th\u1ed1ng API Gateway c\u1ee7a d\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS.</p> <p>\ud83d\udca1 T\u00e0i li\u1ec7u n\u00e0y \u0111\u01b0\u1ee3c t\u1ed5ng h\u1ee3p th\u1ee7 c\u00f4ng t\u1eeb c\u00e1c route ch\u00ednh. V\u1edbi c\u00e1c th\u00f4ng tin chi ti\u1ebft nh\u01b0 schema \u0111\u1ea7u v\u00e0o/\u0111\u1ea7u ra, vui l\u00f2ng tham kh\u1ea3o Swagger UI t\u1ea1i <code>/docs</code> ho\u1eb7c ReDoc t\u1ea1i <code>/redoc</code>.</p>"},{"location":"API_REFERENCE/#chuan-rest-headers-chung","title":"\u2705 Chu\u1ea9n REST &amp; Headers chung","text":"<ul> <li>Prefix version: <code>/api/v1/</code></li> <li> <p>Headers b\u1eaft bu\u1ed9c:</p> </li> <li> <p><code>Authorization: Bearer &lt;access_token&gt;</code></p> </li> <li> <p>Forward \u0111\u1ebfn backend s\u1ebd c\u00f3 th\u00eam:</p> <ul> <li><code>X-User-Id</code></li> <li><code>X-Role</code></li> <li><code>X-Permissions</code></li> <li>Response chu\u1ea9n h\u00f3a:</li> </ul> </li> </ul> <pre><code>{\n  \"data\": {...},\n  \"message\": \"Success\",\n  \"status_code\": 200\n}\n</code></pre> <ul> <li> <p>M\u00e3 l\u1ed7i ph\u1ed5 bi\u1ebfn:</p> </li> <li> <p><code>401 Unauthorized</code> \u2013 Thi\u1ebfu ho\u1eb7c sai token</p> </li> <li><code>403 Forbidden</code> \u2013 Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp</li> <li><code>429 Too Many Requests</code> \u2013 V\u01b0\u1ee3t gi\u1edbi h\u1ea1n</li> <li><code>502 Bad Gateway</code> \u2013 L\u1ed7i t\u1eeb backend</li> </ul>"},{"location":"API_REFERENCE/#auth-oauth2-token","title":"\ud83d\udd10 Auth (OAuth2, Token)","text":""},{"location":"API_REFERENCE/#post-authlogin","title":"<code>POST /auth/login</code>","text":"<ul> <li>M\u00f4 t\u1ea3: \u0110\u0103ng nh\u1eadp b\u1eb1ng Google OAuth2, tr\u1ea3 v\u1ec1 token v\u00e0 th\u00f4ng tin user</li> <li>\u0110\u1ea7u v\u00e0o:</li> </ul> <pre><code>{\n  \"code\": \"google_oauth_code\"\n}\n</code></pre> <ul> <li>\u0110\u1ea7u ra (v\u00ed d\u1ee5):</li> </ul> <pre><code>{\n  \"data\": {\n    \"access_token\": \"jwt\",\n    \"refresh_token\": \"string\",\n    \"token_type\": \"bearer\",\n    \"user_info\": {\n      \"id\": \"string\",\n      \"email\": \"string\",\n      \"name\": \"string\"\n    }\n  },\n  \"message\": \"Login successful\",\n  \"status_code\": 200\n}\n</code></pre>"},{"location":"API_REFERENCE/#post-authrefresh","title":"<code>POST /auth/refresh</code>","text":"<ul> <li>M\u00f4 t\u1ea3: C\u1ea5p l\u1ea1i Access Token t\u1eeb Refresh Token</li> <li>\u0110\u1ea7u v\u00e0o:</li> </ul> <pre><code>{\n  \"refresh_token\": \"string\"\n}\n</code></pre>"},{"location":"API_REFERENCE/#get-authme","title":"<code>GET /auth/me</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng hi\u1ec7n t\u1ea1i d\u1ef1a tr\u00ean token \u0111\u00e3 \u0111\u0103ng nh\u1eadp</li> </ul>"},{"location":"API_REFERENCE/#rbac-role-permission","title":"\ud83d\udc64 RBAC \u2013 Role &amp; Permission","text":""},{"location":"API_REFERENCE/#get-rbacroles","title":"<code>GET /rbac/roles</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch role \u0111ang c\u00f3 trong h\u1ec7 th\u1ed1ng</li> </ul>"},{"location":"API_REFERENCE/#post-rbacroles","title":"<code>POST /rbac/roles</code>","text":"<ul> <li>M\u00f4 t\u1ea3: T\u1ea1o role m\u1edbi</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>MANAGE_RBAC</code></li> </ul>"},{"location":"API_REFERENCE/#get-rbacpermissions","title":"<code>GET /rbac/permissions</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch permission hi\u1ec7n t\u1ea1i (code + m\u00f4 t\u1ea3)</li> </ul>"},{"location":"API_REFERENCE/#post-rbacassign","title":"<code>POST /rbac/assign</code>","text":"<ul> <li>M\u00f4 t\u1ea3: G\u00e1n role cho user</li> <li>\u0110\u1ea7u v\u00e0o:</li> </ul> <pre><code>{\n  \"user_id\": \"string\",\n  \"role_id\": \"string\"\n}\n</code></pre>"},{"location":"API_REFERENCE/#post-rbacroute-map","title":"<code>POST /rbac/route-map</code>","text":"<ul> <li>M\u00f4 t\u1ea3: G\u00e1n permission c\u1ee5 th\u1ec3 cho endpoint (method + path)</li> </ul> <p>\ud83d\udd0e Xem m\u00f4 t\u1ea3 c\u00e1c permission t\u1ea1i <code>DEV_GUIDE.md</code></p>"},{"location":"API_REFERENCE/#sis-proxy-en-opensis","title":"\ud83c\udf93 SIS (Proxy \u0111\u1ebfn OpenSIS)","text":""},{"location":"API_REFERENCE/#get-sisstudents","title":"<code>GET /sis/students</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch h\u1ecdc sinh</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>VIEW_STUDENT</code></li> <li> <p>Query params:</p> </li> <li> <p><code>page</code>, <code>limit</code>, <code>search</code></p> </li> </ul>"},{"location":"API_REFERENCE/#get-sisstudentsid","title":"<code>GET /sis/students/{id}</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Xem chi ti\u1ebft m\u1ed9t h\u1ecdc sinh</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>VIEW_STUDENT</code></li> </ul>"},{"location":"API_REFERENCE/#put-sisstudentsid","title":"<code>PUT /sis/students/{id}</code>","text":"<ul> <li>M\u00f4 t\u1ea3: C\u1eadp nh\u1eadt th\u00f4ng tin h\u1ecdc sinh</li> <li>Y\u00eau c\u1ea7u quy\u1ec1n: <code>EDIT_STUDENT</code></li> </ul>"},{"location":"API_REFERENCE/#notify","title":"\ud83d\udcde Notify","text":""},{"location":"API_REFERENCE/#post-notifysend","title":"<code>POST /notify/send</code>","text":"<ul> <li>M\u00f4 t\u1ea3: G\u1eedi th\u00f4ng b\u00e1o \u0111\u1ebfn user qua Web, Zalo ho\u1eb7c Email</li> <li>\u0110\u1ea7u v\u00e0o v\u00ed d\u1ee5:</li> </ul> <pre><code>{\n  \"user_id\": \"abc123\",\n  \"channel\": \"email\",\n  \"message\": \"B\u1ea1n c\u00f3 th\u00f4ng b\u00e1o m\u1edbi.\"\n}\n</code></pre>"},{"location":"API_REFERENCE/#crm-proxy-en-espocrm-neu-ap-dung","title":"\ud83e\uddd1\u200d\ud83d\udcbc CRM (Proxy \u0111\u1ebfn EspoCRM \u2013 n\u1ebfu \u00e1p d\u1ee5ng)","text":""},{"location":"API_REFERENCE/#get-crmleads","title":"<code>GET /crm/leads</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch ph\u1ee5 huynh ti\u1ec1m n\u0103ng</li> </ul>"},{"location":"API_REFERENCE/#post-crmleads","title":"<code>POST /crm/leads</code>","text":"<ul> <li>M\u00f4 t\u1ea3: Th\u00eam m\u1edbi th\u00f4ng tin \u0111\u0103ng k\u00fd nh\u1eadp h\u1ecdc</li> </ul>"},{"location":"API_REFERENCE/#lms-proxy-en-moodle-neu-a-tich-hop","title":"\ud83e\uddd1\u200d\ud83c\udfeb LMS (Proxy \u0111\u1ebfn Moodle \u2013 n\u1ebfu \u0111\u00e3 t\u00edch h\u1ee3p)","text":""},{"location":"API_REFERENCE/#get-lmscourses","title":"<code>GET /lms/courses</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y danh s\u00e1ch kho\u00e1 h\u1ecdc t\u1eeb LMS</li> </ul>"},{"location":"API_REFERENCE/#get-lmsstudentsidgrades","title":"<code>GET /lms/students/{id}/grades</code>","text":"<ul> <li>M\u00f4 t\u1ea3: L\u1ea5y \u0111i\u1ec3m h\u1ecdc t\u1eadp c\u1ee7a h\u1ecdc sinh t\u1eeb Moodle</li> </ul>"},{"location":"API_REFERENCE/#tai-nguyen-lien-quan","title":"\ud83d\udd17 T\u00e0i nguy\u00ean li\u00ean quan","text":"<ul> <li>Swagger UI: <code>/docs</code></li> <li>ReDoc UI: <code>/redoc</code></li> <li>Quy \u01b0\u1edbc coding: <code>CONTRIBUTING.md</code></li> <li>Dev Guide: <code>DEV_GUIDE.md</code></li> </ul> <p>T\u00e0i li\u1ec7u n\u00e0y l\u00e0 b\u1ea3n m\u00f4 t\u1ea3 th\u1ee7 c\u00f4ng (version: <code>v1</code>). \u0110\u1ec3 c\u1eadp nh\u1eadt \u0111\u1ea7y \u0111\u1ee7 nh\u1ea5t, h\u00e3y tham kh\u1ea3o Swagger UI.</p>"},{"location":"CONTRIBUTING/","title":"\ud83e\udd1d H\u01b0\u1edbng d\u1eabn \u0110\u00f3ng g\u00f3p \u2013 API Gateway (DX VAS)","text":"<p>C\u1ea3m \u01a1n b\u1ea1n \u0111\u00e3 quan t\u00e2m v\u00e0 mu\u1ed1n \u0111\u00f3ng g\u00f3p v\u00e0o d\u1ef1 \u00e1n API Gateway \u2013 Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS! D\u01b0\u1edbi \u0111\u00e2y l\u00e0 h\u01b0\u1edbng d\u1eabn gi\u00fap b\u1ea1n tham gia hi\u1ec7u qu\u1ea3, \u0111\u1ea3m b\u1ea3o ti\u00eau chu\u1ea9n ch\u1ea5t l\u01b0\u1ee3ng v\u00e0 s\u1ef1 nh\u1ea5t qu\u00e1n trong quy tr\u00ecnh ph\u00e1t tri\u1ec3n.</p>"},{"location":"CONTRIBUTING/#muc-tieu","title":"\ud83d\udccc M\u1ee5c ti\u00eau","text":"<ul> <li>Duy tr\u00ec ch\u1ea5t l\u01b0\u1ee3ng code cao, s\u1ea1ch v\u00e0 c\u00f3 ki\u1ec3m th\u1eed.</li> <li>\u0110\u1ea3m b\u1ea3o m\u1ecdi thay \u0111\u1ed5i \u0111\u1ec1u \u0111\u01b0\u1ee3c review, ghi nh\u1eadn v\u00e0 rollback \u0111\u01b0\u1ee3c.</li> <li>Khuy\u1ebfn kh\u00edch \u0111\u00f3ng g\u00f3p t\u1eeb n\u1ed9i b\u1ed9 v\u00e0 c\u1ed9ng \u0111\u1ed3ng m\u1edf r\u1ed9ng (n\u1ebfu applicable).</li> </ul>"},{"location":"CONTRIBUTING/#cau-truc-nhanh-branch-strategy","title":"\ud83e\uddf1 C\u1ea5u tr\u00fac nh\u00e1nh (Branch Strategy)","text":"M\u1ee5c \u0111\u00edch Nh\u00e1nh Production <code>main</code> Staging / t\u00edch h\u1ee3p <code>dev</code> T\u00ednh n\u0103ng m\u1edbi <code>feature/&lt;ten-tinh-nang&gt;</code> Hotfix <code>hotfix/&lt;ten-loi&gt;</code>"},{"location":"CONTRIBUTING/#quy-trinh-ong-gop","title":"\u2699\ufe0f Quy tr\u00ecnh \u0111\u00f3ng g\u00f3p","text":"<ol> <li>T\u1ea1o nh\u00e1nh m\u1edbi t\u1eeb <code>dev</code>:</li> </ol> <pre><code>git checkout dev\ngit pull origin dev\ngit checkout -b feature/ten-tinh-nang\n</code></pre> <ol> <li>Commit theo chu\u1ea9n Conventional Commit:</li> </ol> <pre><code>git commit -m \"feat(auth): th\u00eam x\u00e1c th\u1ef1c OAuth2 cho gi\u00e1o vi\u00ean\"\n</code></pre> <ol> <li>Rebase tr\u01b0\u1edbc khi t\u1ea1o Pull Request:</li> </ol> <pre><code>git fetch origin\ngit rebase origin/dev\n# N\u1ebfu nh\u00e1nh feature \u0111\u00e3 push t\u1eeb tr\u01b0\u1edbc:\ngit push --force-with-lease\n</code></pre> <ol> <li> <p>Push v\u00e0 t\u1ea1o Pull Request v\u1ec1 <code>dev</code>. PR n\u00ean nh\u1ecf, t\u1eadp trung m\u1ed9t ch\u1ee9c n\u0103ng, d\u1ec5 review.</p> </li> <li> <p>Ch\u1edd review t\u1ed1i thi\u1ec3u 1 th\u00e0nh vi\u00ean (\u01b0u ti\u00ean senior dev ho\u1eb7c tech lead v\u1edbi module ph\u1ee9c t\u1ea1p).</p> </li> <li> <p>Resolve conflict (n\u1ebfu c\u00f3) v\u00e0 c\u1eadp nh\u1eadt l\u1ea1i PR.</p> </li> <li> <p>Squash &amp; Merge n\u1ebfu \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn.</p> </li> </ol>"},{"location":"CONTRIBUTING/#checklist-truoc-khi-tao-pr","title":"\u2705 Checklist tr\u01b0\u1edbc khi t\u1ea1o PR","text":"<ul> <li> \u0110\u00e3 vi\u1ebft test (unit/integration n\u1ebfu applicable)?</li> <li> \u0110\u00e3 ch\u1ea1y <code>pre-commit</code> v\u00e0 pass lint?</li> <li> T\u00e0i li\u1ec7u (docstring, README n\u1ebfu c\u1ea7n) \u0111\u00e3 c\u1eadp nh\u1eadt?</li> <li> \u0110\u00e3 ch\u1ea1y <code>docker-compose up</code> v\u00e0 verify ho\u1ea1t \u0111\u1ed9ng local?</li> <li> PR nh\u1ecf, g\u1ecdn, t\u1eadp trung 1 m\u1ee5c ti\u00eau?</li> </ul>"},{"location":"CONTRIBUTING/#coding-convention","title":"\u270d\ufe0f Coding Convention","text":"<ul> <li>Tu\u00e2n theo PEP8</li> <li>S\u1eed d\u1ee5ng type hinting \u0111\u1ea7y \u0111\u1ee7</li> <li>Vi\u1ebft docstring theo Google Style Guide</li> <li>Xem th\u00eam chi ti\u1ebft t\u1ea1i <code>docs/DEV_GUIDE.md</code></li> <li>S\u1eed d\u1ee5ng custom exception theo t\u1eebng domain n\u1ebfu c\u00f3 logic nghi\u1ec7p v\u1ee5</li> </ul>"},{"location":"CONTRIBUTING/#testing-ci","title":"\ud83e\uddea Testing &amp; CI","text":"<ul> <li>Unit test d\u00f9ng <code>pytest</code></li> <li>T\u1ed1i thi\u1ec3u 1 test cho m\u1ed7i logic quan tr\u1ecdng ho\u1eb7c edge case</li> <li>Coverage m\u1ee5c ti\u00eau \u2265 80%</li> <li> <p>CI pipeline t\u1ef1 \u0111\u1ed9ng ch\u1ea1y:</p> </li> <li> <p><code>black</code>, <code>flake8</code>, <code>isort</code></p> </li> <li><code>pytest</code></li> <li><code>bandit</code>, <code>safety</code>, <code>trivy</code></li> </ul>"},{"location":"CONTRIBUTING/#quy-trinh-xu-ly-issuebug","title":"\ud83d\udc1e Quy tr\u00ecnh x\u1eed l\u00fd Issue/Bug","text":"<ul> <li>B\u00e1o c\u00e1o l\u1ed7i qua GitHub Issues ho\u1eb7c Slack n\u1ed9i b\u1ed9</li> <li>G\u00e1n label <code>bug</code>, <code>enhancement</code>, <code>help wanted</code>, v.v.</li> <li>Ch\u1ec9 nh\u1eadn x\u1eed l\u00fd issue khi \u0111\u00e3 assign b\u1ea3n th\u00e2n v\u00e0 th\u00f4ng b\u00e1o v\u1edbi team</li> <li>C\u00e1c issue nghi\u00eam tr\u1ecdng n\u00ean \u0111\u01b0\u1ee3c ghi r\u00f5 reproduction steps, log, \u1ea3nh screenshot n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"CONTRIBUTING/#review-code","title":"\ud83d\udd0d Review code","text":"<ul> <li>T\u1ed1i thi\u1ec3u 1 reviewer ph\u1ea3i approve tr\u01b0\u1edbc khi merge</li> <li>Reviewer n\u00ean l\u00e0 senior dev ho\u1eb7c module owner cho c\u00e1c thay \u0111\u1ed5i l\u1edbn</li> <li>Review c\u1ea7n di\u1ec5n ra trong v\u00f2ng 48 gi\u1edd</li> <li>G\u00f3p \u00fd n\u00ean c\u1ee5 th\u1ec3, t\u00edch c\u1ef1c v\u00e0 r\u00f5 r\u00e0ng</li> <li>Tranh lu\u1eadn k\u1ef9 thu\u1eadt n\u00ean \u0111\u01b0\u1ee3c trao \u0111\u1ed5i trong GitHub comment ho\u1eb7c Slack; escalate n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"CONTRIBUTING/#giao-tiep-phan-hoi","title":"\ud83d\udcac Giao ti\u1ebfp &amp; Ph\u1ea3n h\u1ed3i","text":"<ul> <li>S\u1eed d\u1ee5ng Slack, GitHub Discussion ho\u1eb7c Issue tracker</li> <li>T\u00f4n tr\u1ecdng th\u1eddi gian c\u1ee7a nhau, tr\u00e1nh push commit cu\u1ed1i ng\u00e0y r\u1ed3i y\u00eau c\u1ea7u review g\u1ea5p</li> <li> <p>Reviewer c\u00f3 th\u1ec3 t\u1eeb ch\u1ed1i PR n\u1ebfu:</p> </li> <li> <p>Kh\u00f4ng \u0111\u1ee7 test</p> </li> <li>Kh\u00f4ng \u0111\u00fang convention</li> <li>G\u00e2y \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn module kh\u00e1c m\u00e0 kh\u00f4ng c\u00f3 ph\u1ed1i h\u1ee3p</li> </ul>"},{"location":"CONTRIBUTING/#license-quyen-so-huu","title":"\ud83d\udcc4 License &amp; Quy\u1ec1n s\u1edf h\u1eefu","text":"<p>M\u1ecdi \u0111\u00f3ng g\u00f3p \u0111\u01b0\u1ee3c xem l\u00e0 thu\u1ed9c v\u1ec1 t\u1ed5 ch\u1ee9c Tr\u01b0\u1eddng Vi\u1ec7t Anh \u2013 D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS. Vi\u1ec7c \u0111\u00f3ng g\u00f3p \u0111\u1ed3ng ngh\u0129a v\u1edbi vi\u1ec7c b\u1ea1n \u0111\u1ed3ng thu\u1eadn v\u1edbi c\u00e1c \u0111i\u1ec1u kho\u1ea3n n\u1ed9i b\u1ed9 \u0111\u00e3 \u0111\u01b0\u1ee3c th\u1ed1ng nh\u1ea5t.</p> <p>\u201cM\u1ed7i d\u00f2ng code b\u1ea1n vi\u1ebft h\u00f4m nay l\u00e0 n\u1ec1n t\u1ea3ng cho m\u1ed9t ng\u00f4i tr\u01b0\u1eddng s\u1ed1 th\u00f4ng minh ng\u00e0y mai.\u201d</p> <p>Ch\u00fang t\u00f4i r\u1ea5t mong \u0111\u1ee3i s\u1ef1 \u0111\u00f3ng g\u00f3p c\u1ee7a b\u1ea1n! \u2764\ufe0f</p>"},{"location":"DEV_GUIDE/","title":"\ud83d\ude80 H\u01b0\u1edbng d\u1eabn Dev","text":"<p>T\u00e0i li\u1ec7u Dev Guide \u2013 T\u1eeb 0 \u0111\u1ebfn Hero \u2013 D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</p>"},{"location":"DEV_GUIDE/#i-muc-tieu-cua-tai-lieu","title":"I. M\u1ee5c ti\u00eau c\u1ee7a t\u00e0i li\u1ec7u","text":"<p>H\u01b0\u1edbng d\u1eabn chi ti\u1ebft d\u00e0nh cho developer m\u1edbi b\u1eaft \u0111\u1ea7u tham gia v\u00e0o h\u1ec7 th\u1ed1ng DX VAS, bao g\u1ed3m quy tr\u00ecnh thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng, coding convention, l\u00e0m vi\u1ec7c nh\u00f3m, testing, CI/CD, b\u1ea3o m\u1eadt v\u00e0 v\u1eadn h\u00e0nh. T\u00e0i li\u1ec7u n\u00e0y gi\u00fap \u0111\u1ea3m b\u1ea3o m\u1ecdi th\u00e0nh vi\u00ean \u0111\u1ec1u c\u00f3 th\u1ec3 l\u00e0m vi\u1ec7c hi\u1ec7u qu\u1ea3 v\u00e0 th\u1ed1ng nh\u1ea5t.</p>"},{"location":"DEV_GUIDE/#ii-thiet-lap-moi-truong-phat-trien","title":"II. Thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng ph\u00e1t tri\u1ec3n","text":""},{"location":"DEV_GUIDE/#1-cong-cu-can-cai-at","title":"1. C\u00f4ng c\u1ee5 c\u1ea7n c\u00e0i \u0111\u1eb7t","text":"<ul> <li>Python &gt;= 3.10</li> <li>Docker &amp; Docker Compose</li> <li>Git</li> <li>PostgreSQL client (psql ho\u1eb7c DBeaver)</li> <li>Redis client (redis-cli ho\u1eb7c TablePlus)</li> <li>VSCode ho\u1eb7c PyCharm</li> </ul>"},{"location":"DEV_GUIDE/#2-clone-du-an-va-cau-hinh-ban-au","title":"2. Clone d\u1ef1 \u00e1n v\u00e0 c\u1ea5u h\u00ecnh ban \u0111\u1ea7u","text":"<pre><code>git clone https://github.com/rockymountain/api-gateway.git\ncd api-gateway\ncp .env.example .env\n</code></pre>"},{"location":"DEV_GUIDE/#pre-commit-hooks-legendary-touch","title":"Pre-commit hooks (Legendary Touch)","text":"<pre><code>pip install pre-commit\npre-commit install\n</code></pre> <p>File <code>.pre-commit-config.yaml</code> n\u00ean bao g\u1ed3m:</p> <pre><code>repos:\n  - repo: https://github.com/psf/black\n    rev: stable\n    hooks:\n      - id: black\n  - repo: https://github.com/pycqa/flake8\n    rev: 6.0.0\n    hooks:\n      - id: flake8\n  - repo: https://github.com/PyCQA/isort\n    rev: 5.12.0\n    hooks:\n      - id: isort\n</code></pre>"},{"location":"DEV_GUIDE/#3-tuy-chon-tao-moi-truong-ao-neu-khong-dung-docker","title":"3. (T\u00f9y ch\u1ecdn) T\u1ea1o m\u00f4i tr\u01b0\u1eddng \u1ea3o n\u1ebfu kh\u00f4ng d\u00f9ng Docker","text":"<pre><code>python -m venv venv\nsource venv/bin/activate  # Tr\u00ean Windows: .\\venv\\Scripts\\activate\npip install -r requirements.txt\n</code></pre> <p>N\u1ebfu c\u00f3 file ri\u00eang <code>requirements-dev.txt</code>:</p> <pre><code>pip install -r requirements-dev.txt\n</code></pre>"},{"location":"DEV_GUIDE/#4-chay-du-an-local-bang-docker-compose","title":"4. Ch\u1ea1y d\u1ef1 \u00e1n local b\u1eb1ng Docker Compose","text":"<pre><code>docker-compose up --build\n</code></pre> <p>Truy c\u1eadp FastAPI docs t\u1ea1i <code>http://localhost:8000/docs</code></p>"},{"location":"DEV_GUIDE/#5-prestartsh-legendary-touch","title":"5. prestart.sh (Legendary Touch)","text":"<p>File <code>prestart.sh</code>:</p> <pre><code>#!/bin/bash\n# ./wait-for-postgres.sh $DB_HOST $DB_PORT --timeout=30\nalembic upgrade head\nexec uvicorn app.main:app --host 0.0.0.0 --port 8080\n</code></pre> <p>N\u00ean \u0111\u01b0\u1ee3c g\u1ecdi t\u1eeb Dockerfile nh\u01b0 sau:</p> <pre><code>CMD [\"/bin/bash\", \"prestart.sh\"]\n</code></pre>"},{"location":"DEV_GUIDE/#iii-cau-truc-du-an-backend","title":"III. C\u1ea5u tr\u00fac d\u1ef1 \u00e1n (Backend)","text":"<pre><code>auth/\nrbac/\nnotify/\nutils/\n  \u251c\u2500\u2500 db.py\n  \u251c\u2500\u2500 cache.py\n  \u251c\u2500\u2500 exceptions.py\n  \u251c\u2500\u2500 logging.py\n  \u2514\u2500\u2500 security.py\nmigrations/\n  \u251c\u2500\u2500 versions/\n  \u251c\u2500\u2500 env.py\n  \u2514\u2500\u2500 script.py.mako\nmain.py\nconfig.py\nprestart.sh\nalembic.ini\nrequirements.in\nrequirements.txt\nrequirements-dev.txt\nDockerfile\ndocker-compose.yml\n.pre-commit-config.yaml\n.gitignore\nREADME.md\n</code></pre>"},{"location":"DEV_GUIDE/#iv-coding-convention-quy-trinh-lam-viec","title":"IV. Coding Convention &amp; Quy tr\u00ecnh l\u00e0m vi\u1ec7c","text":"<p>D\u1ef1a tr\u00ean <code>docs/CONTRIBUTING.md</code>, m\u1ecdi l\u1eadp tr\u00ecnh vi\u00ean n\u00ean tu\u00e2n theo c\u00e1c nguy\u00ean t\u1eafc sau:</p> <ul> <li> <p>Code style:</p> </li> <li> <p>Tu\u00e2n theo PEP8</p> </li> <li>D\u00f9ng <code>black</code> \u0111\u1ec3 format code, <code>flake8</code> \u0111\u1ec3 lint, <code>isort</code> \u0111\u1ec3 s\u1eafp x\u1ebfp import</li> <li>S\u1eed d\u1ee5ng type hinting \u0111\u1ea7y \u0111\u1ee7 cho m\u1ecdi h\u00e0m v\u00e0 class</li> <li> <p>Vi\u1ebft docstring theo Google Style Guide</p> </li> <li> <p>Quy \u01b0\u1edbc \u0111\u1eb7t t\u00ean:</p> </li> <li> <p>T\u00ean file, bi\u1ebfn, h\u00e0m: <code>snake_case</code></p> </li> <li>T\u00ean class: <code>PascalCase</code></li> <li> <p>Commit message: tu\u00e2n theo chu\u1ea9n Conventional Commits</p> </li> <li> <p>Workflow:</p> </li> <li> <p>T\u1ea1o branch t\u1eeb <code>dev</code>: <code>feature/&lt;ten-tinh-nang&gt;</code> ho\u1eb7c <code>hotfix/&lt;ten-loi&gt;</code></p> </li> <li>Rebase tr\u01b0\u1edbc khi t\u1ea1o PR n\u1ebfu branch \u0111\u00e3 t\u1ed3n t\u1ea1i</li> <li>Pull Request c\u1ea7n \u00edt nh\u1ea5t 1 reviewer v\u00e0 n\u00ean nh\u1ecf g\u1ecdn, r\u00f5 m\u1ee5c ti\u00eau</li> <li>Review c\u1ea7n ph\u1ea3n h\u1ed3i trong v\u00f2ng 48h</li> </ul>"},{"location":"DEV_GUIDE/#v-testing-strategy","title":"V. Testing Strategy","text":"<p>Theo ADR-019 (Contract Testing Strategy), chi\u1ebfn l\u01b0\u1ee3c test bao g\u1ed3m:</p> <ul> <li> <p>Unit Test: d\u00f9ng <code>pytest</code></p> </li> <li> <p>M\u1ed7i service/module ph\u1ea3i c\u00f3 test ri\u00eang trong <code>tests/</code></p> </li> <li> <p>Vi\u1ebft test cho edge case &amp; logic ph\u1ee9c t\u1ea1p</p> </li> <li> <p>Integration Test:</p> </li> <li> <p>Test c\u00e1c t\u01b0\u01a1ng t\u00e1c v\u1edbi DB, Redis ho\u1eb7c gi\u1eefa module</p> </li> <li> <p>C\u00f3 th\u1ec3 d\u00f9ng fixture v\u00e0 test DB ri\u00eang (docker ho\u1eb7c memory)</p> </li> <li> <p>Contract Test: (n\u1ebfu applicable)</p> </li> <li> <p>S\u1eed d\u1ee5ng Pact \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o giao ti\u1ebfp gi\u1eefa c\u00e1c microservice kh\u00f4ng b\u1ecb ph\u00e1 v\u1ee1</p> </li> <li> <p>Coverage:</p> </li> <li> <p>M\u1ee5c ti\u00eau \u2265 80%</p> </li> <li>D\u00f9ng <code>pytest-cov</code> \u0111\u1ec3 \u0111o v\u00e0 xem b\u00e1o c\u00e1o coverage</li> </ul> <pre><code>pytest --cov=app tests/\n</code></pre> <ul> <li>CI: m\u1ecdi commit/PR s\u1ebd \u0111\u01b0\u1ee3c CI ki\u1ec3m tra t\u1ef1 \u0111\u1ed9ng <code>lint + test</code></li> </ul>"},{"location":"DEV_GUIDE/#vi-cicd-continuous-integration-deployment","title":"VI. CI/CD (Continuous Integration &amp; Deployment)","text":"<p>T\u00f3m t\u1eaft t\u1eeb ADR-003 (CICD Structure), ADR-010 (Deployment Strategy), v\u00e0 ADR-021 (Zero Downtime Deployment):</p> <ul> <li> <p>CI Pipeline: GitHub Actions s\u1ebd t\u1ef1 \u0111\u1ed9ng:</p> </li> <li> <p>Ki\u1ec3m tra code format: <code>black</code>, <code>flake8</code>, <code>isort</code></p> </li> <li>Ch\u1ea1y test v\u00e0 \u0111o coverage b\u1eb1ng <code>pytest</code></li> <li> <p>Scan b\u1ea3o m\u1eadt: <code>bandit</code>, <code>safety</code>, <code>trivy</code></p> </li> <li> <p>CD Pipeline:</p> </li> <li> <p>T\u1ef1 \u0111\u1ed9ng build Docker image v\u00e0 deploy l\u00ean Cloud Run cho m\u00f4i tr\u01b0\u1eddng staging</p> </li> <li>M\u00f4i tr\u01b0\u1eddng production y\u00eau c\u1ea7u manual approval tr\u01b0\u1edbc khi deploy</li> <li> <p>Tri\u1ec3n khai canary ho\u1eb7c blue-green \u0111\u01b0\u1ee3c h\u1ed7 tr\u1ee3 (xem ADR-010 &amp; ADR-021)</p> </li> <li> <p>H\u1ea1 t\u1ea7ng:</p> </li> <li> <p>Qu\u1ea3n l\u00fd b\u1eb1ng Terraform (xem m\u1ee5c VII b\u00ean d\u01b0\u1edbi v\u00e0 ADR-023)</p> </li> <li> <p>M\u1ecdi thay \u0111\u1ed5i Terraform s\u1ebd ch\u1ea1y <code>terraform plan</code> v\u00e0 y\u00eau c\u1ea7u review tr\u01b0\u1edbc khi apply</p> </li> <li> <p>Secrets:</p> </li> <li> <p>CI s\u1eed d\u1ee5ng GitHub Secrets</p> </li> <li>\u1ee8ng d\u1ee5ng \u0111\u1ecdc secrets t\u1eeb GCP Secret Manager</li> </ul>"},{"location":"DEV_GUIDE/#vii-quan-ly-ha-tang-bang-terraform-iac","title":"VII. Qu\u1ea3n l\u00fd H\u1ea1 t\u1ea7ng b\u1eb1ng Terraform (IaC)","text":"<p>D\u1ef1 \u00e1n s\u1eed d\u1ee5ng Terraform \u0111\u1ec3 qu\u1ea3n l\u00fd to\u00e0n b\u1ed9 h\u1ea1 t\u1ea7ng tri\u1ec3n khai tr\u00ean Google Cloud Platform (GCP) nh\u1eb1m \u0111\u1ea3m b\u1ea3o:</p> <ul> <li>C\u00f3 th\u1ec3 theo d\u00f5i v\u00e0 review h\u1ea1 t\u1ea7ng nh\u01b0 m\u00e3 ngu\u1ed3n</li> <li>T\u00e1i s\u1eed d\u1ee5ng \u0111\u01b0\u1ee3c qua modules, t\u00e1ch ri\u00eang c\u00e1c m\u00f4i tr\u01b0\u1eddng</li> <li>Tri\u1ec3n khai an to\u00e0n, c\u00f3 ki\u1ec3m so\u00e1t v\u00e0 rollback \u0111\u01b0\u1ee3c n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"DEV_GUIDE/#1-cau-truc-thu-muc-terraform","title":"1. C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c Terraform","text":"<p>H\u1ea1 t\u1ea7ng \u0111\u01b0\u1ee3c \u0111\u1eb7t trong th\u01b0 m\u1ee5c <code>infra/terraform/</code>, chia l\u00e0m 2 ph\u1ea7n:</p> <ul> <li><code>modules/</code>: t\u1eadp trung c\u00e1c t\u00e0i nguy\u00ean c\u00f3 th\u1ec3 t\u00e1i s\u1eed d\u1ee5ng (Cloud Run, Cloud SQL, Redis, IAM\u2026)</li> <li><code>envs/staging/</code> v\u00e0 <code>envs/production/</code>: khai b\u00e1o ri\u00eang cho t\u1eebng m\u00f4i tr\u01b0\u1eddng</li> </ul> <p>Chi ti\u1ebft \u0111\u01b0\u1ee3c m\u00f4 t\u1ea3 t\u1ea1i ADR-023 (Infrastructure as Code Terraform Strategy)</p>"},{"location":"DEV_GUIDE/#2-huong-dan-cho-developer","title":"2. H\u01b0\u1edbng d\u1eabn cho Developer","text":"<ul> <li>C\u00e0i Terraform: T\u1ea3i t\u1ea1i \u0111\u00e2y \u2013 Phi\u00ean b\u1ea3n \u2265 1.5</li> <li>Ch\u1ea1y Terraform local (n\u1ebfu \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n):</li> </ul> <pre><code>cd infra/terraform/envs/staging\nterraform init\nterraform plan -var-file=\"staging.tfvars\"\n</code></pre> <p>\u26a0\ufe0f Kh\u00f4ng ch\u1ea1y <code>terraform apply</code> n\u1ebfu ch\u01b0a c\u00f3 s\u1ef1 \u0111\u1ed3ng thu\u1eadn t\u1eeb DevOps</p> <ul> <li> <p>Thay \u0111\u1ed5i h\u1ea1 t\u1ea7ng:</p> </li> <li> <p>T\u1ea1o Pull Request v\u1edbi thay \u0111\u1ed5i trong <code>infra/terraform/</code></p> </li> <li>\u0110\u01b0\u1ee3c review b\u1edfi DevOps tr\u01b0\u1edbc khi merge v\u00e0o <code>dev</code> ho\u1eb7c <code>main</code></li> <li>CI/CD s\u1ebd t\u1ef1 \u0111\u1ed9ng ch\u1ea1y <code>terraform plan</code>; production y\u00eau c\u1ea7u approval tr\u01b0\u1edbc khi apply</li> </ul>"},{"location":"DEV_GUIDE/#3-quan-ly-state-va-secrets","title":"3. Qu\u1ea3n l\u00fd state v\u00e0 secrets","text":"<ul> <li>Terraform state \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef v\u00e0 kh\u00f3a tr\u1ea1ng th\u00e1i t\u1ef1 \u0111\u1ed9ng trong Google Cloud Storage (GCS)</li> <li> <p>Secrets KH\u00d4NG \u0111\u01b0\u1ee3c commit v\u00e0o <code>.tf</code> hay <code>.tfvars</code> \u2013 thay v\u00e0o \u0111\u00f3:</p> </li> <li> <p>\u0110\u01b0\u1ee3c inject qua CI (<code>TF_VAR_xyz</code>)</p> </li> <li>Ho\u1eb7c \u0111\u1ecdc t\u1eeb Google Secrets Manager th\u00f4ng qua Terraform provider</li> </ul> <p>IaC l\u00e0 m\u1ed9t ph\u1ea7n kh\u00f4ng th\u1ec3 thi\u1ebfu trong quy tr\u00ecnh DevOps hi\u1ec7n \u0111\u1ea1i \u2013 gi\u00fap h\u1ea1 t\u1ea7ng \u0111\u01b0\u1ee3c ki\u1ec3m so\u00e1t, d\u1ec5 tri\u1ec3n khai v\u00e0 ph\u1ee5c h\u1ed3i.</p>"},{"location":"DEV_GUIDE/#viii-api-design-governance","title":"VIII. API Design &amp; Governance","text":"<p>D\u1ef1a tr\u00ean ADR-004 (API Versioning), ADR-018 (OpenAPI Governance), ADR-020 (API Lifecycle Deprecation), v\u00e0 ADR-007 (Error Handling):</p>"},{"location":"DEV_GUIDE/#1-thiet-ke-api","title":"1. Thi\u1ebft k\u1ebf API","text":"<ul> <li>RESTful theo chu\u1ea9n HTTP verbs (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>)</li> <li>Endpoint \u0111\u1eb7t t\u00ean r\u00f5 ngh\u0129a, d\u1ea1ng s\u1ed1 nhi\u1ec1u: <code>/students</code>, <code>/roles</code></li> <li>Kh\u00f4ng d\u00f9ng \u0111\u1ed9ng t\u1eeb trong endpoint (\u0111\u00e3 c\u00f3 trong HTTP verb)</li> </ul>"},{"location":"DEV_GUIDE/#2-phien-ban-hoa-api","title":"2. Phi\u00ean b\u1ea3n h\u00f3a API","text":"<ul> <li>D\u00f9ng prefix <code>/api/v1/...</code> \u0111\u1ec3 version r\u00f5 r\u00e0ng (ADR-004)</li> <li>Kh\u00f4ng breaking changes trong c\u00f9ng 1 version</li> </ul>"},{"location":"DEV_GUIDE/#3-openapi-tu-ong-hoa-tai-lieu","title":"3. OpenAPI &amp; T\u1ef1 \u0111\u1ed9ng h\u00f3a t\u00e0i li\u1ec7u","text":"<ul> <li>T\u00e0i li\u1ec7u endpoint sinh t\u1ef1 \u0111\u1ed9ng t\u1eeb FastAPI (<code>/docs</code>, <code>/redoc</code>)</li> <li>Pydantic model m\u00f4 t\u1ea3 schema r\u00f5 r\u00e0ng</li> <li>M\u1ed7i route n\u00ean c\u00f3 docstring \u0111\u1ec3 hi\u1ec3n th\u1ecb trong Swagger</li> </ul>"},{"location":"DEV_GUIDE/#4-quan-ly-vong-oi-api","title":"4. Qu\u1ea3n l\u00fd v\u00f2ng \u0111\u1eddi API","text":"<ul> <li>T\u00e0i li\u1ec7u m\u1ed7i endpoint n\u00ean ghi r\u00f5: stable, beta, deprecated</li> <li>Deprecate c\u1ea7n th\u00f4ng b\u00e1o s\u1edbm v\u00e0 c\u00f3 deadline lo\u1ea1i b\u1ecf (ADR-020)</li> </ul>"},{"location":"DEV_GUIDE/#5-xu-ly-loi-chuan-hoa","title":"5. X\u1eed l\u00fd l\u1ed7i chu\u1ea9n h\u00f3a","text":"<p>M\u1ecdi l\u1ed7i API ph\u1ea3i tr\u1ea3 v\u1ec1 theo c\u1ea5u tr\u00fac chu\u1ea9n theo ADR-007 (Error Handling):</p> <pre><code>{\n  \"error_code\": 403,\n  \"message\": \"Permission denied\",\n  \"details\": \"Permission 'EDIT_STUDENT' is required\",\n  \"request_id\": \"abc-123\",\n  \"timestamp\": \"2025-05-21T08:30:00Z\"\n}\n</code></pre> <ul> <li><code>error_code</code>: m\u00e3 HTTP status (400, 403, 404, 500...)</li> <li><code>message</code>: th\u00f4ng b\u00e1o ng\u1eafn g\u1ecdn cho client</li> <li><code>details</code>: m\u00f4 t\u1ea3 r\u00f5 h\u01a1n (optional)</li> <li><code>request_id</code>: ID duy nh\u1ea5t gi\u00fap debug truy v\u1ebft l\u1ed7i</li> <li><code>timestamp</code>: th\u1eddi \u0111i\u1ec3m x\u1ea3y ra l\u1ed7i (UTC ISO format)</li> </ul> <p>\ud83d\udcd8 Thi\u1ebft k\u1ebf API t\u1ed1t l\u00e0 n\u1ec1n t\u1ea3ng cho frontend, t\u00edch h\u1ee3p h\u1ec7 th\u1ed1ng v\u00e0 m\u1edf r\u1ed9ng trong t\u01b0\u01a1ng lai.</p>"},{"location":"DEV_GUIDE/#ix-resilience-caching-performance","title":"IX. Resilience, Caching &amp; Performance","text":"<p>D\u1ef1a tr\u00ean ADR-016 (Resilience Fallback Strategy) v\u00e0 ADR-017 (Caching Strategy):</p>"},{"location":"DEV_GUIDE/#1-timeout-retry","title":"1. Timeout &amp; Retry","text":"<ul> <li>Thi\u1ebft l\u1eadp timeout r\u00f5 r\u00e0ng cho m\u1ecdi external call</li> <li>D\u00f9ng retry v\u1edbi backoff cho c\u00e1c request idempotent (nh\u01b0 GET)</li> <li>T\u0103ng \u0111\u1ed9 \u1ed5n \u0111\u1ecbnh h\u1ec7 th\u1ed1ng khi backend t\u1ea1m th\u1eddi l\u1ed7i ho\u1eb7c ch\u1eadm</li> </ul>"},{"location":"DEV_GUIDE/#2-circuit-breaker-tuy-chon-nang-cao","title":"2. Circuit Breaker (Tu\u1ef3 ch\u1ecdn n\u00e2ng cao)","text":"<ul> <li>C\u00f3 th\u1ec3 d\u00f9ng th\u01b0 vi\u1ec7n <code>tenacity</code> ho\u1eb7c custom logic khi c\u1ea7n c\u00e1ch ly l\u1ed7i</li> <li>N\u1ebfu 1 backend li\u00ean t\u1ee5c l\u1ed7i, t\u1ea1m th\u1eddi d\u1eebng g\u1eedi request trong 1 kho\u1ea3ng th\u1eddi gian</li> </ul>"},{"location":"DEV_GUIDE/#3-caching","title":"3. Caching","text":"<ul> <li>D\u1eef li\u1ec7u \u00edt thay \u0111\u1ed5i n\u00ean cache t\u1ea1i API Gateway ho\u1eb7c Redis</li> <li> <p>Caching ph\u00e2n t\u1ea7ng:</p> </li> <li> <p>In-memory (tu\u1ed5i th\u1ecd ng\u1eafn, d\u00f9ng cho response t\u1ea1m th\u1eddi)</p> </li> <li>Redis (chia s\u1ebb gi\u1eefa instances)</li> <li>Cache key n\u00ean bao g\u1ed3m \u0111\u1ea7y \u0111\u1ee7 c\u00e1c param \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn n\u1ed9i dung</li> </ul>"},{"location":"DEV_GUIDE/#4-toi-uu-hoa-truy-van","title":"4. T\u1ed1i \u01b0u ho\u00e1 truy v\u1ea5n","text":"<ul> <li>Tr\u00e1nh N+1 query v\u1edbi SQLAlchemy b\u1eb1ng c\u00e1ch d\u00f9ng <code>selectinload</code>, <code>joinedload</code></li> <li>Gi\u1edbi h\u1ea1n size d\u1eef li\u1ec7u tr\u1ea3 v\u1ec1 b\u1eb1ng <code>limit</code>, <code>offset</code>, <code>pagination</code></li> </ul> <p>\u26a1 T\u1ed1i \u01b0u hi\u1ec7u n\u0103ng &amp; \u0111\u1ed9 \u1ed5n \u0111\u1ecbnh l\u00e0 y\u1ebfu t\u1ed1 s\u1ed1ng c\u00f2n khi h\u1ec7 th\u1ed1ng ph\u00e1t tri\u1ec3n quy m\u00f4 l\u1edbn</p>"},{"location":"DEV_GUIDE/#x-multi-environment-configuration","title":"X. Multi-Environment Configuration","text":"<p>D\u1ef1a tr\u00ean ADR-014 (Multi-Environment Config):</p>"},{"location":"DEV_GUIDE/#1-env-va-bien-moi-truong","title":"1. .env v\u00e0 bi\u1ebfn m\u00f4i tr\u01b0\u1eddng","text":"<ul> <li>M\u1ed7i m\u00f4i tr\u01b0\u1eddng (<code>local</code>, <code>staging</code>, <code>production</code>) c\u00f3 file <code>.env</code> ri\u00eang</li> <li>C\u1ea5u h\u00ecnh nh\u01b0 DB_URL, REDIS_URL, JWT_SECRET \u0111\u01b0\u1ee3c \u0111\u1ecbnh ngh\u0129a d\u01b0\u1edbi d\u1ea1ng bi\u1ebfn m\u00f4i tr\u01b0\u1eddng</li> </ul>"},{"location":"DEV_GUIDE/#2-load-cau-hinh-ong-trong-code","title":"2. Load c\u1ea5u h\u00ecnh \u0111\u1ed9ng trong code","text":"<ul> <li>S\u1eed d\u1ee5ng th\u01b0 vi\u1ec7n nh\u01b0 <code>pydantic-settings</code> ho\u1eb7c custom config loader</li> <li>Ph\u00e2n bi\u1ec7t r\u00f5 c\u00e1c c\u1ea5u h\u00ecnh <code>dev</code>, <code>prod</code>, <code>test</code> trong <code>config.py</code></li> </ul>"},{"location":"DEV_GUIDE/#3-terraform-tach-rieng-theo-env","title":"3. Terraform t\u00e1ch ri\u00eang theo env","text":"<ul> <li><code>infra/terraform/envs/staging/</code>, <code>envs/production/</code> ch\u1ee9a config ri\u00eang bi\u1ec7t</li> <li>M\u1ed7i m\u00f4i tr\u01b0\u1eddng c\u00f3 state file ri\u00eang (tr\u00e1nh \u0111\u00e8 nhau)</li> </ul> <p>\ud83e\udded \u0110a m\u00f4i tr\u01b0\u1eddng gi\u00fap \u0111\u1ea3m b\u1ea3o CI/CD linh ho\u1ea1t, rollback d\u1ec5 d\u00e0ng, v\u00e0 t\u00e1ch bi\u1ec7t r\u1ee7i ro r\u00f5 r\u00e0ng</p>"},{"location":"DEV_GUIDE/#xi-database-migrations-alembic","title":"XI. Database Migrations &amp; Alembic","text":""},{"location":"DEV_GUIDE/#1-alembic","title":"1. Alembic","text":"<ul> <li>D\u00f9ng \u0111\u1ec3 qu\u1ea3n l\u00fd schema migration cho PostgreSQL</li> <li>C\u1ea5u h\u00ecnh trong <code>alembic.ini</code>, logic trong <code>migrations/</code></li> </ul>"},{"location":"DEV_GUIDE/#2-tao-va-ap-dung-migration","title":"2. T\u1ea1o v\u00e0 \u00e1p d\u1ee5ng migration","text":"<pre><code>alembic revision --autogenerate -m \"Add table xyz\"\nalembic upgrade head\n</code></pre> <ul> <li>M\u1ed7i PR n\u00ean \u0111i k\u00e8m migration n\u1ebfu c\u00f3 thay \u0111\u1ed5i DB schema</li> </ul>"},{"location":"DEV_GUIDE/#3-khong-downtime","title":"3. Kh\u00f4ng downtime","text":"<ul> <li>Lu\u00f4n ki\u1ec3m tra k\u1ef9 migration \u0111\u1ec3 tr\u00e1nh <code>DROP</code>, <code>ALTER</code> g\u00e2y lock table</li> <li>N\u1ebfu thay \u0111\u1ed5i l\u1edbn, n\u00ean chia nh\u1ecf th\u00e0nh c\u00e1c b\u01b0\u1edbc an to\u00e0n (xem ADR-021)</li> </ul> <p>\ud83d\uddc3\ufe0f Migrations an to\u00e0n l\u00e0 \u0111i\u1ec1u ki\u1ec7n b\u1eaft bu\u1ed9c cho deploy t\u1ef1 \u0111\u1ed9ng trong m\u00f4i tr\u01b0\u1eddng production**</p>"},{"location":"DEV_GUIDE/#xii-observability-logging-metrics-tracing-audit-cost","title":"XII. Observability (Logging, Metrics, Tracing, Audit, Cost)","text":"<p>D\u1ef1a tr\u00ean ADR-005 (Observability Strategy), ADR-012 (Audit Logging), ADR-022 (3rd-Party Observability), v\u00e0 ADR-015 (Cost Observability):</p>"},{"location":"DEV_GUIDE/#1-logging","title":"1. Logging","text":"<ul> <li>S\u1eed d\u1ee5ng structured logging v\u1edbi <code>python-json-logger</code></li> <li>Logs c\u1ea7n c\u00f3: <code>request_id</code>, <code>user_id</code>, <code>path</code>, <code>status_code</code></li> <li>G\u1eedi logs l\u00ean Cloud Logging v\u1edbi ph\u00e2n lo\u1ea1i r\u00f5 r\u00e0ng (<code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>)</li> </ul>"},{"location":"DEV_GUIDE/#2-metrics","title":"2. Metrics","text":"<ul> <li>Thu th\u1eadp qua OpenTelemetry SDK \u2192 GCP Monitoring</li> <li>Theo d\u00f5i: latency, error rate, s\u1ed1 l\u01b0\u1ee3ng request theo endpoint/module</li> </ul>"},{"location":"DEV_GUIDE/#3-distributed-tracing","title":"3. Distributed Tracing","text":"<ul> <li>Header: <code>X-Request-ID</code>, <code>traceparent</code>,... truy\u1ec1n gi\u1eefa c\u00e1c service</li> <li>S\u1eed d\u1ee5ng GCP Trace ho\u1eb7c Jaeger n\u1ebfu c\u1ea7n</li> </ul>"},{"location":"DEV_GUIDE/#4-audit-logging","title":"4. Audit Logging","text":"<ul> <li>Ghi log cho thao t\u00e1c nh\u1ea1y c\u1ea3m: login, ph\u00e2n quy\u1ec1n, c\u1eadp nh\u1eadt d\u1eef li\u1ec7u</li> <li>Tr\u01b0\u1eddng b\u1eaft bu\u1ed9c: <code>actor_id</code>, <code>action</code>, <code>target_id</code>, <code>timestamp</code>, <code>ip_address</code></li> <li>L\u01b0u ri\u00eang, kh\u00f4ng b\u1ecb x\u00f3a ho\u1eb7c s\u1eeda</li> </ul>"},{"location":"DEV_GUIDE/#5-cost-observability","title":"5. Cost Observability","text":"<ul> <li>G\u1eafn label cho m\u1ecdi resource t\u1ea1o ra: <code>project</code>, <code>team</code>, <code>env</code></li> <li>Theo d\u00f5i chi ph\u00ed theo team/module qua Billing Dashboard</li> </ul> <p>\ud83d\udd0d Observability kh\u00f4ng ch\u1ec9 l\u00e0 thu th\u1eadp \u2013 m\u00e0 l\u00e0 kh\u1ea3 n\u0103ng hi\u1ec3u \u0111i\u1ec1u g\u00ec \u0111ang x\u1ea3y ra \u0111\u1ec3 ph\u1ea3n \u1ee9ng \u0111\u00fang l\u00fac.</p>"},{"location":"DEV_GUIDE/#xiii-security-best-practices","title":"XIII. Security Best Practices","text":"<p>D\u1ef1a tr\u00ean ADR-009 (Security Hardening), ADR-011 (Secrets Rotation), v\u00e0 c\u00e1c chi\u1ebfn l\u01b0\u1ee3c t\u1ed5ng h\u1ee3p:</p>"},{"location":"DEV_GUIDE/#1-transport-token-security","title":"1. Transport &amp; Token Security","text":"<ul> <li>Ch\u1ec9 d\u00f9ng HTTPS (Cloud Run m\u1eb7c \u0111\u1ecbnh)</li> <li>JWT: TTL ng\u1eafn, d\u00f9ng Authorization: Bearer , l\u01b0u \u1edf memory"},{"location":"DEV_GUIDE/#2-input-validation","title":"2. Input Validation","text":"<ul> <li>Validate k\u1ef9 m\u1ecdi \u0111\u1ea7u v\u00e0o b\u1eb1ng Pydantic</li> <li>T\u1eeb ch\u1ed1i request qu\u00e1 l\u1edbn, sai Content-Type</li> </ul>"},{"location":"DEV_GUIDE/#3-http-headers","title":"3. HTTP Headers","text":"<ul> <li>Th\u00eam HSTS, X-Frame-Options, CSP, Referrer-Policy</li> </ul>"},{"location":"DEV_GUIDE/#4-rate-limiting","title":"4. Rate Limiting","text":"<ul> <li>S\u1eed d\u1ee5ng Redis ho\u1eb7c GCP Cloud Armor</li> <li>ADR-008 (Rate-Limiting) m\u00f4 t\u1ea3 r\u00f5</li> </ul>"},{"location":"DEV_GUIDE/#5-dependency-image-scanning","title":"5. Dependency &amp; Image Scanning","text":"<ul> <li>S\u1eed d\u1ee5ng safety, bandit trong CI</li> <li>Scan Docker image v\u1edbi trivy</li> </ul>"},{"location":"DEV_GUIDE/#6-secrets-management","title":"6. Secrets Management","text":"<ul> <li>Tuy\u1ec7t \u0111\u1ed1i kh\u00f4ng l\u01b0u secrets trong Git</li> <li>S\u1eed d\u1ee5ng GCP Secret Manager + Terraform \u0111\u1ec3 inject</li> <li>Thay secret \u0111\u1ecbnh k\u1ef3 (rotation theo ADR-011)</li> </ul> <p>\ud83d\udee1\ufe0f B\u1ea3o m\u1eadt kh\u00f4ng ph\u1ea3i l\u00e0 t\u00ednh n\u0103ng \u2013 m\u00e0 l\u00e0 y\u00eau c\u1ea7u n\u1ec1n t\u1ea3ng. M\u1ed7i d\u00f2ng code c\u1ea7n \u0111\u01b0\u1ee3c vi\u1ebft v\u1edbi t\u01b0 duy b\u1ea3o v\u1ec7 ng\u01b0\u1eddi d\u00f9ng v\u00e0 d\u1eef li\u1ec7u.</p> <p>\ud83d\udcd8 T\u00e0i li\u1ec7u n\u00e0y c\u1ea7n \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt li\u00ean t\u1ee5c khi c\u00e1c ADR ho\u1eb7c h\u1ec7 th\u1ed1ng thay \u0111\u1ed5i. H\u00e3y \u0111\u1ea3m b\u1ea3o b\u1ea1n theo d\u00f5i repo \u0111\u1ec3 n\u1eafm c\u00e1c c\u1eadp nh\u1eadt m\u1edbi nh\u1ea5t!</p>"},{"location":"OFFBOARDING/","title":"\ud83d\udd1a OFFBOARDING Checklist \u2013 API Gateway (DX VAS)","text":"<p>C\u1ea3m \u01a1n b\u1ea1n v\u00ec \u0111\u00e3 \u0111\u1ed3ng h\u00e0nh c\u00f9ng d\u1ef1 \u00e1n API Gateway \u2013 Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS! \ud83c\udf89</p> <p>T\u00e0i li\u1ec7u n\u00e0y gi\u00fap \u0111\u1ea3m b\u1ea3o vi\u1ec7c b\u00e0n giao, thu h\u1ed3i quy\u1ec1n truy c\u1eadp, v\u00e0 l\u01b0u gi\u1eef tri th\u1ee9c \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n minh b\u1ea1ch, \u0111\u1ea7y \u0111\u1ee7 khi m\u1ed9t th\u00e0nh vi\u00ean r\u1eddi team (t\u1ea1m th\u1eddi ho\u1eb7c v\u0129nh vi\u1ec5n).</p>"},{"location":"OFFBOARDING/#checklist-khi-offboarding","title":"\u2705 Checklist khi offboarding","text":""},{"location":"OFFBOARDING/#1-thu-hoi-quyen-truy-cap","title":"1. Thu h\u1ed3i quy\u1ec1n truy c\u1eadp","text":"<ul> <li> X\u00f3a kh\u1ecfi GitHub organization ho\u1eb7c repo (<code>vas-org/api-gateway</code>)</li> <li> Thu h\u1ed3i quy\u1ec1n truy c\u1eadp Google Cloud IAM (Console, Cloud SQL, Artifact Registry)</li> <li> G\u1ee1 kh\u1ecfi Slack, Notion ho\u1eb7c t\u00e0i kho\u1ea3n qu\u1ea3n tr\u1ecb n\u1ed9i b\u1ed9 kh\u00e1c</li> <li> G\u1ee1 quy\u1ec1n kh\u1ecfi c\u00e1c d\u1ecbch v\u1ee5 CI/CD (GitHub Secrets, Deployment Keys, v.v.)</li> </ul>"},{"location":"OFFBOARDING/#2-ban-giao-code-va-cong-viec-ang-do","title":"2. B\u00e0n giao code v\u00e0 c\u00f4ng vi\u1ec7c \u0111ang d\u1edf","text":"<ul> <li> <p> To\u00e0n b\u1ed9 nh\u00e1nh <code>feature/*</code> ch\u01b0a merge \u0111\u00e3 \u0111\u01b0\u1ee3c:</p> </li> <li> <p> T\u1ea1o Pull Request (n\u1ebfu \u0111\u1ee7 \u0111i\u1ec1u ki\u1ec7n)</p> </li> <li> G\u00e1n reviewer/assignee thay th\u1ebf</li> <li> Ghi ch\u00fa l\u1ea1i TODO r\u00f5 r\u00e0ng n\u1ebfu ch\u01b0a xong</li> <li> B\u00e0n giao issue \u0111\u00e3 assign trong GitHub Project</li> <li> N\u1ebfu c\u00f3 test/manual data/script local, c\u1ea7n push ho\u1eb7c backup</li> </ul>"},{"location":"OFFBOARDING/#3-ban-giao-tri-thuc-tai-lieu-hoa","title":"3. B\u00e0n giao tri th\u1ee9c &amp; t\u00e0i li\u1ec7u h\u00f3a","text":"<ul> <li> <p> C\u1eadp nh\u1eadt c\u00e1c ph\u1ea7n m\u00ecnh ph\u1ee5 tr\u00e1ch trong:</p> </li> <li> <p> <code>DEV_GUIDE.md</code></p> </li> <li> <code>CONTRIBUTING.md</code> (n\u1ebfu c\u00f3 \u1ea3nh h\u01b0\u1edfng)</li> <li> C\u00e1c file <code>README.md</code> ho\u1eb7c <code>docs/*</code> c\u1ee7a module</li> <li> N\u1ebfu c\u00f3 ki\u1ebfn th\u1ee9c ri\u00eang (c\u00e1ch setup debug, trick v\u1edbi 1 service...), ghi l\u1ea1i trong <code>docs/OFFBOARDING_notes/&lt;t\u00ean&gt;.md</code></li> </ul>"},{"location":"OFFBOARDING/#4-anh-gia-loi-chao","title":"4. \u0110\u00e1nh gi\u00e1 &amp; l\u1eddi ch\u00e0o","text":"<ul> <li> G\u1eedi l\u1eddi c\u1ea3m \u01a1n qua Slack ho\u1eb7c email n\u1ed9i b\u1ed9</li> <li> <p> Ho\u00e0n th\u00e0nh quick retro:</p> </li> <li> <p> Nh\u1eefng g\u00ec b\u1ea1n th\u1ea5y hi\u1ec7u qu\u1ea3</p> </li> <li> \u0110i\u1ec1u g\u00ec c\u00f3 th\u1ec3 c\u1ea3i thi\u1ec7n</li> <li> B\u1ea1n mu\u1ed1n \u0111\u1ec3 l\u1ea1i l\u1eddi nh\u1eafn g\u00ec cho team \ud83d\ude42</li> </ul>"},{"location":"OFFBOARDING/#bieu-mau-offboarding-mau","title":"\ud83e\uddfe Bi\u1ec3u m\u1eabu offboarding m\u1eabu","text":"<pre><code>t\u00ean: Nguy\u1ec5n V\u0103n A\nd\u1ef1 \u00e1n tham gia: API Gateway (DX VAS)\nth\u1eddi gian: Th\u00e1ng 3/2024 \u2013 Th\u00e1ng 8/2025\nb\u00e0n giao cho: Tr\u1ea7n Th\u1ecb B (DevOps), L\u00ea V\u0103n C (backend)\nretro:\n- \u2705 \u0110i\u1ec1u hi\u1ec7u qu\u1ea3: CI/CD nhanh g\u1ecdn, codebase r\u00f5 r\u00e0ng\n- \ud83d\udca1 N\u00ean c\u1ea3i thi\u1ec7n: R\u00fat ng\u1eafn th\u1eddi gian review PR\n- \u2764\ufe0f L\u1eddi nh\u1eafn: C\u1ea3m \u01a1n anh em team, ch\u00fac d\u1ef1 \u00e1n th\u00e0nh c\u00f4ng l\u1edbn!\n</code></pre>"},{"location":"OFFBOARDING/#tai-lieu-ho-tro","title":"\ud83d\udcce T\u00e0i li\u1ec7u h\u1ed7 tr\u1ee3","text":"<ul> <li>Ch\u00ednh s\u00e1ch b\u1ea3o m\u1eadt n\u1ed9i b\u1ed9 (li\u00ean h\u1ec7 IT team)</li> <li>H\u01b0\u1edbng d\u1eabn backup d\u1eef li\u1ec7u t\u1eeb m\u00e1y c\u00e1 nh\u00e2n (tu\u1ef3 theo c\u00f4ng c\u1ee5 team s\u1eed d\u1ee5ng)</li> <li>Template: <code>docs/OFFBOARDING_notes/template.md</code></li> </ul> <p>\u201cB\u1ea1n c\u00f3 th\u1ec3 r\u1eddi d\u1ef1 \u00e1n, nh\u01b0ng nh\u1eefng d\u00f2ng code v\u00e0 tinh th\u1ea7n \u0111\u00f3ng g\u00f3p s\u1ebd c\u00f2n m\u00e3i.\u201d \ud83d\udc9b</p>"},{"location":"ONBOARDING/","title":"\ud83e\udded ONBOARDING Checklist \u2013 API Gateway (DX VAS)","text":"<p>Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi \u0111\u1ed9i ng\u0169 ph\u00e1t tri\u1ec3n API Gateway c\u1ee7a d\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS! \ud83c\udf89</p> <p>T\u00e0i li\u1ec7u n\u00e0y s\u1ebd gi\u00fap b\u1ea1n kh\u1edfi \u0111\u1ed9ng nhanh ch\u00f3ng, n\u1eafm b\u1eaft quy tr\u00ecnh l\u00e0m vi\u1ec7c v\u00e0 thi\u1ebft l\u1eadp \u0111\u1ea7y \u0111\u1ee7 c\u00e1c c\u00f4ng c\u1ee5, quy\u1ec1n truy c\u1eadp \u0111\u1ec3 b\u1eaft \u0111\u1ea7u \u0111\u00f3ng g\u00f3p hi\u1ec7u qu\u1ea3.</p>"},{"location":"ONBOARDING/#checklist-tuan-au-tien","title":"\u2705 Checklist tu\u1ea7n \u0111\u1ea7u ti\u00ean","text":"<p>G\u1ee3i \u00fd th\u1eddi gian:</p> <ul> <li>Ng\u00e0y 1\u20132: Truy c\u1eadp h\u1ec7 th\u1ed1ng &amp; Thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng local</li> <li>Ng\u00e0y 3\u20134: L\u00e0m quen codebase &amp; c\u00f4ng c\u1ee5 CI/CD</li> <li>Ng\u00e0y 5: Giao ti\u1ebfp, g\u00f3p PR \u0111\u1ea7u ti\u00ean, chu\u1ea9n b\u1ecb review</li> </ul>"},{"location":"ONBOARDING/#1-truy-cap-cong-cu","title":"1. Truy c\u1eadp &amp; c\u00f4ng c\u1ee5","text":"<ul> <li> <p> \u0110\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp v\u00e0o:</p> </li> <li> <p> GitHub repo: <code>vas-org/api-gateway</code></p> </li> <li> Google Cloud Console (staging project)</li> <li> Slack n\u1ed9i b\u1ed9 / nh\u00f3m DX VAS</li> <li> <p> C\u00e0i \u0111\u1eb7t c\u00f4ng c\u1ee5:</p> </li> <li> <p> Python &gt;= 3.10</p> </li> <li> Docker &amp; Docker Compose</li> <li> Git</li> <li> VSCode ho\u1eb7c PyCharm</li> <li> Redis client (TablePlus ho\u1eb7c <code>redis-cli</code>)</li> <li> PostgreSQL client (DBeaver, <code>psql</code>)</li> </ul>"},{"location":"ONBOARDING/#2-thiet-lap-moi-truong-local","title":"2. Thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng local","text":"<ul> <li> Clone d\u1ef1 \u00e1n v\u00e0 t\u1ea1o file <code>.env</code></li> <li> C\u00e0i \u0111\u1eb7t <code>pre-commit</code> v\u00e0 ch\u1ea1y <code>pre-commit install</code></li> <li> <code>docker-compose up --build</code> v\u00e0 truy c\u1eadp <code>http://localhost:8000/docs</code></li> <li> \u0110\u1ea3m b\u1ea3o FastAPI ho\u1ea1t \u0111\u1ed9ng local kh\u00f4ng l\u1ed7i</li> </ul>"},{"location":"ONBOARDING/#3-lam-quen-voi-ma-nguon-va-quy-trinh","title":"3. L\u00e0m quen v\u1edbi m\u00e3 ngu\u1ed3n v\u00e0 quy tr\u00ecnh","text":"<ul> <li> \u0110\u1ecdc t\u00e0i li\u1ec7u <code>DEV_GUIDE.md</code></li> <li> \u0110\u1ecdc quy \u01b0\u1edbc <code>CONTRIBUTING.md</code></li> <li> Xem ki\u1ebfn tr\u00fac th\u01b0 m\u1ee5c v\u00e0 module ch\u00ednh: <code>auth</code>, <code>rbac</code>, <code>notify</code></li> <li> Ch\u1ea1y th\u1eed test: <code>pytest</code></li> <li> \u0110\u1ecdc CI workflow t\u1ea1i <code>.github/workflows/ci.yml</code></li> <li> L\u00e0m quen v\u1edbi <code>prestart.sh</code> v\u00e0 Dockerfile</li> </ul>"},{"location":"ONBOARDING/#4-giao-tiep-van-hoa-noi-bo","title":"4. Giao ti\u1ebfp &amp; v\u0103n h\u00f3a n\u1ed9i b\u1ed9","text":"<ul> <li> Tham gia nh\u00f3m Slack <code>#dx-vas-dev</code></li> <li> Gi\u1edbi thi\u1ec7u b\u1ea3n th\u00e2n trong nh\u00f3m (\u0111\u01a1n gi\u1ea3n + role)</li> <li> Bi\u1ebft ai l\u00e0 mentor k\u1ef9 thu\u1eadt (th\u01b0\u1eddng l\u00e0 ng\u01b0\u1eddi assign task \u0111\u1ea7u ti\u00ean)</li> </ul>"},{"location":"ONBOARDING/#nhiem-vu-tuan-au-tien-e-xuat","title":"\ud83d\udea7 Nhi\u1ec7m v\u1ee5 tu\u1ea7n \u0111\u1ea7u ti\u00ean (\u0111\u1ec1 xu\u1ea5t)","text":"M\u1ee5c ti\u00eau Task m\u1eabu K\u1ef3 v\u1ecdng L\u00e0m quen codebase Fix l\u1ed7i nh\u1ecf ho\u1eb7c th\u00eam log/debug 1 commit, push l\u00ean branch feature/* CI/CD T\u1ea1o PR nh\u1ecf c\u1eadp nh\u1eadt README ho\u1eb7c badge T\u1ea1o 1 PR &amp; \u0111\u01b0\u1ee3c merge v\u00e0o <code>dev</code> Test Vi\u1ebft th\u00eam 1 test cho route <code>auth/login</code> C\u00f3 th\u1ec3 ch\u1ea1y pass trong <code>pytest</code>"},{"location":"ONBOARDING/#nguoi-ho-tro","title":"\ud83e\uddd1\u200d\ud83c\udfeb Ng\u01b0\u1eddi h\u1ed7 tr\u1ee3","text":"H\u1ea1ng m\u1ee5c Ng\u01b0\u1eddi ph\u1ee5 tr\u00e1ch Mentor k\u1ef9 thu\u1eadt Nguy\u1ec5n V\u0103n A (Tech Lead) Code review B\u1ea5t k\u1ef3 dev c\u1ea5p senior trong team CI/CD &amp; Cloud Tr\u1ea7n Th\u1ecb B (DevOps)"},{"location":"ONBOARDING/#tai-lieu-quan-trong","title":"\ud83d\udcce T\u00e0i li\u1ec7u quan tr\u1ecdng","text":"<ul> <li>Dev Guide: <code>docs/DEV_GUIDE.md</code></li> <li>Coding Convention + PR flow: <code>docs/CONTRIBUTING.md</code></li> <li>Ki\u1ebfn tr\u00fac: <code>docs/ADR/adr-001-fastapi.md</code>, <code>adr-002-rbac-design.md</code></li> <li>API Docs (local): <code>http://localhost:8000/docs</code></li> </ul>"},{"location":"ONBOARDING/#giao-tiep-va-van-hoa-phan-hoi","title":"\ud83d\udcac Giao ti\u1ebfp v\u00e0 v\u0103n h\u00f3a ph\u1ea3n h\u1ed3i","text":"<ul> <li>B\u1ea1n kh\u00f4ng c\u1ea7n bi\u1ebft m\u1ecdi th\u1ee9 t\u1eeb \u0111\u1ea7u \u2013 h\u00e3y h\u1ecfi khi ch\u01b0a r\u00f5! Slack lu\u00f4n m\u1edf.</li> <li>Feedback n\u00ean t\u1eadp trung v\u00e0o h\u00e0nh vi/code thay v\u00ec c\u00e1 nh\u00e2n.</li> <li>\u0110\u01b0a feedback s\u1edbm, c\u1ee5 th\u1ec3, c\u00f3 g\u1ee3i \u00fd h\u00e0nh \u0111\u1ed9ng.</li> <li>T\u00f4n tr\u1ecdng m\u1ecdi th\u00e0nh vi\u00ean trong team, d\u00f9 l\u00e0 junior hay senior.</li> </ul> <p>\u201cKh\u00f4ng c\u1ea7n gi\u1ecfi ngay t\u1eeb \u0111\u1ea7u \u2013 ch\u1ec9 c\u1ea7n ti\u1ebfn b\u1ed9 m\u1ed7i ng\u00e0y c\u00f9ng team \ud83d\udcaa\u201d</p> <p>Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi h\u00e0nh tr\u00ecnh ph\u00e1t tri\u1ec3n m\u1ed9t h\u1ec7 sinh th\u00e1i gi\u00e1o d\u1ee5c s\u1ed1 m\u1ea1nh m\u1ebd! \ud83e\udde1</p>"},{"location":"ADR/adr-001-fastapi/","title":"ADR-001: Ch\u1ecdn FastAPI l\u00e0m framework cho API Gateway","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 15/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n V\u0103n A</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-001-fastapi/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>D\u1ef1 \u00e1n DX VAS y\u00eau c\u1ea7u x\u00e2y d\u1ef1ng m\u1ed9t API Gateway:</p> <ul> <li>L\u00e0m \u0111i\u1ec3m truy c\u1eadp duy nh\u1ea5t cho c\u00e1c frontend (PWA, SPA).</li> <li>Ki\u1ec3m tra x\u00e1c th\u1ef1c OAuth2, ph\u00e2n quy\u1ec1n RBAC \u0111\u1ed9ng.</li> <li>G\u1eedi log, monitor, forward request \u0111\u1ebfn c\u00e1c backend nh\u01b0 SIS, CRM, LMS.</li> <li>C\u00f3 th\u1ec3 m\u1edf r\u1ed9ng, b\u1ea3o tr\u00ec t\u1ed1t v\u00e0 hi\u1ec7u su\u1ea5t cao.</li> </ul> <p>C\u00e1c framework Python ph\u1ed5 bi\u1ebfn \u0111\u01b0\u1ee3c xem x\u00e9t:</p> <ul> <li>Flask</li> <li>FastAPI</li> <li>Django Rest Framework</li> <li>Tornado</li> </ul>"},{"location":"ADR/adr-001-fastapi/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Ch\u00fang t\u00f4i ch\u1ecdn s\u1eed d\u1ee5ng FastAPI l\u00e0m framework ch\u00ednh cho API Gateway.</p>"},{"location":"ADR/adr-001-fastapi/#ly-do-chinh","title":"\u2705 L\u00fd do ch\u00ednh","text":"Ti\u00eau ch\u00ed FastAPI L\u00fd do Hi\u1ec7u su\u1ea5t \u2705 R\u1ea5t cao (ASGI + Starlette) \u0110\u00e1p \u1ee9ng nhu c\u1ea7u forward nhanh v\u00e0 concurrency Ki\u1ec3u t\u0129nh + type hinting \u2705 R\u00f5 r\u00e0ng T\u1ed1i \u01b0u autocomplete, d\u1ec5 debug Docs t\u1ef1 \u0111\u1ed9ng \u2705 C\u00f3 Swagger + ReDoc sinh t\u1ef1 \u0111\u1ed9ng, h\u1ed7 tr\u1ee3 frontend &amp; QA C\u1ed9ng \u0111\u1ed3ng \u0110ang ph\u00e1t tri\u1ec3n m\u1ea1nh Nhi\u1ec1u th\u01b0 vi\u1ec7n h\u1ed7 tr\u1ee3, t\u00e0i li\u1ec7u r\u00f5 r\u00e0ng T\u00edch h\u1ee3p async \u2705 T\u1ed1t D\u1ec5 k\u1ebft h\u1ee3p httpx, aioRedis, asyncpg H\u1ecdc nhanh \u2705 D\u1ec5 ti\u1ebfp c\u1eadn Ng\u1eafn g\u1ecdn, g\u1ea7n v\u1edbi Flask style"},{"location":"ADR/adr-001-fastapi/#anh-oi-rui-ro","title":"\u274c \u0110\u00e1nh \u0111\u1ed5i / R\u1ee7i ro","text":"<ul> <li>C\u1ed9ng \u0111\u1ed3ng nh\u1ecf h\u01a1n Django, Flask (nh\u01b0ng \u0111ang ph\u00e1t tri\u1ec3n m\u1ea1nh)</li> <li>C\u1ea7n ch\u00fa \u00fd c\u1ea5u tr\u00fac module khi scale l\u1edbn</li> <li>M\u1ed9t s\u1ed1 th\u01b0 vi\u1ec7n legacy ch\u01b0a h\u1ed7 tr\u1ee3 async t\u1ed1t (\u0111\u00e3 ch\u1ecdn lib t\u01b0\u01a1ng th\u00edch)</li> </ul>"},{"location":"ADR/adr-001-fastapi/#anh-huong","title":"\u2728 \u1ea2nh h\u01b0\u1edfng","text":"<ul> <li>T\u0103ng t\u1ed1c ph\u00e1t tri\u1ec3n, d\u1ec5 maintain codebase</li> <li>C\u00f3 th\u1ec3 t\u00e1ch th\u00e0nh microservice trong t\u01b0\u01a1ng lai d\u1ec5 d\u00e0ng nh\u1edd ASGI-native</li> <li>Frontend &amp; QA c\u00f3 t\u00e0i li\u1ec7u endpoint t\u1ef1 \u0111\u1ed9ng qua <code>/docs</code>, <code>/redoc</code></li> </ul>"},{"location":"ADR/adr-001-fastapi/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Flask: Kh\u00f4ng h\u1ed7 tr\u1ee3 async natively, c\u1ea7n m\u1edf r\u1ed9ng nhi\u1ec1u \u0111\u1ec3 \u0111\u1ea1t hi\u1ec7u n\u0103ng t\u01b0\u01a1ng \u0111\u01b0\u01a1ng.</li> <li>Django Rest Framework: Qu\u00e1 n\u1eb7ng cho nhu c\u1ea7u Gateway, nhi\u1ec1u boilerplate.</li> <li>Tornado: M\u1ea1nh v\u1ec1 async nh\u01b0ng API qu\u00e1 th\u1ea5p, kh\u00f3 maintain v\u1edbi team \u0111a c\u1ea5p \u0111\u1ed9.</li> </ul>"},{"location":"ADR/adr-001-fastapi/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Ki\u1ebfn tr\u00fac h\u1ec7 th\u1ed1ng: <code>docs/System_Architect.pdf</code></li> <li>Dev Guide: <code>DEV_GUIDE.md</code></li> <li>ADR ti\u1ebfp theo: <code>adr-002-rbac-design.md</code></li> </ul> <p>\u201cSimple. Typed. Fast. That\u2019s FastAPI.\u201d</p>"},{"location":"ADR/adr-002-rbac-design/","title":"ADR-002: Thi\u1ebft k\u1ebf h\u1ec7 th\u1ed1ng ph\u00e2n quy\u1ec1n RBAC \u0111\u1ed9ng cho API Gateway","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 16/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Tr\u1ea7n Th\u1ecb B</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-002-rbac-design/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>D\u1ef1 \u00e1n DX VAS c\u1ea7n m\u1ed9t c\u01a1 ch\u1ebf ph\u00e2n quy\u1ec1n \u0111\u1ee7 linh ho\u1ea1t \u0111\u1ec3 \u0111\u00e1p \u1ee9ng:</p> <ul> <li>M\u00f4i tr\u01b0\u1eddng gi\u00e1o d\u1ee5c c\u00f3 nhi\u1ec1u vai tr\u00f2 (h\u1ecdc sinh, gi\u00e1o vi\u00ean, admin, ph\u1ee5 huynh\u2026)</li> <li>Frontend kh\u00f4ng x\u1eed l\u00fd logic ph\u00e2n quy\u1ec1n, t\u1ea5t c\u1ea3 ph\u1ea3i ki\u1ec3m tra t\u1ea1i API Gateway</li> <li>D\u1ec5 c\u1eadp nh\u1eadt khi thay \u0111\u1ed5i quy \u0111\u1ecbnh truy c\u1eadp / ch\u1ee9c n\u0103ng h\u1ec7 th\u1ed1ng</li> <li>C\u00f3 th\u1ec3 c\u1ea5u h\u00ecnh tr\u1ef1c ti\u1ebfp qua Admin Webapp</li> </ul> <p>Tr\u01b0\u1edbc \u0111\u00e2y, c\u00e1c h\u1ec7 th\u1ed1ng SIS/LMS s\u1eed d\u1ee5ng ph\u00e2n quy\u1ec1n t\u0129nh ho\u1eb7c hardcoded, d\u1eabn \u0111\u1ebfn kh\u00f3 m\u1edf r\u1ed9ng v\u00e0 b\u1ea3o tr\u00ec.</p>"},{"location":"ADR/adr-002-rbac-design/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng c\u01a1 ch\u1ebf ph\u00e2n quy\u1ec1n \u0111\u1ed9ng RBAC (Role-Based Access Control) t\u1ea1i API Gateway, v\u1edbi kh\u1ea3 n\u0103ng c\u1ea5u h\u00ecnh th\u00f4ng qua b\u1ea3ng d\u1eef li\u1ec7u v\u00e0 cache Redis.</p>"},{"location":"ADR/adr-002-rbac-design/#mo-hinh-uoc-chon","title":"\u2705 M\u00f4 h\u00ecnh \u0111\u01b0\u1ee3c ch\u1ecdn","text":""},{"location":"ADR/adr-002-rbac-design/#1-bang-du-lieu-chinh","title":"1. B\u1ea3ng d\u1eef li\u1ec7u ch\u00ednh:","text":"<ul> <li><code>roles (id, name, description)</code></li> <li><code>permissions (id, code, description)</code></li> <li><code>role_permission (role_id, permission_id)</code></li> <li><code>users (id, email, name)</code></li> <li><code>user_role (user_id, role_id)</code></li> <li><code>route_permission_map (id, path_pattern, method, required_permission)</code></li> </ul>"},{"location":"ADR/adr-002-rbac-design/#2-nguyen-ly-xu-ly","title":"2. Nguy\u00ean l\u00fd x\u1eed l\u00fd:","text":"<ul> <li> <p>M\u1ed7i API request g\u1eedi l\u00ean s\u1ebd c\u00f3:</p> </li> <li> <p><code>Authorization</code> ch\u1ee9a JWT \u2192 decode \u0111\u1ec3 l\u1ea5y <code>user_id</code></p> </li> <li>Ki\u1ec3m tra quy\u1ec1n qua Redis \u2192 n\u1ebfu kh\u00f4ng c\u00f3 th\u00ec fallback DB</li> <li>\u0110\u1ed1i chi\u1ebfu endpoint hi\u1ec7n t\u1ea1i v\u1edbi b\u1ea3ng <code>route_permission_map</code></li> <li>N\u1ebfu <code>user_permissions</code> ch\u1ee9a <code>required_permission</code> \u2192 cho ph\u00e9p</li> </ul>"},{"location":"ADR/adr-002-rbac-design/#3-cache-va-hieu-nang","title":"3. Cache v\u00e0 hi\u1ec7u n\u0103ng:","text":"<ul> <li> <p>Redis key:</p> </li> <li> <p><code>user:{user_id}:permissions</code></p> </li> <li><code>pattern:{method}:{path}</code> \u2192 required_permission</li> <li>Khi thay \u0111\u1ed5i role/permission \u2192 x\u00f3a cache li\u00ean quan</li> <li>D\u00f9ng m\u00f4 h\u00ecnh cache-aside, \u0111\u1ea3m b\u1ea3o consistency</li> </ul>"},{"location":"ADR/adr-002-rbac-design/#4-giao-dien-cau-hinh","title":"4. Giao di\u1ec7n c\u1ea5u h\u00ecnh:","text":"<ul> <li> <p>Admin Webapp c\u00f3 module <code>/rbac/</code></p> </li> <li> <p>G\u00e1n role cho user</p> </li> <li>T\u1ea1o/s\u1eeda/x\u00f3a role v\u00e0 permission</li> <li>C\u1eadp nh\u1eadt permission cho endpoint</li> </ul>"},{"location":"ADR/adr-002-rbac-design/#loi-ich","title":"\u2728 L\u1ee3i \u00edch","text":"<ul> <li>Ph\u00e2n quy\u1ec1n t\u1eadp trung, kh\u00f4ng c\u1ea7n s\u1eeda code m\u1ed7i khi c\u00f3 thay \u0111\u1ed5i quy\u1ec1n</li> <li>C\u00f3 th\u1ec3 ph\u00e2n quy\u1ec1n \u0111\u1ebfn t\u1eebng method + endpoint c\u1ee5 th\u1ec3</li> <li>D\u1ec5 m\u1edf r\u1ed9ng khi h\u1ec7 th\u1ed1ng c\u00f3 th\u00eam microservice</li> <li>C\u00f3 th\u1ec3 audit log permission violation cho m\u1ee5c \u0111\u00edch b\u1ea3o m\u1eadt</li> </ul>"},{"location":"ADR/adr-002-rbac-design/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"V\u1ea5n \u0111\u1ec1 Gi\u1ea3i ph\u00e1p Cache kh\u00f4ng \u0111\u1ed3ng b\u1ed9 D\u00f9ng invalidation theo user_id v\u00e0 pattern Sai c\u1ea5u h\u00ecnh d\u1eabn \u0111\u1ebfn t\u1eeb ch\u1ed1i nh\u1ea7m Th\u00eam log chi ti\u1ebft + c\u00f4ng c\u1ee5 test quy\u1ec1n Giao di\u1ec7n ph\u00e2n quy\u1ec1n b\u1ecb l\u1ea1m d\u1ee5ng Ch\u1ec9 admin c\u00f3 <code>MANAGE_RBAC</code> m\u1edbi truy c\u1eadp"},{"location":"ADR/adr-002-rbac-design/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Hardcoded trong route: nhanh nh\u01b0ng kh\u00f4ng linh ho\u1ea1t, kh\u00f3 b\u1ea3o tr\u00ec</li> <li>JWT nh\u00fang to\u00e0n b\u1ed9 permission: payload l\u1edbn, kh\u00f4ng ph\u1ea3n \u00e1nh thay \u0111\u1ed5i real-time</li> <li>Backend ki\u1ec3m tra ri\u00eang: ph\u00e2n t\u00e1n logic, kh\u00f3 ki\u1ec3m so\u00e1t v\u00e0 b\u1ea3o m\u1eadt</li> </ul>"},{"location":"ADR/adr-002-rbac-design/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Dev Guide: <code>DEV_GUIDE.md</code></li> <li>RBAC module: <code>rbac/</code></li> <li>Swagger UI m\u00f4 t\u1ea3: <code>/docs</code></li> <li>ADR tr\u01b0\u1edbc: <code>adr-001-fastapi.md</code></li> </ul> <p>\u201cPermission should be configurable \u2013 not compiled.\u201d</p>"},{"location":"ADR/adr-003-ci-cd-structure/","title":"ADR-003: C\u1ea5u tr\u00fac CI/CD cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 17/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: L\u00ea V\u0103n C (DevOps)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-003-ci-cd-structure/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng API Gateway c\u1ea7n \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean Google Cloud Run, \u0111\u1ea3m b\u1ea3o c\u00e1c y\u00eau c\u1ea7u:</p> <ul> <li>Tri\u1ec3n khai t\u1ef1 \u0111\u1ed9ng (Continuous Deployment) t\u1eeb GitHub</li> <li>Ki\u1ec3m tra ch\u1ea5t l\u01b0\u1ee3ng code: lint, test, security scan tr\u01b0\u1edbc khi deploy</li> <li>C\u00f3 m\u00f4i tr\u01b0\u1eddng <code>staging</code> v\u00e0 <code>production</code> t\u00e1ch bi\u1ec7t</li> <li>D\u1ec5 d\u00e0ng rollback khi c\u1ea7n</li> </ul> <p>C\u00f4ng c\u1ee5 \u0111\u01b0\u1ee3c l\u1ef1a ch\u1ecdn: GitHub Actions l\u00e0m CI/CD runner ch\u00ednh.</p>"},{"location":"ADR/adr-003-ci-cd-structure/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng c\u1ea5u tr\u00fac CI/CD s\u1eed d\u1ee5ng GitHub Actions v\u1edbi 2 pipeline ch\u00ednh:</p> <ul> <li><code>dev</code> \u2192 Deploy l\u00ean Staging</li> <li><code>main</code> \u2192 Deploy l\u00ean Production</li> </ul>"},{"location":"ADR/adr-003-ci-cd-structure/#cau-truc-pipeline-e-xuat","title":"\ud83d\udee0 C\u1ea5u tr\u00fac pipeline \u0111\u1ec1 xu\u1ea5t","text":"<pre><code>name: CI/CD Pipeline\n\non:\n  push:\n    branches: [dev, main]\n\nenv:\n  PROJECT_ID: truongvietanh-dev\n  REGION: asia-southeast1\n  SERVICE_NAME: api-gateway\n\njobs:\n  build-and-test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Set up Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.10'\n\n      - name: Cache dependencies\n        uses: actions/cache@v3\n        with:\n          path: ~/.cache/pip\n          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}\n\n      - name: Install deps &amp; run checks\n        run: |\n          pip install -r requirements.txt\n          pip install -r requirements-dev.txt\n          pre-commit run --all-files\n          pytest --cov\n          bandit -r .\n          safety check\n\n      - name: Build Docker image\n        run: |\n          docker build -t gcr.io/${{ env.PROJECT_ID }}/${{ env.SERVICE_NAME }}:${{ github.sha }} .\n\n  deploy-staging:\n    if: github.ref == 'refs/heads/dev'\n    needs: build-and-test\n    runs-on: ubuntu-latest\n    steps:\n      - name: Authenticate to GCP\n        uses: google-github-actions/auth@v1\n        with:\n          workload_identity_provider: ${{ secrets.WIF_PROVIDER }}\n          service_account: ${{ secrets.WIF_SERVICE_ACCOUNT }}\n\n      - name: Deploy to Cloud Run (staging)\n        uses: google-github-actions/deploy-cloudrun@v1\n        with:\n          service: api-gateway-stg\n          image: gcr.io/${{ env.PROJECT_ID }}/${{ env.SERVICE_NAME }}:${{ github.sha }}\n          region: ${{ env.REGION }}\n\n  deploy-production:\n    if: github.ref == 'refs/heads/main'\n    needs: build-and-test\n    runs-on: ubuntu-latest\n    steps:\n      - name: Authenticate to GCP\n        uses: google-github-actions/auth@v1\n        with:\n          workload_identity_provider: ${{ secrets.WIF_PROVIDER }}\n          service_account: ${{ secrets.WIF_SERVICE_ACCOUNT }}\n\n      - name: Deploy to Cloud Run (prod)\n        uses: google-github-actions/deploy-cloudrun@v1\n        with:\n          service: api-gateway\n          image: gcr.io/${{ env.PROJECT_ID }}/${{ env.SERVICE_NAME }}:${{ github.sha }}\n          region: ${{ env.REGION }}\n</code></pre>"},{"location":"ADR/adr-003-ci-cd-structure/#thanh-phan-chinh","title":"\u2705 Th\u00e0nh ph\u1ea7n ch\u00ednh","text":"Th\u00e0nh ph\u1ea7n C\u00f4ng c\u1ee5 / G\u1ee3i \u00fd Runner GitHub Actions (<code>.github/workflows/ci.yml</code>) Container Dockerfile chu\u1ea9n h\u00f3a, tag image b\u1eb1ng SHA (<code>gcr.io/project/api-gateway:$GITHUB_SHA</code>) Deploy D\u00f9ng <code>google-github-actions/deploy-cloudrun</code> + Workload Identity Federation (kh\u00f4ng c\u1ea7n file JSON) Secrets L\u01b0u trong GitHub Secrets: <code>WIF_PROVIDER</code>, <code>WIF_SERVICE_ACCOUNT</code>, <code>DB_URL</code>, ... Rollback D\u00f9ng <code>gcloud run revisions list</code> \u0111\u1ec3 revert phi\u00ean b\u1ea3n tr\u01b0\u1edbc Observability Cloud Logging, Monitoring, Alert n\u1ebfu l\u1ed7i &gt;5% trong 5 ph\u00fat"},{"location":"ADR/adr-003-ci-cd-structure/#loi-ich","title":"\u2728 L\u1ee3i \u00edch","text":"<ul> <li>Li\u00ean t\u1ee5c: M\u1ed7i push l\u00ean <code>dev</code> ho\u1eb7c <code>main</code> \u0111\u1ec1u t\u1ef1 \u0111\u1ed9ng build/test/deploy</li> <li>An to\u00e0n: Lu\u00f4n ki\u1ec3m tra lint + test + scan tr\u01b0\u1edbc khi deploy</li> <li>T\u00e1ch bi\u1ec7t: <code>staging</code> d\u00f9ng service ri\u00eang (<code>api-gateway-stg</code>) v\u00e0 domain ph\u1ee5 (<code>api-stg.truongvietanh.edu.vn</code>)</li> <li>D\u1ec5 rollback: D\u1ef1a v\u00e0o revision Cloud Run</li> <li>Gi\u00e1m s\u00e1t t\u1ed1t: Ghi log + alert b\u1eb1ng Cloud Monitoring</li> <li>Kh\u00f4ng c\u1ea7n l\u01b0u key file: S\u1eed d\u1ee5ng Workload Identity Federation thay v\u00ec JSON key</li> </ul>"},{"location":"ADR/adr-003-ci-cd-structure/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Build sai do code ch\u01b0a \u0111\u1ee7 test B\u1eaft bu\u1ed9c test coverage \u2265 80% + ch\u1ea1y pytest trong CI Secrets b\u1ecb l\u1ed9 D\u00f9ng Workload Identity Federation thay v\u00ec key file; kh\u00f4ng commit b\u1ea5t k\u1ef3 bi\u1ebfn b\u00ed m\u1eadt n\u00e0o Deploy tr\u1ec5 v\u00ec l\u1ed7i nh\u1ecf (lint, formatting) D\u00f9ng pre-commit hook \u0111\u1ec3 b\u1eaft s\u1edbm t\u1ea1i local"},{"location":"ADR/adr-003-ci-cd-structure/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Jenkins: Qu\u00e1 n\u1eb7ng, kh\u00f4ng c\u1ea7n t\u1ef1 host</li> <li>GitLab CI: D\u1ef1 \u00e1n \u0111ang n\u1eb1m tr\u00ean GitHub, kh\u00f4ng ph\u00f9 h\u1ee3p</li> <li>Cloud Build \u0111\u1ed9c l\u1eadp: Kh\u00f3 ki\u1ec3m so\u00e1t version/lifecycle PR nh\u01b0 GitHub Actions</li> </ul>"},{"location":"ADR/adr-003-ci-cd-structure/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Dockerfile: <code>/Dockerfile</code></li> <li>CI workflow: <code>.github/workflows/ci.yml</code></li> <li>Dev Guide CI/CD section: <code>DEV_GUIDE.md</code></li> <li>ADR tr\u01b0\u1edbc: <code>adr-002-rbac-design.md</code></li> </ul> <p>\u201cM\u1ed7i l\u1ea7n push l\u00e0 m\u1ed9t l\u1ea7n tin t\u01b0\u1edfng \u2013 h\u00e3y \u0111\u1ec3 CI \u0111\u1ea3m b\u1ea3o b\u1ea1n x\u1ee9ng \u0111\u00e1ng.\u201d</p>"},{"location":"ADR/adr-004-api-versioning/","title":"ADR-004: Chi\u1ebfn l\u01b0\u1ee3c versioning cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 18/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Th\u00e0nh D</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-004-api-versioning/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway \u0111\u00f3ng vai tr\u00f2 trung gian gi\u1eefa frontend v\u00e0 c\u00e1c d\u1ecbch v\u1ee5 backend nh\u01b0 SIS, CRM, LMS. H\u1ec7 th\u1ed1ng s\u1ebd \u0111\u01b0\u1ee3c m\u1edf r\u1ed9ng trong t\u01b0\u01a1ng lai, c\u00f3 kh\u1ea3 n\u0103ng:</p> <ul> <li>Th\u00eam t\u00ednh n\u0103ng m\u1edbi m\u00e0 kh\u00f4ng ph\u00e1 v\u1ee1 t\u00ednh t\u01b0\u01a1ng th\u00edch</li> <li>Gi\u1eef \u1ed5n \u0111\u1ecbnh c\u00e1c client c\u0169 khi backend n\u00e2ng c\u1ea5p</li> <li>Tri\u1ec3n khai nhi\u1ec1u frontend (Admin, Portal, Mobile) v\u1edbi k\u1ef3 v\u1ecdng kh\u00e1c nhau v\u1ec1 contract API</li> </ul> <p>Do \u0111\u00f3, c\u1ea7n c\u00f3 m\u1ed9t chi\u1ebfn l\u01b0\u1ee3c versioning r\u00f5 r\u00e0ng, v\u1eeba d\u1ec5 s\u1eed d\u1ee5ng v\u1eeba \u0111\u1ea3m b\u1ea3o backward compatibility.</p>"},{"location":"ADR/adr-004-api-versioning/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng versioning b\u1eb1ng URL prefix \u2013 c\u1ee5 th\u1ec3 l\u00e0 <code>/api/v1/</code> v\u00e0 s\u1ebd t\u0103ng version n\u1ebfu c\u00f3 breaking changes.</p>"},{"location":"ADR/adr-004-api-versioning/#cach-trien-khai","title":"\ud83d\udcd0 C\u00e1ch tri\u1ec3n khai","text":""},{"location":"ADR/adr-004-api-versioning/#1-cau-truc-routing","title":"1. C\u1ea5u tr\u00fac routing","text":"<ul> <li>T\u1ea5t c\u1ea3 c\u00e1c endpoint \u0111\u1ec1u \u0111\u01b0\u1ee3c prefix b\u1eb1ng <code>/api/v{version}/...</code></li> <li> <p>V\u00ed d\u1ee5:</p> </li> <li> <p><code>/api/v1/sis/students</code></p> </li> <li><code>/api/v1/auth/login</code></li> </ul>"},{"location":"ADR/adr-004-api-versioning/#2-nguyen-tac-tang-version","title":"2. Nguy\u00ean t\u1eafc t\u0103ng version","text":"<ul> <li><code>v1</code> l\u00e0 version ch\u00ednh th\u1ee9c \u0111\u1ea7u ti\u00ean</li> <li> <p>Ch\u1ec9 t\u0103ng version (v2, v3...) khi c\u00f3 breaking change:</p> </li> <li> <p>Thay \u0111\u1ed5i contract (input/output)</p> </li> <li>Thay \u0111\u1ed5i logic x\u1eed l\u00fd quan tr\u1ecdng \u1ea3nh h\u01b0\u1edfng t\u1edbi client</li> </ul>"},{"location":"ADR/adr-004-api-versioning/#3-song-song-nhieu-version-neu-can","title":"3. Song song nhi\u1ec1u version (n\u1ebfu c\u1ea7n)","text":"<ul> <li><code>/api/v1/</code> v\u00e0 <code>/api/v2/</code> c\u00f3 th\u1ec3 t\u1ed3n t\u1ea1i \u0111\u1ed3ng th\u1eddi</li> <li>Frontend c\u1ea7n ch\u1ec9 \u0111\u1ecbnh version r\u00f5 trong m\u1ecdi request</li> </ul>"},{"location":"ADR/adr-004-api-versioning/#4-cau-truc-ma-nguon-fastapi","title":"4. C\u1ea5u tr\u00fac m\u00e3 ngu\u1ed3n (FastAPI)","text":"<ul> <li>D\u00f9ng router ph\u00e2n version:</li> </ul> <pre><code># main.py\napp.include_router(api_v1_router, prefix=\"/api/v1\")\n</code></pre> <ul> <li>M\u1ed7i version c\u00f3 th\u01b0 m\u1ee5c/t\u1ec7p ri\u00eang n\u1ebfu c\u1ea7n:</li> </ul> <pre><code>routers/api_v1/\nrouters/api_v2/\n</code></pre>"},{"location":"ADR/adr-004-api-versioning/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Gi\u1eef backward compatibility cho c\u00e1c frontend c\u0169</li> <li>Tri\u1ec3n khai phi\u00ean b\u1ea3n m\u1edbi song song, gi\u1ea3m downtime v\u00e0 r\u1ee7i ro</li> <li>\u0110\u01a1n gi\u1ea3n, r\u00f5 r\u00e0ng, kh\u00f4ng ph\u1ee5 thu\u1ed9c v\u00e0o header ho\u1eb7c param \u1ea9n</li> <li>D\u1ec5 c\u1ea5u h\u00ecnh RBAC v\u00e0 route permission theo version</li> </ul>"},{"location":"ADR/adr-004-api-versioning/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"V\u1ea5n \u0111\u1ec1 Gi\u1ea3i ph\u00e1p T\u0103ng version qu\u00e1 nhi\u1ec1u, kh\u00f3 qu\u1ea3n l\u00fd \u00c1p d\u1ee5ng Semantic Versioning v\u1ec1 m\u1eb7t t\u01b0 t\u01b0\u1edfng, ch\u1ec9 t\u0103ng khi th\u1eadt s\u1ef1 c\u1ea7n Duplicated code gi\u1eefa c\u00e1c version T\u00e1ch shared logic v\u00e0o <code>services</code>, tr\u00e1nh l\u1eb7p l\u1ea1i router Frontend g\u1ecdi sai version \u00c1p d\u1ee5ng test t\u00edch h\u1ee3p + monitoring request headers"},{"location":"ADR/adr-004-api-versioning/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li> <p>Version b\u1eb1ng Header (<code>Accept: application/vnd.api+json; version=1</code>):</p> </li> <li> <p>Kh\u00f3 debug, kh\u00f4ng r\u00f5 r\u00e0ng khi d\u00f9ng tr\u1ef1c ti\u1ebfp t\u1eeb browser/devtool</p> </li> <li> <p>Query Param (<code>?version=1</code>):</p> </li> <li> <p>Kh\u00f4ng RESTful, d\u1ec5 b\u1ecb cache sai</p> </li> <li> <p>Kh\u00f4ng version:</p> </li> <li> <p>Kh\u00f4ng \u0111\u1ea3m b\u1ea3o backward compatibility</p> </li> </ul>"},{"location":"ADR/adr-004-api-versioning/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Dev Guide \u2013 API Design: <code>DEV_GUIDE.md</code></li> <li>Route Map cho RBAC: <code>route_permission_map</code></li> <li>Swagger UI: <code>/docs</code></li> <li>ADR tr\u01b0\u1edbc: <code>adr-003-ci-cd-structure.md</code></li> </ul> <p>\u201cTh\u00eam v1 t\u1eeb \u0111\u1ea7u \u2013 b\u1ea1n s\u1ebd kh\u00f4ng bao gi\u1edd h\u1ed1i h\u1eadn.\u201d</p>"},{"location":"ADR/adr-005-observability/","title":"ADR-005: Thi\u1ebft k\u1ebf chi\u1ebfn l\u01b0\u1ee3c Observability cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 19/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Tr\u1ea7n Th\u1ecb B (DevOps)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-005-observability/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 \u0111i\u1ec3m trung t\u00e2m x\u1eed l\u00fd x\u00e1c th\u1ef1c, ph\u00e2n quy\u1ec1n, \u0111\u1ecbnh tuy\u1ebfn v\u00e0 forward request \u0111\u1ebfn backend. V\u00ec \u0111\u00e2y l\u00e0 th\u00e0nh ph\u1ea7n \u201csingle entry point\u201d, vi\u1ec7c theo d\u00f5i, c\u1ea3nh b\u00e1o v\u00e0 truy v\u1ebft l\u1ed7i (observability) l\u00e0 r\u1ea5t quan tr\u1ecdng:</p> <ul> <li>Ghi nh\u1eadn \u0111\u1ea7y \u0111\u1ee7 log c\u1ee7a request v\u00e0 l\u1ed7i</li> <li>Theo d\u00f5i \u0111\u1ed9 tr\u1ec5, t\u1ea7n su\u1ea5t l\u1ed7i, request rate</li> <li>H\u1ed7 tr\u1ee3 ph\u00e2n t\u00edch khi c\u00f3 s\u1ef1 c\u1ed1 ho\u1eb7c ph\u1ea3n h\u1ed3i ch\u1eadm t\u1eeb backend</li> <li>H\u1ed7 tr\u1ee3 tracing khi h\u1ec7 th\u1ed1ng m\u1edf r\u1ed9ng ra nhi\u1ec1u microservice</li> </ul>"},{"location":"ADR/adr-005-observability/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng m\u00f4 h\u00ecnh Observability d\u1ef1a tr\u00ean Logging + Metrics + Tracing, t\u00edch h\u1ee3p v\u1edbi Google Cloud Logging, Monitoring v\u00e0 OpenTelemetry.</p>"},{"location":"ADR/adr-005-observability/#chien-luoc-trien-khai","title":"\ud83d\udd0d Chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai","text":""},{"location":"ADR/adr-005-observability/#1-logging-structured","title":"1. Logging (Structured)","text":"<ul> <li>D\u00f9ng <code>python-json-logger</code> \u0111\u1ec3 log ra \u0111\u1ecbnh d\u1ea1ng JSON</li> <li> <p>Log c\u00e1c th\u00f4ng tin sau v\u1edbi m\u1ed7i request:</p> </li> <li> <p><code>timestamp</code>, <code>request_id</code>, <code>correlation_id</code>, <code>method</code>, <code>path</code>, <code>user_id</code>, <code>status_code</code>, <code>latency_ms</code></p> </li> <li>N\u1ebfu l\u1ed7i: log c\u1ea3 <code>error_code</code>, <code>permission_required</code>, <code>reason</code></li> <li><code>correlation_id</code> \u0111\u01b0\u1ee3c t\u1ea1o n\u1ebfu ch\u01b0a c\u00f3, v\u00e0 \u0111\u01b0\u1ee3c truy\u1ec1n gi\u1eefa c\u00e1c h\u1ec7 th\u1ed1ng n\u1ebfu c\u1ea7n t\u00e1ch bi\u1ec7t v\u1edbi <code>request_id</code></li> <li>Log g\u1eedi l\u00ean Google Cloud Logging t\u1ef1 \u0111\u1ed9ng qua Cloud Run</li> </ul>"},{"location":"ADR/adr-005-observability/#2-metrics","title":"2. Metrics","text":"<ul> <li> <p>D\u00f9ng <code>Prometheus FastAPI Instrumentator</code> ho\u1eb7c middleware custom</p> </li> <li> <p>\u01afu ti\u00ean d\u00f9ng OpenTelemetry Metrics API n\u1ebfu \u0111\u00e3 t\u00edch h\u1ee3p tracing \u0111\u1ec3 th\u1ed1ng nh\u1ea5t pipeline export l\u00ean Cloud Monitoring</p> </li> <li> <p>C\u00e1c metrics c\u1ea7n thu th\u1eadp:</p> </li> <li> <p><code>request_count</code> theo path/method/status</p> </li> <li><code>request_latency_ms</code></li> <li><code>error_count</code></li> <li><code>auth_failures</code>, <code>rbac_denied</code></li> </ul>"},{"location":"ADR/adr-005-observability/#3-tracing-distributed-tracing","title":"3. Tracing (Distributed Tracing)","text":"<ul> <li>D\u00f9ng OpenTelemetry \u0111\u1ec3 g\u1eafn <code>trace_id</code>, <code>span_id</code>, <code>correlation_id</code></li> <li>Forward trace context theo chu\u1ea9n W3C: <code>traceparent</code>, <code>tracestate</code></li> <li>M\u1ecdi request \u0111\u1ebfn backend (SIS, CRM...) s\u1ebd gi\u1eef nguy\u00ean trace context qua header</li> <li>T\u00edch h\u1ee3p Google Cloud Trace ho\u1eb7c Jaeger \u0111\u1ec3 theo d\u00f5i to\u00e0n b\u1ed9 lifecycle c\u1ee7a request</li> </ul>"},{"location":"ADR/adr-005-observability/#4-alerting","title":"4. Alerting","text":"<ul> <li> <p>Thi\u1ebft l\u1eadp c\u1ea3nh b\u00e1o qua Cloud Monitoring:</p> </li> <li> <p>Error rate &gt; 5% trong 5 ph\u00fat</p> </li> <li>Latency trung b\u00ecnh &gt; 1000ms</li> <li>S\u1ed1 request 4xx/5xx t\u0103ng \u0111\u1ed9t bi\u1ebfn</li> <li>S\u1eed d\u1ee5ng CPU &gt; 85% ho\u1eb7c Memory &gt; 80% tr\u00ean Cloud Run &gt; 5 ph\u00fat</li> <li>G\u1eedi alert qua email, Slack (Webhook), Google Chat</li> </ul>"},{"location":"ADR/adr-005-observability/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Theo d\u00f5i s\u1ee9c kh\u1ecfe h\u1ec7 th\u1ed1ng real-time</li> <li>D\u1ec5 truy t\u00ecm nguy\u00ean nh\u00e2n s\u1ef1 c\u1ed1 v\u1edbi trace-id ho\u1eb7c correlation_id</li> <li>Ph\u00e1t hi\u1ec7n nhanh c\u00e1c bottleneck ho\u1eb7c c\u1ea5u h\u00ecnh sai</li> <li>Gi\u00fap frontend/dev/qa debug hi\u1ec7u qu\u1ea3 h\u01a1n v\u00e0 r\u00fat ng\u1eafn th\u1eddi gian ph\u1ea3n h\u1ed3i</li> </ul>"},{"location":"ADR/adr-005-observability/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00e1 nhi\u1ec1u log kh\u00f4ng c\u1ea7n thi\u1ebft D\u00f9ng log level ph\u00f9 h\u1ee3p: <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code> T\u0103ng \u0111\u1ed9 tr\u1ec5 do log ho\u1eb7c trace Log async, sampling tracing (v\u00ed d\u1ee5 10%) n\u1ebfu c\u1ea7n Alert false-positive \u0110\u1eb7t ng\u01b0\u1ee1ng th\u00f4ng minh, cooldown v\u00e0 alert condition c\u1ee5 th\u1ec3"},{"location":"ADR/adr-005-observability/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng log structured: Kh\u00f3 filter v\u00e0 ph\u00e2n t\u00edch sau n\u00e0y</li> <li>Ch\u1ec9 log l\u1ed7i, kh\u00f4ng log th\u00e0nh c\u00f4ng: Thi\u1ebfu baseline v\u00e0 kh\u00f3 x\u00e1c \u0111\u1ecbnh v\u1ea5n \u0111\u1ec1 theo chi\u1ec1u d\u1ecdc</li> <li>Push metrics th\u1ee7 c\u00f4ng b\u1eb1ng script: Kh\u00f4ng ph\u00f9 h\u1ee3p v\u1edbi Cloud-native pipeline v\u00e0 kh\u00f4ng th\u1ed1ng nh\u1ea5t v\u1edbi tracing</li> </ul>"},{"location":"ADR/adr-005-observability/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Dev Guide \u2013 Observability section: <code>DEV_GUIDE.md</code></li> <li>Middleware log &amp; metrics: <code>utils/logging.py</code>, <code>metrics.py</code></li> <li>OpenTelemetry docs: https://opentelemetry.io/</li> <li>W3C Trace Context: https://www.w3.org/TR/trace-context/</li> <li>ADR tr\u01b0\u1edbc: <code>adr-004-api-versioning.md</code></li> </ul> <p>\u201cB\u1ea1n kh\u00f4ng th\u1ec3 kh\u1eafc ph\u1ee5c \u0111i\u1ec1u b\u1ea1n kh\u00f4ng \u0111o l\u01b0\u1eddng \u2013 h\u00e3y quan s\u00e1t m\u1ecdi th\u1ee9 c\u00f3 \u00fd ngh\u0129a.\u201d</p>"},{"location":"ADR/adr-006-auth-design/","title":"ADR-006: Thi\u1ebft k\u1ebf h\u1ec7 th\u1ed1ng x\u00e1c th\u1ef1c (Auth) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 20/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Th\u00e0nh D (Backend Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-006-auth-design/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway c\u1ee7a DX VAS \u0111\u00f3ng vai tr\u00f2 ki\u1ec3m so\u00e1t quy\u1ec1n truy c\u1eadp cho to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng frontend (Admin Webapp, Customer Portal). V\u00ec v\u1eady, y\u00eau c\u1ea7u m\u1ed9t c\u01a1 ch\u1ebf x\u00e1c th\u1ef1c:</p> <ul> <li>Tin c\u1eady (d\u1ef1a tr\u00ean h\u1ec7 th\u1ed1ng c\u00f3 s\u1eb5n nh\u01b0 Google OAuth2)</li> <li>\u0110\u01a1n gi\u1ea3n v\u1edbi ng\u01b0\u1eddi d\u00f9ng (SSO)</li> <li>D\u1ec5 ki\u1ec3m tra v\u00e0 x\u00e1c minh \u1edf API Gateway</li> <li>T\u00edch h\u1ee3p t\u1ed1t v\u1edbi c\u01a1 ch\u1ebf RBAC \u0111\u1ed9ng \u0111\u00e3 \u0111\u01b0\u1ee3c ch\u1ecdn \u1edf ADR-002</li> </ul>"},{"location":"ADR/adr-006-auth-design/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>S\u1eed d\u1ee5ng OAuth2 c\u1ee7a Google l\u00e0m c\u01a1 ch\u1ebf x\u00e1c th\u1ef1c ch\u00ednh, k\u1ebft h\u1ee3p JWT \u0111\u1ec3 giao ti\u1ebfp n\u1ed9i b\u1ed9.</p>"},{"location":"ADR/adr-006-auth-design/#mo-hinh-xac-thuc","title":"\ud83d\udd10 M\u00f4 h\u00ecnh x\u00e1c th\u1ef1c","text":""},{"location":"ADR/adr-006-auth-design/#1-ang-nhap-login-flow","title":"1. \u0110\u0103ng nh\u1eadp (Login Flow)","text":"<ul> <li>Ng\u01b0\u1eddi d\u00f9ng ch\u1ecdn \u0111\u0103ng nh\u1eadp b\u1eb1ng Google</li> <li> <p>Sau khi x\u00e1c th\u1ef1c OAuth2 th\u00e0nh c\u00f4ng, h\u1ec7 th\u1ed1ng s\u1ebd:</p> </li> <li> <p>L\u1ea5y <code>id_token</code> t\u1eeb Google (d\u00f9ng \u0111\u1ec3 x\u00e1c minh danh t\u00ednh ph\u00eda server)</p> </li> <li>Decode payload (<code>sub</code>, <code>email</code>, <code>name</code>, <code>picture</code>...)</li> <li>\u0110\u1ed3ng b\u1ed9 user v\u00e0o h\u1ec7 th\u1ed1ng n\u1ebfu ch\u01b0a c\u00f3 (d\u1ef1a theo email)</li> <li>T\u1ea1o Access Token (JWT ng\u1eafn h\u1ea1n) + Refresh Token (DB)</li> </ul>"},{"location":"ADR/adr-006-auth-design/#2-jwt-access-token","title":"2. JWT Access Token","text":"<ul> <li>JWT \u0111\u01b0\u1ee3c k\u00fd b\u1edfi secret key ri\u00eang c\u1ee7a h\u1ec7 th\u1ed1ng (symmetric HMAC SHA256)</li> <li>Payload bao g\u1ed3m:</li> </ul> <pre><code>{\n  \"sub\": \"user_id\",\n  \"email\": \"abc@truongvietanh.edu.vn\",\n  \"role\": \"teacher\",\n  \"exp\": 1700000000\n}\n</code></pre> <ul> <li>Token \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng cho c\u00e1c request \u0111\u1ebfn API Gateway qua header <code>Authorization: Bearer &lt;token&gt;</code></li> <li>L\u01b0u \u00fd: Tr\u01b0\u1eddng <code>role</code> trong JWT l\u00e0 th\u00f4ng tin t\u1ea1m th\u1eddi nh\u1eb1m h\u1ed7 tr\u1ee3 hi\u1ec3n th\u1ecb giao di\u1ec7n ph\u00eda frontend nhanh h\u01a1n. Quy\u1ebft \u0111\u1ecbnh ph\u00e2n quy\u1ec1n \u0111\u1ed9ng v\u1eabn d\u1ef1a tr\u00ean <code>user_id \u2192 role \u2192 permission</code> t\u1eeb Redis/DB (RBAC) nh\u01b0 m\u00f4 t\u1ea3 trong ADR-002</li> </ul>"},{"location":"ADR/adr-006-auth-design/#3-refresh-token","title":"3. Refresh Token","text":"<ul> <li>L\u01b0u \u01b0u ti\u00ean trong DB (<code>user_refresh_token</code>) \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh b\u1ec1n v\u1eefng v\u00e0 d\u1ec5 qu\u1ea3n l\u00fd (revoke all, audit log)</li> <li>C\u00f3 th\u1ec3 s\u1eed d\u1ee5ng Redis c\u00f3 persistence n\u1ebfu c\u1ea7n t\u1ed1c \u0111\u1ed9, v\u1edbi TTL kho\u1ea3ng 7 ng\u00e0y</li> <li>Refresh token \u0111\u01b0\u1ee3c m\u00e3 h\u00f3a tr\u01b0\u1edbc khi l\u01b0u tr\u1eef trong DB \u0111\u1ec3 t\u0103ng c\u01b0\u1eddng b\u1ea3o m\u1eadt</li> </ul>"},{"location":"ADR/adr-006-auth-design/#4-middleware-kiem-tra-token","title":"4. Middleware ki\u1ec3m tra token","text":"<ul> <li>Tr\u00edch <code>Authorization</code> header</li> <li>Decode v\u00e0 ki\u1ec3m tra ch\u1eef k\u00fd, <code>exp</code>, <code>nbf</code></li> <li>N\u1ebfu h\u1ee3p l\u1ec7 \u2192 g\u00e1n <code>request.user</code>, <code>X-User-Id</code>, <code>X-Role</code>, <code>X-Permissions</code></li> </ul>"},{"location":"ADR/adr-006-auth-design/#5-logout","title":"5. Logout","text":"<ul> <li>Xo\u00e1 refresh token kh\u1ecfi DB ho\u1eb7c Redis</li> <li>Xo\u00e1 session frontend (n\u1ebfu c\u00f3)</li> </ul>"},{"location":"ADR/adr-006-auth-design/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>\u0110\u01a1n gi\u1ea3n ho\u00e1 tr\u1ea3i nghi\u1ec7m ng\u01b0\u1eddi d\u00f9ng v\u1edbi SSO Google</li> <li>H\u1ea1n ch\u1ebf ph\u1ea3i l\u01b0u tr\u1eef m\u1eadt kh\u1ea9u (kh\u00f4ng c\u00f3 local password)</li> <li>JWT hi\u1ec7u su\u1ea5t cao, kh\u00f4ng c\u1ea7n truy v\u1ea5n DB m\u1ed7i request</li> <li>D\u1ec5 t\u00edch h\u1ee3p v\u1edbi RBAC, forwarding backend</li> </ul>"},{"location":"ADR/adr-006-auth-design/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p JWT b\u1ecb \u0111\u00e1nh c\u1eafp Gi\u1edbi h\u1ea1n th\u1eddi gian s\u1ed1ng (15 ph\u00fat), b\u1eaft bu\u1ed9c HTTPS Refresh Token b\u1ecb l\u1ed9 M\u00e3 h\u00f3a khi l\u01b0u, l\u01b0u trong DB thay v\u00ec cookie/localStorage, revoke khi logout/all devices Ng\u01b0\u1eddi ngo\u00e0i \u0111\u0103ng nh\u1eadp \u0111\u01b0\u1ee3c Ch\u1ec9 cho ph\u00e9p email thu\u1ed9c domain <code>@truongvietanh.edu.vn</code> qua Google OAuth config"},{"location":"ADR/adr-006-auth-design/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li> <p>Local login b\u1eb1ng email/password:</p> </li> <li> <p>T\u0103ng r\u1ee7i ro b\u1ea3o m\u1eadt, c\u1ea7n flow reset m\u1eadt kh\u1ea9u, l\u01b0u tr\u1eef password</p> </li> <li> <p>SSO n\u1ed9i b\u1ed9 ri\u00eang:</p> </li> <li> <p>Kh\u00f4ng c\u00f3 h\u1ea1 t\u1ea7ng hi\u1ec7n t\u1ea1i; Google Workspace \u0111\u00e3 s\u1eb5n s\u00e0ng v\u00e0 \u0111\u00e1ng tin c\u1eady</p> </li> <li> <p>Access token l\u00e0 session ID (non-JWT):</p> </li> <li> <p>Kh\u00f4ng th\u1ec3 forward an to\u00e0n, kh\u00f4ng self-contained, kh\u00f3 m\u1edf r\u1ed9ng \u0111a d\u1ecbch v\u1ee5</p> </li> </ul>"},{"location":"ADR/adr-006-auth-design/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>FastAPI Auth flow: <code>auth/router.py</code></li> <li>JWT utils: <code>utils/security.py</code></li> <li>Dev Guide: <code>DEV_GUIDE.md</code></li> <li>RBAC flow: <code>adr-002-rbac-design.md</code></li> </ul> <p>\u201cSSO \u0111\u01a1n gi\u1ea3n cho ng\u01b0\u1eddi d\u00f9ng \u2013 JWT r\u00f5 r\u00e0ng cho h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-007-error-handling/","title":"ADR-007: Chi\u1ebfn l\u01b0\u1ee3c x\u1eed l\u00fd l\u1ed7i (Error Handling) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 b\u1ecb thay th\u1ebf (superseded by <code>dx_vas/adr-011-api-error-format.md</code>)</li> <li>Ng\u00e0y: 21/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n V\u0103n K (Tech Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-007-error-handling/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 n\u01a1i ti\u1ebfp nh\u1eadn to\u00e0n b\u1ed9 request t\u1eeb frontend v\u00e0 \u0111\u1ecbnh tuy\u1ebfn \u0111\u1ebfn c\u00e1c backend. Vi\u1ec7c x\u1eed l\u00fd l\u1ed7i ph\u1ea3i th\u1ed1ng nh\u1ea5t, r\u00f5 r\u00e0ng v\u00e0 d\u1ec5 hi\u1ec3u \u0111\u1ed1i v\u1edbi c\u1ea3 ng\u01b0\u1eddi d\u00f9ng cu\u1ed1i (qua frontend) v\u00e0 developer (qua log v\u00e0 debug). C\u00e1c h\u1ec7 th\u1ed1ng backend (SIS, CRM, LMS) c\u0169ng c\u00f3 th\u1ec3 tr\u1ea3 v\u1ec1 l\u1ed7i theo format ri\u00eang, c\u1ea7n chu\u1ea9n h\u00f3a l\u1ea1i \u1edf gateway.</p>"},{"location":"ADR/adr-007-error-handling/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Tu\u00e2n th\u1ee7 theo \u0111\u1ecbnh d\u1ea1ng l\u1ed7i chu\u1ea9n \u0111\u00e3 \u0111\u01b0\u1ee3c quy \u0111\u1ecbnh trong DX-VAS/ADR-011 (API Error Format) cho to\u00e0n h\u1ec7 th\u1ed1ng.</p>"},{"location":"ADR/adr-007-error-handling/#trien-khai-tai-api-gateway","title":"\ud83d\udee0 Tri\u1ec3n khai t\u1ea1i API Gateway","text":""},{"location":"ADR/adr-007-error-handling/#1-middleware-xu-ly-tap-trung","title":"1. Middleware x\u1eed l\u00fd t\u1eadp trung","text":"<ul> <li>S\u1eed d\u1ee5ng <code>exception_handler</code> trong FastAPI \u0111\u1ec3 x\u1eed l\u00fd to\u00e0n b\u1ed9 l\u1ed7i t\u1ea1i m\u1ed9t \u0111i\u1ec3m</li> <li>Custom c\u00e1c exception c\u1ee5 th\u1ec3:</li> <li><code>HTTPException</code></li> <li><code>ValidationError</code> (Pydantic/FastAPI)</li> <li><code>RBACPermissionDenied</code></li> <li><code>TokenExpiredError</code></li> <li>C\u00e1c l\u1ed7i kh\u00f4ng mong mu\u1ed1n nh\u01b0 <code>ValueError</code>, <code>TypeError</code>, <code>RuntimeError</code>... s\u1ebd \u0111\u01b0\u1ee3c map th\u00e0nh l\u1ed7i <code>500 Internal Server Error</code> v\u1edbi <code>trace_id</code> v\u00e0 <code>message</code> chung</li> </ul>"},{"location":"ADR/adr-007-error-handling/#2-forward-loi-tu-backend","title":"2. Forward l\u1ed7i t\u1eeb backend","text":"<ul> <li>N\u1ebfu backend tr\u1ea3 l\u1ed7i kh\u00f4ng chu\u1ea9n:</li> <li>L\u1ea5y status code + message \u2192 wrap l\u1ea1i theo \u0111\u1ecbnh d\u1ea1ng chu\u1ea9n</li> <li>G\u1eafn <code>meta.source: backend_service_name</code> n\u1ebfu c\u1ea7n (gi\u00fap ph\u00e2n t\u00edch root cause d\u1ec5 h\u01a1n)</li> </ul>"},{"location":"ADR/adr-007-error-handling/#3-mapping-loi-pho-bien-tai-gateway","title":"3. Mapping l\u1ed7i ph\u1ed5 bi\u1ebfn t\u1ea1i Gateway","text":"HTTP Code M\u00f4 t\u1ea3 Khi n\u00e0o x\u1ea3y ra 400 Bad Request Thi\u1ebfu param, body sai \u0111\u1ecbnh d\u1ea1ng 401 Unauthorized Thi\u1ebfu/kh\u00f4ng h\u1ee3p l\u1ec7 Access Token 403 Forbidden Kh\u00f4ng \u0111\u1ee7 quy\u1ec1n truy c\u1eadp (RBAC) 404 Not Found Endpoint kh\u00f4ng t\u1ed3n t\u1ea1i 422 Validation Error Request \u0111\u00fang format JSON nh\u01b0ng sai logic 429 Too Many Requests Rate limit 502 Bad Gateway Backend tr\u1ea3 l\u1ed7i ho\u1eb7c kh\u00f4ng ph\u1ea3n h\u1ed3i"},{"location":"ADR/adr-007-error-handling/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Tu\u00e2n th\u1ee7 ch\u00ednh s\u00e1ch chung to\u00e0n h\u1ec7 th\u1ed1ng</li> <li>T\u0103ng kh\u1ea3 n\u0103ng gi\u00e1m s\u00e1t &amp; ph\u00e2n t\u00edch l\u1ed7i t\u1eadp trung</li> <li>Cho ph\u00e9p c\u00e1c \u0111\u1ed9i frontend/backend x\u1eed l\u00fd l\u1ed7i th\u1ed1ng nh\u1ea5t</li> </ul>"},{"location":"ADR/adr-007-error-handling/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Th\u00f4ng tin l\u1ed7i l\u1ed9 d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m Trong m\u00f4i tr\u01b0\u1eddng production, tr\u01b0\u1eddng <code>details</code> s\u1ebd b\u1ecb l\u01b0\u1ee3c b\u1ecf ho\u1eb7c thay b\u1eb1ng th\u00f4ng b\u00e1o chung. Chi ti\u1ebft l\u1ed7i ch\u1ec9 \u0111\u01b0\u1ee3c ghi v\u00e0o log n\u1ed9i b\u1ed9 (Cloud Logging, stdout) Backend tr\u1ea3 l\u1ed7i kh\u00f4ng r\u00f5 r\u00e0ng Mapping l\u1ea1i t\u1ea1i gateway v\u00e0 th\u00eam <code>meta.source</code> \u0111\u1ec3 trace"},{"location":"ADR/adr-007-error-handling/#trang-thai-ke-thua","title":"\ud83d\udd04 Tr\u1ea1ng th\u00e1i k\u1ebf th\u1eeba","text":"<p>ADR n\u00e0y \u0111\u01b0\u1ee3c thay th\u1ebf b\u1edfi DX-VAS/ADR-011 (API Error Format). T\u00e0i li\u1ec7u n\u00e0y ch\u1ec9 gi\u1eef l\u1ea1i c\u00e1c \u0111\u1eb7c t\u1ea3 tri\u1ec3n khai c\u1ee5 th\u1ec3 t\u1ea1i API Gateway.</p>"},{"location":"ADR/adr-007-error-handling/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Exception middleware: <code>utils/exception_handler.py</code></li> <li>Dev Guide \u2013 Error Handling section: <code>DEV_GUIDE.md</code></li> <li>ADR D\u1ef1 \u00c1n T\u1ed5ng DX-VAS/ADR-011 (API Error Format)</li> </ul> <p>\u201cM\u1ed9t h\u1ec7 th\u1ed1ng t\u1ed1t kh\u00f4ng ch\u1ec9 ch\u1ea1y t\u1ed1t khi \u0111\u00fang \u2013 m\u00e0 c\u00f2n ph\u1ea3n h\u1ed3i t\u1ed1t khi sai.\u201d</p>"},{"location":"ADR/adr-008-rate-limiting/","title":"ADR-008: Thi\u1ebft k\u1ebf c\u01a1 ch\u1ebf Rate Limiting cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 22/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Qu\u1ed1c T (Infra Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng API Gateway l\u00e0 \u0111i\u1ec3m \u0111\u1ea7u x\u1eed l\u00fd to\u00e0n b\u1ed9 l\u01b0u l\u01b0\u1ee3ng t\u1eeb frontend. \u0110\u1ec3 \u0111\u1ea3m b\u1ea3o \u1ed5n \u0111\u1ecbnh, ch\u1ed1ng l\u1ea1m d\u1ee5ng v\u00e0 b\u1ea3o v\u1ec7 backend kh\u1ecfi b\u1ecb t\u1ea5n c\u00f4ng t\u1eeb ch\u1ed1i d\u1ecbch v\u1ee5 (DoS), c\u1ea7n thi\u1ebft k\u1ebf c\u01a1 ch\u1ebf Rate Limiting:</p> <ul> <li>Gi\u1edbi h\u1ea1n s\u1ed1 l\u01b0\u1ee3ng request t\u1eeb m\u1ed9t user/IP trong m\u1ed9t kho\u1ea3ng th\u1eddi gian nh\u1ea5t \u0111\u1ecbnh</li> <li>C\u1ea3nh b\u00e1o ho\u1eb7c t\u1eeb ch\u1ed1i khi v\u01b0\u1ee3t ng\u01b0\u1ee1ng</li> <li>Ghi log v\u00e0 theo d\u00f5i h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng</li> <li>K\u1ebft h\u1ee3p linh ho\u1ea1t v\u1edbi c\u00e1c gi\u1ea3i ph\u00e1p \u1edf t\u1ea7ng h\u1ea1 t\u1ea7ng nh\u01b0 Cloud Armor</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng c\u01a1 ch\u1ebf Rate Limiting theo IP v\u00e0 theo user_id (n\u1ebfu c\u00f3), k\u1ebft h\u1ee3p Redis \u0111\u1ec3 \u0111\u1ebfm v\u00e0 gi\u1edbi h\u1ea1n request trong gateway.</p>"},{"location":"ADR/adr-008-rate-limiting/#thiet-ke","title":"\ud83d\udee0 Thi\u1ebft k\u1ebf","text":""},{"location":"ADR/adr-008-rate-limiting/#1-co-che-ap-dung","title":"1. C\u01a1 ch\u1ebf \u00e1p d\u1ee5ng","text":"<ul> <li>D\u1ef1a tr\u00ean middleware (vd: <code>slowapi</code> ho\u1eb7c middleware custom)</li> <li> <p>D\u1ef1a theo:</p> </li> <li> <p><code>user_id</code> n\u1ebfu c\u00f3 token h\u1ee3p l\u1ec7</p> </li> <li><code>client_ip</code> n\u1ebfu l\u00e0 anonymous / ch\u01b0a \u0111\u0103ng nh\u1eadp</li> <li> <p>Ng\u01b0\u1ee1ng m\u1eb7c \u0111\u1ecbnh (c\u00f3 th\u1ec3 c\u1ea5u h\u00ecnh):</p> </li> <li> <p>60 request/ph\u00fat/user</p> </li> <li>30 request/ph\u00fat/IP v\u1edbi anonymous</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#2-redis-backed-sliding-window-counter-uu-tien","title":"2. Redis-backed Sliding Window Counter (\u01b0u ti\u00ean)","text":"<ul> <li>S\u1eed d\u1ee5ng thu\u1eadt to\u00e1n Sliding Window Counter \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o gi\u1edbi h\u1ea1n ch\u00ednh x\u00e1c h\u01a1n Fixed Window</li> <li> <p>Redis l\u01b0u th\u00f4ng tin <code>count</code> + TTL theo key:</p> </li> <li> <p><code>ratelimit:user:{user_id}</code></p> </li> <li><code>ratelimit:ip:{ip}</code></li> <li>TTL = 60 gi\u00e2y (configurable)</li> <li>N\u1ebfu v\u01b0\u1ee3t qu\u00e1 ng\u01b0\u1ee1ng \u2192 tr\u1ea3 l\u1ed7i 429</li> <li>C\u00f3 th\u1ec3 n\u00e2ng c\u1ea5p l\u00ean leaky bucket ho\u1eb7c token bucket n\u1ebfu y\u00eau c\u1ea7u co gi\u00e3n (burst control) r\u00f5 r\u1ec7t h\u01a1n trong t\u01b0\u01a1ng lai</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#3-phan-hoi-khi-vuot-nguong","title":"3. Ph\u1ea3n h\u1ed3i khi v\u01b0\u1ee3t ng\u01b0\u1ee1ng","text":"<pre><code>{\n  \"error_code\": 429,\n  \"message\": \"Too Many Requests\",\n  \"details\": \"You have exceeded the allowed rate limit. Please wait and try again.\",\n  \"retry_after\": 30\n}\n</code></pre> <ul> <li>Tr\u1ea3 k\u00e8m header <code>Retry-After: 30</code></li> <li>Ghi log c\u1ea3nh b\u00e1o v\u00e0 g\u1eafn <code>request_id</code></li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#4-mo-rong-theo-vai-tro-loai-nguoi-dung","title":"4. M\u1edf r\u1ed9ng theo vai tr\u00f2 / lo\u1ea1i ng\u01b0\u1eddi d\u00f9ng","text":"<ul> <li>V\u1edbi <code>role = admin</code> \u2192 c\u00f3 th\u1ec3 n\u00e2ng ng\u01b0\u1ee1ng ho\u1eb7c mi\u1ec5n gi\u1edbi h\u1ea1n (internal service)</li> <li>H\u1ea1n m\u1ee9c c\u00f3 th\u1ec3 \u0111i\u1ec1u ch\u1ec9nh theo <code>role</code>, <code>endpoint</code>, <code>path pattern</code></li> <li>H\u1ed7 tr\u1ee3 c\u1ea5u h\u00ecnh t\u1eeb b\u1ea3ng DB ho\u1eb7c file YAML/Redis</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#5-giam-sat-alert","title":"5. Gi\u00e1m s\u00e1t &amp; Alert","text":"<ul> <li>Log m\u1ed7i l\u1ea7n tr\u1ea3 l\u1ed7i 429 (ghi <code>user_id</code>, <code>ip</code>, <code>path</code>, <code>request_id</code>)</li> <li>Thu th\u1eadp metric: <code>rate_limit_exceeded_total</code></li> <li> <p>T\u1ea1o c\u1ea3nh b\u00e1o khi:</p> </li> <li> <p>5% t\u1ed5ng request trong 5 ph\u00fat b\u1ecb 429</p> </li> <li>M\u1ed9t IP v\u01b0\u1ee3t 1000 l\u1ea7n 429 trong 1 gi\u1edd</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#6-ket-hop-voi-cloud-armor-bo-sung-phong-thu-tang-thap","title":"6. K\u1ebft h\u1ee3p v\u1edbi Cloud Armor (b\u1ed5 sung ph\u00f2ng th\u1ee7 t\u1ea7ng th\u1ea5p)","text":"<ul> <li> <p>D\u00f9ng Cloud Armor \u0111\u1ec3 ch\u1eb7n:</p> </li> <li> <p>C\u00e1c IP \u0111\u00e3 bi\u1ebft \u0111\u1ed9c h\u1ea1i (deny list)</p> </li> <li>DDoS \u1edf t\u1ea7ng HTTP(S)</li> <li>API Gateway x\u1eed l\u00fd rate limit tinh vi h\u01a1n theo user/role/endpoint</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ch\u1ed1ng spam/t\u1ea5n c\u00f4ng t\u1eeb client x\u1ea5u</li> <li>B\u1ea3o v\u1ec7 t\u00e0i nguy\u00ean backend</li> <li>C\u1ea3i thi\u1ec7n hi\u1ec7u su\u1ea5t chung trong gi\u1edd cao \u0111i\u1ec3m</li> <li>D\u1ec5 gi\u00e1m s\u00e1t v\u00e0 m\u1edf r\u1ed9ng theo nhu c\u1ea7u t\u1eebng nh\u00f3m ng\u01b0\u1eddi d\u00f9ng</li> <li>Linh ho\u1ea1t v\u00e0 m\u1edf r\u1ed9ng \u0111\u01b0\u1ee3c (RBAC-based rate limiting)</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Ng\u01b0\u1eddi d\u00f9ng b\u1ecb gi\u1edbi h\u1ea1n nh\u1ea7m Th\u00f4ng b\u00e1o r\u00f5 r\u00e0ng + log chi ti\u1ebft + c\u00f3 header Retry-After \u0111\u1ec3 frontend retry IP b\u1ecb NAT (nhi\u1ec1u user tr\u00f9ng IP) \u01afu ti\u00ean theo <code>user_id</code> n\u1ebfu c\u00f3, v\u00e0 cho ph\u00e9p t\u0103ng ng\u01b0\u1ee1ng IP n\u1ebfu nh\u1eadn di\u1ec7n m\u1ea1ng tin c\u1eady Redis b\u1ecb l\u1ed7i \u2192 m\u1ea5t ki\u1ec3m so\u00e1t rate \u00c1p d\u1ee5ng timeout fail-open (v\u00ed d\u1ee5 30s), ho\u1eb7c degrade m\u1ec1m: t\u1ea1m th\u1eddi kh\u00f4ng gi\u1edbi h\u1ea1n ho\u1eb7c \u0111\u1eb7t ng\u01b0\u1ee1ng r\u1ea5t cao thay v\u00ec block to\u00e0n b\u1ed9"},{"location":"ADR/adr-008-rate-limiting/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng gi\u1edbi h\u1ea1n (open): D\u1ec5 b\u1ecb l\u1ea1m d\u1ee5ng, kh\u00f4ng ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c l\u01b0u l\u01b0\u1ee3ng</li> <li>Ch\u1ec9 d\u00f9ng Cloud Armor: Kh\u00f4ng \u0111\u1ee7 linh ho\u1ea1t theo user/role/endpoint, kh\u00f3 \u0111i\u1ec1u ch\u1ec9nh \u0111\u1ed9ng</li> <li>Block to\u00e0n b\u1ed9 sau N l\u1ed7i: Kh\u00f4ng ph\u00e2n bi\u1ec7t intent, d\u1ec5 g\u00e2y b\u1ee9c x\u00fac ng\u01b0\u1eddi d\u00f9ng h\u1ee3p l\u1ec7</li> </ul>"},{"location":"ADR/adr-008-rate-limiting/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Middleware: <code>utils/rate_limiter.py</code></li> <li>Dev Guide \u2013 Security &amp; Throttling section: <code>DEV_GUIDE.md</code></li> <li>ADR tr\u01b0\u1edbc: <code>adr-007-error-handling.md</code></li> </ul> <p>\u201cKh\u00f4ng ph\u1ea3i ai c\u0169ng c\u1ea7n b\u1ecb gi\u1edbi h\u1ea1n \u2013 nh\u01b0ng ai c\u0169ng c\u1ea7n \u0111\u01b0\u1ee3c b\u1ea3o v\u1ec7 kh\u1ecfi l\u1ea1m d\u1ee5ng.\u201d</p>"},{"location":"ADR/adr-009-security-hardening/","title":"ADR-009: Chi\u1ebfn l\u01b0\u1ee3c t\u0103ng c\u01b0\u1eddng b\u1ea3o m\u1eadt (Security Hardening) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 23/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Tr\u1ea7n Th\u1ecb B (DevOps)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 \u0111i\u1ec3m \u0111\u1ea7u c\u1ee7a to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng backend. M\u1ecdi d\u1eef li\u1ec7u v\u00e0 thao t\u00e1c t\u1eeb ph\u00eda frontend \u0111\u1ec1u \u0111i qua \u0111\u00e2y. Vi\u1ec7c t\u0103ng c\u01b0\u1eddng b\u1ea3o m\u1eadt l\u00e0 b\u1eaft bu\u1ed9c \u0111\u1ec3:</p> <ul> <li>Ng\u0103n ch\u1eb7n t\u1ea5n c\u00f4ng ph\u1ed5 bi\u1ebfn (SQLi, XSS, CSRF, header injection\u2026)</li> <li>B\u1ea3o v\u1ec7 th\u00f4ng tin ng\u01b0\u1eddi d\u00f9ng (PII, token, d\u1eef li\u1ec7u h\u1ecdc sinh)</li> <li>Tu\u00e2n th\u1ee7 ti\u00eau chu\u1ea9n b\u1ea3o m\u1eadt n\u1ed9i b\u1ed9 v\u00e0 ng\u00e0nh gi\u00e1o d\u1ee5c</li> <li>Gi\u1ea3m thi\u1ec3u b\u1ec1 m\u1eb7t t\u1ea5n c\u00f4ng to\u00e0n h\u1ec7 th\u1ed1ng</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c Security Hardening to\u00e0n di\u1ec7n t\u1ea1i API Gateway, bao g\u1ed3m c\u00e1c l\u1edbp: transport, application, header, token/session, logging, dependency, v\u00e0 CI/CD.</p>"},{"location":"ADR/adr-009-security-hardening/#cac-lop-bao-ve-chinh","title":"\ud83d\udd10 C\u00e1c l\u1edbp b\u1ea3o v\u1ec7 ch\u00ednh","text":""},{"location":"ADR/adr-009-security-hardening/#1-transport-layer","title":"1. Transport Layer","text":"<ul> <li>Ch\u1ec9 ch\u1ea5p nh\u1eadn k\u1ebft n\u1ed1i qua HTTPS (b\u1eaft bu\u1ed9c Cloud Run HTTPS)</li> <li>T\u1eaft HTTP fallback n\u1ebfu d\u00f9ng Cloud Load Balancer</li> <li>D\u00f9ng TLS 1.2+ v\u00e0 Google-managed cert</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#2-application-layer-fastapi","title":"2. Application Layer (FastAPI)","text":"<ul> <li>Sanitize input: t\u1ea5t c\u1ea3 d\u1eef li\u1ec7u t\u1eeb body/query/header \u0111\u1ec1u \u0111\u01b0\u1ee3c ki\u1ec3m tra qua Pydantic</li> <li>Gi\u1edbi h\u1ea1n k\u00edch th\u01b0\u1edbc request body (upload, JSON...)</li> <li>T\u1ef1 \u0111\u1ed9ng t\u1eeb ch\u1ed1i content-type kh\u00f4ng h\u1ee3p l\u1ec7</li> <li>Nguy c\u01a1 CSRF hi\u1ec7n t\u1ea1i r\u1ea5t th\u1ea5p do s\u1eed d\u1ee5ng token-based auth, nh\u01b0ng n\u1ebfu trong t\u01b0\u01a1ng lai c\u00f3 endpoint nh\u1eadn form/cookie (\u0111\u1eb7c bi\u1ec7t trang admin), c\u1ea7n xem x\u00e9t b\u1ea3o v\u1ec7 CSRF token r\u00f5 r\u00e0ng</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#3-header-security","title":"3. Header Security","text":"<ul> <li> <p>Th\u00eam c\u00e1c header b\u1ea3o v\u1ec7 chu\u1ea9n OWASP:</p> </li> <li> <p><code>Strict-Transport-Security</code></p> </li> <li><code>X-Frame-Options: DENY</code></li> <li><code>X-Content-Type-Options: nosniff</code></li> <li><code>Referrer-Policy: no-referrer</code></li> <li><code>Permissions-Policy: geolocation=()</code></li> <li>(Optional n\u1ebfu c\u00f3 HTML content): <code>Content-Security-Policy</code></li> <li>Xo\u00e1 c\u00e1c header m\u1eb7c \u0111\u1ecbnh ti\u1ebft l\u1ed9 th\u00f4ng tin n\u1ed9i b\u1ed9: <code>server</code>, <code>x-powered-by</code></li> </ul>"},{"location":"ADR/adr-009-security-hardening/#4-token-session","title":"4. Token &amp; Session","text":"<ul> <li>B\u1eaft bu\u1ed9c <code>Authorization: Bearer &lt;token&gt;</code> v\u1edbi JWT access token</li> <li>Kh\u00f4ng bao gi\u1edd \u0111\u01b0a token l\u00ean URL (ch\u1ec9 g\u1eedi qua header)</li> <li>Refresh token \u0111\u01b0\u1ee3c m\u00e3 ho\u00e1 v\u00e0 l\u01b0u server-side (DB), c\u00f3 th\u1ec3 \u0111\u1eb7t trong HttpOnly cookie n\u1ebfu h\u1ed7 tr\u1ee3 web frontend</li> <li>Access Token n\u00ean l\u01b0u trong memory ho\u1eb7c sessionStorage, kh\u00f4ng d\u00f9ng localStorage \u0111\u1ec3 tr\u00e1nh XSS</li> <li>TTL access token ng\u1eafn (\\~15 ph\u00fat), refresh token c\u00f3 th\u1ec3 b\u1ecb revoke b\u1ea5t k\u1ef3 l\u00fac n\u00e0o</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#5-rate-limiting-ip-filter","title":"5. Rate limiting &amp; IP filter","text":"<ul> <li>\u00c1p d\u1ee5ng rate limiting (xem ADR-008)</li> <li>Cloud Armor ch\u1eb7n IP trong deny-list, ho\u1eb7c c\u00e1c v\u00f9ng \u0111\u1ecba l\u00fd b\u1ecb h\u1ea1n ch\u1ebf</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#6-logging-monitoring","title":"6. Logging &amp; Monitoring","text":"<ul> <li>Kh\u00f4ng log access token/refresh token trong b\u1ea5t k\u1ef3 context n\u00e0o</li> <li>G\u1eafn <code>request_id</code>, <code>user_id</code>, <code>path</code>, <code>status_code</code>, <code>latency_ms</code> cho m\u1ed7i request</li> <li>C\u1ea3nh b\u00e1o n\u1ebfu ph\u00e1t hi\u1ec7n truy c\u1eadp sai pattern, brute-force, t\u0103ng \u0111\u1ed9t bi\u1ebfn b\u1ea5t th\u01b0\u1eddng</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#7-dependency-image","title":"7. Dependency &amp; Image","text":"<ul> <li>Lock version <code>requirements.txt</code> v\u00e0 t\u00e1ch r\u00f5 <code>dev</code> vs <code>prod</code></li> <li>Qu\u00e9t b\u1ea3o m\u1eadt t\u1ef1 \u0111\u1ed9ng b\u1eb1ng <code>safety</code>, <code>bandit</code> trong CI</li> <li>D\u00f9ng <code>python:3.10-slim</code> ho\u1eb7c <code>distroless</code> l\u00e0m base image</li> <li>Multi-stage Docker build \u0111\u1ec3 gi\u1ea3m attack surface</li> <li>Scan image b\u1eb1ng <code>trivy</code> ho\u1eb7c Cloud Build Security Scanner</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#8-cicd-secrets","title":"8. CI/CD &amp; Secrets","text":"<ul> <li>D\u00f9ng Workload Identity Federation \u0111\u1ec3 tr\u00e1nh d\u00f9ng file service-account key</li> <li>Secrets qu\u1ea3n l\u00fd qua GitHub Secrets ho\u1eb7c GCP Secret Manager</li> <li>Kh\u00f4ng hard-code b\u1ea5t k\u1ef3 secret/token n\u00e0o trong codebase</li> <li>PR b\u1eaft bu\u1ed9c pass pre-commit, test, lint, security scan tr\u01b0\u1edbc khi deploy</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Gi\u1ea3m thi\u1ec3u r\u1ee7i ro b\u1ea3o m\u1eadt theo OWASP Top 10</li> <li>B\u1ea3o v\u1ec7 d\u1eef li\u1ec7u ng\u01b0\u1eddi d\u00f9ng v\u00e0 h\u1ec7 th\u1ed1ng backend \u1edf nhi\u1ec1u t\u1ea7ng</li> <li>T\u0103ng uy t\u00edn v\u00e0 \u0111\u1ed9 tin c\u1eady v\u1eadn h\u00e0nh cho h\u1ec7 th\u1ed1ng</li> <li>Chu\u1ea9n ho\u00e1 c\u00e1c ti\u00eau chu\u1ea9n n\u1ed9i b\u1ed9 v\u00e0 s\u1eb5n s\u00e0ng scale l\u1edbn</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p V\u00f4 t\u00ecnh ch\u1eb7n request h\u1ee3p l\u1ec7 Ghi log chi ti\u1ebft + allowlist t\u1ea1m th\u1eddi cho IP/token/debug n\u1ebfu c\u1ea7n Dependency l\u1ed7i b\u1ea3o m\u1eadt nh\u01b0ng ch\u01b0a \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt D\u00f9ng Dependabot + c\u1ea3nh b\u00e1o \u0111\u1ecbnh k\u1ef3 CI scan Secrets b\u1ecb log ra stdout \u0110\u1eb7t guard trong middleware log + CI ki\u1ec3m tra output tr\u01b0\u1edbc khi merge"},{"location":"ADR/adr-009-security-hardening/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng d\u00f9ng HTTPS \u1edf local: C\u00f3 th\u1ec3 ch\u1ea5p nh\u1eadn cho local dev, nh\u01b0ng staging &amp; prod lu\u00f4n y\u00eau c\u1ea7u HTTPS</li> <li>D\u00f9ng JWT ch\u1ee9a nhi\u1ec1u th\u00f4ng tin nh\u1ea1y c\u1ea3m (PII): Thay th\u1ebf b\u1eb1ng ID v\u00e0 l\u1ea5y th\u00f4ng tin theo th\u1eddi gian th\u1ef1c (RBAC)</li> <li>L\u01b0u access token trong localStorage: Chuy\u1ec3n sang l\u01b0u session ho\u1eb7c memory \u0111\u1ec3 gi\u1ea3m thi\u1ec3u XSS</li> </ul>"},{"location":"ADR/adr-009-security-hardening/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Middleware b\u1ea3o m\u1eadt: <code>utils/security_headers.py</code></li> <li>Dev Guide \u2013 Security section: <code>DEV_GUIDE.md</code></li> <li>ADR tr\u01b0\u1edbc: <code>adr-008-rate-limiting.md</code></li> </ul> <p>\u201cB\u1ea3o m\u1eadt kh\u00f4ng ph\u1ea3i l\u00e0 m\u1ed9t l\u1ef1a ch\u1ecdn \u2013 m\u00e0 l\u00e0 m\u1ed9t cam k\u1ebft l\u00e2u d\u00e0i.\u201d</p>"},{"location":"ADR/adr-010-deployment-strategy/","title":"ADR-010: Chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai (Deployment Strategy) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 24/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n V\u0103n L (DevOps)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 th\u00e0nh ph\u1ea7n trung t\u00e2m c\u1ee7a h\u1ec7 th\u1ed1ng, \u0111\u1ecbnh tuy\u1ebfn m\u1ecdi request frontend \u0111\u1ebfn c\u00e1c backend d\u1ecbch v\u1ee5 nh\u01b0 SIS, CRM, LMS. Vi\u1ec7c tri\u1ec3n khai thay \u0111\u1ed5i (deploy code m\u1edbi) c\u1ea7n \u0111\u1ea3m b\u1ea3o:</p> <ul> <li>Kh\u00f4ng g\u00e2y downtime cho ng\u01b0\u1eddi d\u00f9ng cu\u1ed1i</li> <li>Cho ph\u00e9p rollback nhanh khi c\u00f3 l\u1ed7i</li> <li>C\u00f3 th\u1ec3 th\u1eed nghi\u1ec7m b\u1ea3n m\u1edbi (canary) tr\u01b0\u1edbc khi rollout to\u00e0n b\u1ed9</li> <li>T\u1ef1 \u0111\u1ed9ng ho\u00e1 trong CI/CD nh\u01b0ng v\u1eabn an to\u00e0n ki\u1ec3m so\u00e1t</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai theo m\u00f4 h\u00ecnh Blue/Green k\u1ebft h\u1ee3p Canary rollout (cho staging/production) s\u1eed d\u1ee5ng Cloud Run revisions v\u00e0 traffic splitting.</p>"},{"location":"ADR/adr-010-deployment-strategy/#chi-tiet-trien-khai","title":"\ud83d\ude80 Chi ti\u1ebft tri\u1ec3n khai","text":""},{"location":"ADR/adr-010-deployment-strategy/#1-su-dung-cloud-run-revisions","title":"1. S\u1eed d\u1ee5ng Cloud Run Revisions","text":"<ul> <li>M\u1ed7i l\u1ea7n deploy t\u1ea1o 1 revision m\u1edbi (immutable)</li> <li>C\u00f3 th\u1ec3 truy c\u1eadp t\u1eebng revision b\u1eb1ng URL ri\u00eang (\u0111\u1ec3 ki\u1ec3m th\u1eed n\u1ed9i b\u1ed9)</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#2-canary-rollout-bang-traffic-splitting","title":"2. Canary rollout b\u1eb1ng traffic splitting","text":"<ul> <li> <p>Khi deploy staging ho\u1eb7c production:</p> </li> <li> <p>Giai \u0111o\u1ea1n 1: 5% traffic \u2192 revision m\u1edbi, 95% \u2192 stable</p> </li> <li> <p>Giai \u0111o\u1ea1n 2: sau 5 ph\u00fat, n\u1ebfu kh\u00f4ng c\u00f3 alert:</p> <ul> <li>50% traffic \u2192 revision m\u1edbi</li> <li>50% traffic \u2192 stable</li> <li>Giai \u0111o\u1ea1n 3: sau 10 ph\u00fat ti\u1ebfp theo kh\u00f4ng c\u00f3 l\u1ed7i \u2192 100% traffic chuy\u1ec3n sang revision m\u1edbi</li> <li>C\u00e1c ch\u1ec9 s\u1ed1 \u0111\u01b0\u1ee3c gi\u00e1m s\u00e1t trong m\u1ed7i giai \u0111o\u1ea1n:</li> </ul> </li> <li> <p>T\u1ef7 l\u1ec7 l\u1ed7i 5xx, 4xx b\u1ea5t th\u01b0\u1eddng qua Cloud Monitoring</p> </li> <li>Latency trung b\u00ecnh (p50/p90) kh\u00f4ng t\u0103ng &gt;30% so v\u1edbi baseline</li> <li>T\u1ef7 l\u1ec7 <code>429</code> ho\u1eb7c <code>RBAC denied</code> t\u0103ng b\u1ea5t th\u01b0\u1eddng</li> <li>C\u00f3 th\u1ec3 d\u1eebng rollout ho\u1eb7c revert b\u1eb1ng <code>gcloud run services update-traffic</code></li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#3-rollback-nhanh-bang-revision-stable","title":"3. Rollback nhanh b\u1eb1ng revision stable","text":"<ul> <li> <p>N\u1ebfu x\u1ea3y ra l\u1ed7i sau khi rollout:</p> </li> <li> <p>Revert ngay v\u1ec1 revision tr\u01b0\u1edbc \u0111\u00f3 (ch\u1ec9 1 l\u1ec7nh CLI ho\u1eb7c GitHub Action)</p> </li> <li>Kh\u00f4ng c\u1ea7n rebuild l\u1ea1i image, rollback trong v\u00e0i gi\u00e2y</li> <li>Log nguy\u00ean nh\u00e2n t\u1ef1 \u0111\u1ed9ng ghi nh\u1eadn t\u1eeb Alert \u0111\u00e3 k\u00edch ho\u1ea1t rollback (d\u1ef1a v\u00e0o <code>incident_id</code>, metric_name, revision_id)</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#4-trien-khai-staging-production","title":"4. Tri\u1ec3n khai staging \u2192 production","text":"<ul> <li>M\u1ed7i commit l\u00ean <code>dev</code> \u2192 build + deploy l\u00ean <code>staging</code></li> <li>Sau khi test xong + approve th\u1ee7 c\u00f4ng \u2192 merge v\u00e0o <code>main</code></li> <li><code>main</code> trigger deploy production + b\u1eaft \u0111\u1ea7u canary rollout</li> <li>Giai \u0111o\u1ea1n chuy\u1ec3n t\u1eeb 50% \u2192 100% c\u1ea7n approval manual step trong GitHub Actions \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o ki\u1ec3m so\u00e1t tuy\u1ec7t \u0111\u1ed1i tr\u01b0\u1edbc khi chuy\u1ec3n to\u00e0n b\u1ed9 l\u01b0u l\u01b0\u1ee3ng</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#5-canary-condition-successfail","title":"5. Canary condition (success/fail)","text":"<ul> <li> <p>Success n\u1ebfu:</p> </li> <li> <p>Kh\u00f4ng c\u00f3 alert 5xx/latency/4xx t\u0103ng b\u1ea5t th\u01b0\u1eddng</p> </li> <li>Latency kh\u00f4ng t\u0103ng &gt;30% so v\u1edbi baseline 1 gi\u1edd qua (so s\u00e1nh p50 v\u00e0 p90)</li> <li> <p>Fail n\u1ebfu:</p> </li> <li> <p>Alert &gt;5% l\u1ed7i trong 5 ph\u00fat</p> </li> <li>Canary b\u1ecb rollback t\u1ef1 \u0111\u1ed9ng + ghi nh\u1eadn alert trigger root cause</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Kh\u00f4ng downtime khi deploy</li> <li>Gi\u1ea3m r\u1ee7i ro s\u1ea3n xu\u1ea5t do rollout sai</li> <li>C\u00f3 th\u1ec3 ki\u1ec3m th\u1eed n\u1ed9i b\u1ed9 qua URL revision</li> <li>Rollback c\u1ef1c nhanh ch\u1ec9 v\u1edbi 1 command</li> <li>Ki\u1ec3m so\u00e1t rollout r\u00f5 r\u00e0ng qua approval workflow</li> <li>G\u1eafn ch\u1eb7t v\u1edbi CI/CD v\u00e0 Cloud Run native</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Canary rollout th\u1ea5t b\u1ea1i nh\u01b0ng alert ph\u00e1t hi\u1ec7n ch\u1eadm T\u1ed1i \u01b0u alert theo th\u1eddi gian th\u1ef1c (Cloud Monitoring) + refine metric &amp; SLO Rollback th\u1ee7 c\u00f4ng t\u1ed1n th\u1eddi gian Script rollback (<code>gcloud run services update-traffic</code>) + trigger GitHub Action rollback n\u1ebfu fail Kh\u00f3 theo d\u00f5i rollout ti\u1ebfn tr\u00ecnh Log chi ti\u1ebft tr\u1ea1ng th\u00e1i rollout + g\u1eedi Slack/email notification t\u1ef1 \u0111\u1ed9ng t\u1eeb CI/CD khi deploy/cutover"},{"location":"ADR/adr-010-deployment-strategy/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Recreate to\u00e0n b\u1ed9 service m\u1ed7i l\u1ea7n deploy: G\u00e2y downtime ng\u1eafn, rollback ch\u1eadm, kh\u00f4ng t\u1eadn d\u1ee5ng Cloud Run revision</li> <li>Manual deploy b\u1eb1ng <code>gcloud run deploy</code> m\u1ed7i l\u1ea7n: Kh\u00f4ng ph\u00f9 h\u1ee3p v\u1edbi CI/CD automation, d\u1ec5 sai s\u00f3t</li> <li>Blue/Green t\u00e1ch h\u1eb3n 2 service: Ph\u1ee9c t\u1ea1p trong qu\u1ea3n l\u00fd domain, SSL, IAM + t\u0103ng chi ph\u00ed</li> </ul>"},{"location":"ADR/adr-010-deployment-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>GitHub Actions CI/CD: <code>.github/workflows/ci.yml</code></li> <li>Cloud Run rollout: https://cloud.google.com/run/docs/deploying#rollbacks</li> <li>Dev Guide \u2013 CI/CD section: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-003-ci-cd-structure.md</code></li> </ul> <p>\u201cTri\u1ec3n khai an to\u00e0n l\u00e0 s\u1ef1 k\u1ebft h\u1ee3p gi\u1eefa t\u1ef1 \u0111\u1ed9ng h\u00f3a v\u00e0 ki\u1ec3m so\u00e1t th\u00f4ng minh.\u201d</p>"},{"location":"ADR/adr-011-secrets-rotation/","title":"ADR-011: Chi\u1ebfn l\u01b0\u1ee3c qu\u1ea3n l\u00fd v\u00e0 xoay v\u00f2ng secrets (Secrets Rotation) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 25/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Th\u1ecb H (Security Engineer)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway c\u1ea7n truy c\u1eadp nhi\u1ec1u h\u1ec7 th\u1ed1ng kh\u00e1c nh\u01b0 Cloud SQL, Redis, third-party API (Zalo, Google OAuth...), v\u00e0 CI/CD. Nh\u1eefng h\u1ec7 th\u1ed1ng n\u00e0y s\u1eed d\u1ee5ng c\u00e1c secrets nh\u01b0 access token, API key, database password ho\u1eb7c service account. \u0110\u1ec3 \u0111\u1ea3m b\u1ea3o an to\u00e0n l\u00e2u d\u00e0i, c\u1ea7n c\u00f3 chi\u1ebfn l\u01b0\u1ee3c qu\u1ea3n l\u00fd, l\u01b0u tr\u1eef v\u00e0 xoay v\u00f2ng (rotate) secrets \u0111\u1ecbnh k\u1ef3.</p>"},{"location":"ADR/adr-011-secrets-rotation/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c l\u01b0u tr\u1eef secrets t\u1eadp trung b\u1eb1ng Google Secret Manager k\u1ebft h\u1ee3p GitHub Secrets cho CI/CD, v\u00e0 \u0111\u1ecbnh k\u1ef3 xoay v\u00f2ng (rotation) t\u1ed1i thi\u1ec3u m\u1ed7i 90 ng\u00e0y ho\u1eb7c s\u1edbm h\u01a1n n\u1ebfu b\u1ecb l\u1ed9.</p>"},{"location":"ADR/adr-011-secrets-rotation/#chi-tiet-chien-luoc","title":"\ud83d\udd10 Chi ti\u1ebft chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-011-secrets-rotation/#1-luu-tru-secrets","title":"1. L\u01b0u tr\u1eef secrets","text":"<ul> <li>Secrets d\u00f9ng cho runtime l\u01b0u trong Google Secret Manager, \u0111\u01b0\u1ee3c inject tr\u1ef1c ti\u1ebfp v\u00e0o container Cloud Run th\u00f4ng qua c\u1ea5u h\u00ecnh service (khuy\u1ebfn ngh\u1ecb ch\u00ednh th\u1ee9c c\u1ee7a Google)</li> <li>Secrets d\u00f9ng cho CI/CD build-time (GitHub Actions) l\u01b0u trong GitHub Secrets</li> <li>Kh\u00f4ng commit b\u1ea5t k\u1ef3 secrets n\u00e0o v\u00e0o codebase, log ho\u1eb7c output pipeline</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#2-loai-secrets-ap-dung","title":"2. Lo\u1ea1i secrets \u00e1p d\u1ee5ng","text":"Lo\u1ea1i secrets V\u00ed d\u1ee5 DB password Cloud SQL user password API key Zalo, Firebase, OAuth2 credentials JWT secret Signing key cho access token Webhook secret Slack, Zalo outbound validation Redis password redis://:@host:port Service account GCP identity used for CI/CD auth (qua Workload Identity Federation)"},{"location":"ADR/adr-011-secrets-rotation/#3-cach-truy-xuat-tai-runtime","title":"3. C\u00e1ch truy xu\u1ea5t t\u1ea1i runtime","text":"<ul> <li>Secrets \u0111\u01b0\u1ee3c inject t\u1ef1 \u0111\u1ed9ng t\u1eeb Google Secret Manager v\u00e0o bi\u1ebfn m\u00f4i tr\u01b0\u1eddng c\u1ee7a container (qua Cloud Run service config)</li> <li>Kh\u00f4ng g\u1ecdi Secret Manager m\u1ed7i request (tr\u00e1nh \u1ea3nh h\u01b0\u1edfng hi\u1ec7u n\u0103ng/cost)</li> <li>Secrets c\u0169ng c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c mount v\u00e0o file ho\u1eb7c .env qua <code>gcloud secrets versions access</code> trong <code>prestart.sh</code> n\u1ebfu ch\u01b0a d\u00f9ng native Cloud Run secret integration</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#4-xoay-vong-rotation-policy","title":"4. Xoay v\u00f2ng (rotation policy)","text":"<ul> <li>Xoay v\u00f2ng m\u1eb7c \u0111\u1ecbnh m\u1ed7i 90 ng\u00e0y cho t\u1ea5t c\u1ea3 secrets (tu\u00e2n th\u1ee7 nguy\u00ean t\u1eafc zero-trust)</li> <li>M\u1ed9t s\u1ed1 secrets quan tr\u1ecdng nh\u01b0 JWT signing key \u2192 xoay m\u1ed7i 30 ng\u00e0y, h\u1ed7 tr\u1ee3 multi-version key (forward compatibility)</li> <li> <p>Cho ph\u00e9p xoay s\u1edbm khi:</p> </li> <li> <p>C\u00f3 thay \u0111\u1ed5i nh\u00e2n s\u1ef1 (offboarding)</p> </li> <li>Nghi ng\u1edd r\u00f2 r\u1ec9</li> <li>Key/API s\u1eafp h\u1ebft h\u1ea1n ho\u1eb7c b\u1ecb revoke</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#5-rotation-workflow","title":"5. Rotation workflow","text":"<ul> <li>Secrets m\u1edbi \u0111\u01b0\u1ee3c t\u1ea1o b\u1eb1ng CLI (<code>gcloud secrets versions add</code>) ho\u1eb7c Terraform</li> <li> <p>V\u1edbi runtime secrets:</p> </li> <li> <p>C\u1eadp nh\u1eadt <code>revision</code> c\u1ee7a Cloud Run \u0111\u1ec3 s\u1eed d\u1ee5ng phi\u00ean b\u1ea3n secret m\u1edbi</p> </li> <li>Deploy th\u00f4ng qua CI/CD ho\u1eb7c <code>gcloud run services update</code></li> <li> <p>V\u1edbi CI/CD secrets:</p> </li> <li> <p>C\u1eadp nh\u1eadt gi\u00e1 tr\u1ecb m\u1edbi trong GitHub Secrets ho\u1eb7c Secret Manager n\u1ebfu d\u00f9ng workload identity</p> </li> <li>C\u00f3 th\u1ec3 t\u1ef1 \u0111\u1ed9ng h\u00f3a rotation b\u1eb1ng Cloud Scheduler ho\u1eb7c CI bot cho m\u1ed9t s\u1ed1 lo\u1ea1i secrets (v\u00ed d\u1ee5: Cloud SQL auto-rotate + trigger pipeline)</li> <li>Sau khi rollout th\u00e0nh c\u00f4ng \u2192 v\u00f4 hi\u1ec7u h\u00f3a (disable) b\u1ea3n secret c\u0169 sau 24 gi\u1edd</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#6-giam-sat-alert","title":"6. Gi\u00e1m s\u00e1t &amp; alert","text":"<ul> <li>C\u1ea3nh b\u00e1o n\u1ebfu secret t\u1ed3n t\u1ea1i &gt;90 ng\u00e0y ch\u01b0a rotate</li> <li>Log m\u1ecdi truy c\u1eadp v\u00e0o secret trong Cloud Audit Logging</li> <li>Security bot CI ch\u1ea1y \u0111\u1ecbnh k\u1ef3 (tu\u1ea7n/l\u1ea7n) \u0111\u1ec3 c\u1ea3nh b\u00e1o secrets kh\u00f4ng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng ho\u1eb7c tr\u00f9ng nhau</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>B\u1ea3o v\u1ec7 kh\u1ecfi r\u1ee7i ro b\u1ecb r\u00f2 r\u1ec9 credentials l\u00e2u d\u00e0i</li> <li>Gi\u1ea3m r\u1ee7i ro l\u1ed7i con ng\u01b0\u1eddi qua quy tr\u00ecnh xoay v\u00f2ng t\u1ef1 \u0111\u1ed9ng h\u00f3a</li> <li>G\u1eafn li\u1ec1n v\u1edbi CI/CD, c\u00f3 th\u1ec3 ki\u1ec3m so\u00e1t v\u00e0 audit d\u1ec5 d\u00e0ng</li> <li>H\u1ed7 tr\u1ee3 rollback nhanh khi secret g\u00e2y l\u1ed7i</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Qu\u00ean c\u1eadp nh\u1eadt secret m\u1edbi v\u00e0o c\u1ea5u h\u00ecnh deploy T\u00edch h\u1ee3p check PR, Slack reminder, validate secrets tr\u01b0\u1edbc deploy Secret b\u1ecb log ra stdout ho\u1eb7c debug Ki\u1ec3m tra k\u1ef9 output pipeline, log masking, c\u1ea5m log gi\u00e1 tr\u1ecb c\u00f3 <code>SECRET</code>, <code>TOKEN</code>, <code>KEY</code> Secret m\u1edbi b\u1ecb l\u1ed7i runtime Lu\u00f4n rollout \u0111\u1ea7u ti\u00ean \u1edf <code>staging</code>, gi\u1eef secret c\u0169 ho\u1ea1t \u0111\u1ed9ng 24h \u0111\u1ec3 fallback n\u1ebfu c\u1ea7n"},{"location":"ADR/adr-011-secrets-rotation/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>L\u01b0u secrets trong <code>.env</code> commit trong Git: Kh\u00f4ng an to\u00e0n, kh\u00f4ng ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c quy\u1ec1n truy c\u1eadp</li> <li>L\u01b0u t\u1ea5t c\u1ea3 secrets trong GitHub Secrets: Thi\u1ebfu ph\u00e2n quy\u1ec1n runtime, kh\u00f4ng audit \u0111\u01b0\u1ee3c</li> <li>Kh\u00f4ng xoay v\u00f2ng: R\u1ee7i ro nghi\u00eam tr\u1ecdng n\u1ebfu secrets b\u1ecb l\u1ed9, kh\u00f4ng tu\u00e2n th\u1ee7 ti\u00eau chu\u1ea9n b\u1ea3o m\u1eadt ng\u00e0nh</li> </ul>"},{"location":"ADR/adr-011-secrets-rotation/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Secrets loading script (legacy fallback): <code>scripts/load_secrets.sh</code></li> <li>Dev Guide \u2013 Secrets &amp; Security: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-009-security-hardening.md</code></li> </ul> <p>\u201cKh\u00f4ng c\u00f3 secret n\u00e0o n\u00ean s\u1ed1ng m\u00e3i \u2013 m\u1ecdi credentials \u0111\u1ec1u c\u1ea7n \u0111\u01b0\u1ee3c thay th\u1ebf \u0111\u1ecbnh k\u1ef3.\u201d</p>"},{"location":"ADR/adr-012-audit-logging/","title":"ADR-012: Thi\u1ebft k\u1ebf h\u1ec7 th\u1ed1ng Audit Logging cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 26/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n V\u0103n H (Platform Architect)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway x\u1eed l\u00fd t\u1ea5t c\u1ea3 c\u00e1c lu\u1ed3ng truy c\u1eadp t\u1eeb frontend \u0111\u1ebfn backend. Ngo\u00e0i vi\u1ec7c log l\u1ed7i v\u00e0 ho\u1ea1t \u0111\u1ed9ng h\u1ec7 th\u1ed1ng (observability), c\u00f2n c\u1ea7n h\u1ec7 th\u1ed1ng Audit Logging ph\u1ee5c v\u1ee5 c\u00e1c m\u1ee5c \u0111\u00edch:</p> <ul> <li>Ghi nh\u1eadn h\u00e0nh vi truy c\u1eadp/thao t\u00e1c c\u1ee7a ng\u01b0\u1eddi d\u00f9ng cu\u1ed1i (user-level activity)</li> <li>Theo d\u00f5i c\u00e1c h\u00e0nh \u0111\u1ed9ng quan tr\u1ecdng (truy c\u1eadp d\u1eef li\u1ec7u h\u1ecdc sinh, c\u1eadp nh\u1eadt th\u00f4ng tin gi\u00e1o vi\u00ean...)</li> <li>\u0110\u00e1p \u1ee9ng y\u00eau c\u1ea7u ki\u1ec3m to\u00e1n n\u1ed9i b\u1ed9 ho\u1eb7c theo ti\u00eau chu\u1ea9n ng\u00e0nh gi\u00e1o d\u1ee5c</li> <li>Ph\u00e2n t\u00edch b\u1ea3o m\u1eadt khi c\u00f3 s\u1ef1 c\u1ed1 ho\u1eb7c nghi ng\u1edd truy c\u1eadp tr\u00e1i ph\u00e9p</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c Audit Logging t\u1eadp trung t\u1ea1i API Gateway b\u1eb1ng c\u00e1ch ghi l\u1ea1i c\u00f3 ch\u1ecdn l\u1ecdc c\u00e1c h\u00e0nh \u0111\u1ed9ng quan tr\u1ecdng, g\u1eedi v\u1ec1 Cloud Logging v\u00e0 h\u1ed7 tr\u1ee3 l\u01b0u tr\u1eef d\u00e0i h\u1ea1n n\u1ebfu c\u1ea7n.</p>"},{"location":"ADR/adr-012-audit-logging/#thiet-ke-he-thong-audit-log","title":"\ud83d\udee0 Thi\u1ebft k\u1ebf h\u1ec7 th\u1ed1ng Audit Log","text":""},{"location":"ADR/adr-012-audit-logging/#1-mo-hinh-log","title":"1. M\u00f4 h\u00ecnh log","text":"<ul> <li>M\u1ed7i log entry l\u00e0 m\u1ed9t JSON object v\u1edbi c\u00e1c tr\u01b0\u1eddng:</li> </ul> <pre><code>{\n  \"timestamp\": \"2025-05-26T10:45:00Z\",\n  \"request_id\": \"abc-123\",\n  \"user_id\": \"u_567\",\n  \"role\": \"teacher\",\n  \"ip\": \"203.113.1.5\",\n  \"action\": \"update_student\",\n  \"resource\": \"student/102\",\n  \"method\": \"PUT\",\n  \"status_code\": 200,\n  \"latency_ms\": 147,\n  \"source\": \"api-gateway\",\n  \"actor_type\": \"human\",\n  \"audit_level\": \"critical\"\n}\n</code></pre> <ul> <li><code>actor_type</code>: c\u00f3 th\u1ec3 l\u00e0 <code>human</code>, <code>service</code>, ho\u1eb7c <code>system</code></li> <li><code>resource</code>: theo \u0111\u1ecbnh d\u1ea1ng <code>{resource_type}/{resource_id}</code></li> </ul>"},{"location":"ADR/adr-012-audit-logging/#2-cac-loai-hanh-ong-can-audit","title":"2. C\u00e1c lo\u1ea1i h\u00e0nh \u0111\u1ed9ng c\u1ea7n audit","text":"Lo\u1ea1i h\u00e0nh \u0111\u1ed9ng V\u00ed d\u1ee5 Truy c\u1eadp d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m GET student, GET grades Thay \u0111\u1ed5i th\u00f4ng tin PUT/PATCH student/teacher T\u00e1c v\u1ee5 h\u1ec7 th\u1ed1ng \u0110\u0103ng nh\u1eadp, \u0111\u1ed5i m\u1eadt kh\u1ea9u, ph\u00e2n quy\u1ec1n G\u1ecdi API outbound quan tr\u1ecdng G\u1eedi th\u00f4ng b\u00e1o, g\u1eedi d\u1eef li\u1ec7u \u0111\u1ebfn CRM Thay \u0111\u1ed5i c\u1ea5u h\u00ecnh b\u1ea3o m\u1eadt S\u1eeda RBAC, s\u1eeda limit c\u1ea5u h\u00ecnh (n\u1ebfu qua API)"},{"location":"ADR/adr-012-audit-logging/#3-tich-hop-tai-api-gateway","title":"3. T\u00edch h\u1ee3p t\u1ea1i API Gateway","text":"<ul> <li> <p>Middleware x\u1eed l\u00fd tr\u01b0\u1edbc v\u00e0 sau khi request \u0111\u01b0\u1ee3c forward \u0111\u1ebfn backend:</p> </li> <li> <p>Tr\u01b0\u1edbc: ph\u00e2n t\u00edch method, path, role, RBAC \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh c\u1ea7n audit</p> </li> <li>Sau: ghi log audit \u0111\u1ea7y \u0111\u1ee7 k\u00e8m <code>status_code</code>, <code>latency_ms</code></li> <li>G\u1eedi log ra stdout d\u01b0\u1edbi \u0111\u1ecbnh d\u1ea1ng JSON \u2192 Cloud Logging ingest t\u1ef1 \u0111\u1ed9ng</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#4-audit-level","title":"4. Audit Level","text":"<ul> <li><code>critical</code>: thao t\u00e1c ghi nh\u1ea1y c\u1ea3m (PUT, DELETE, ph\u00e2n quy\u1ec1n...)</li> <li><code>info</code>: thao t\u00e1c xem th\u00f4ng tin nh\u01b0ng c\u00f3 d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m</li> <li><code>debug</code>: thao t\u00e1c API ph\u1ee5, ch\u1ec9 log n\u1ebfu b\u1eadt debug</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#5-truy-van-va-luu-tru","title":"5. Truy v\u1ea5n v\u00e0 l\u01b0u tr\u1eef","text":"<ul> <li>Truy v\u1ea5n log qua Cloud Logging ho\u1eb7c xu\u1ea5t ra BigQuery \u0111\u1ec3 ph\u00e2n t\u00edch n\u00e2ng cao</li> <li> <p>L\u01b0u tr\u1eef:</p> </li> <li> <p>Cloud Logging: t\u1ed1i thi\u1ec3u 180 ng\u00e0y</p> </li> <li>Long-term: GCS ho\u1eb7c BigQuery t\u1eeb 1\u20133 n\u0103m theo y\u00eau c\u1ea7u ki\u1ec3m to\u00e1n</li> <li> <p>\u0110\u1ea3m b\u1ea3o t\u00ednh to\u00e0n v\u1eb9n log:</p> </li> <li> <p>Log kh\u00f4ng th\u1ec3 b\u1ecb ch\u1ec9nh s\u1eeda th\u1ee7 c\u00f4ng</p> </li> <li>C\u00f3 th\u1ec3 t\u00edch h\u1ee3p WORM storage ho\u1eb7c k\u00fd s\u1ed1 t\u1eebng d\u00f2ng log n\u1ebfu c\u1ea7n tu\u00e2n th\u1ee7 nghi\u00eam ng\u1eb7t</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#6-quyen-truy-cap-audit-log","title":"6. Quy\u1ec1n truy c\u1eadp audit log","text":"<ul> <li>Ch\u1ec9 nh\u00f3m Platform Admin ho\u1eb7c Security Engineer \u0111\u01b0\u1ee3c truy c\u1eadp log \u0111\u1ea7y \u0111\u1ee7</li> <li> <p>Ph\u00e2n quy\u1ec1n chi ti\u1ebft:</p> </li> <li> <p><code>log.reader.system</code>: xem log k\u1ef9 thu\u1eadt</p> </li> <li><code>log.reader.audit</code>: xem h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng</li> <li>Audit c\u1ea3 h\u00e0nh \u0111\u1ed9ng truy c\u1eadp v\u00e0o Audit Log (Cloud Logging h\u1ed7 tr\u1ee3)</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ghi nh\u1eadn r\u00f5 h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng v\u00e0 thay \u0111\u1ed5i h\u1ec7 th\u1ed1ng quan tr\u1ecdng</li> <li>H\u1ed7 tr\u1ee3 \u0111i\u1ec1u tra, ph\u1ea3n \u1ee9ng b\u1ea3o m\u1eadt, v\u00e0 ph\u00e2n t\u00edch root cause nhanh ch\u00f3ng</li> <li>Tu\u00e2n th\u1ee7 c\u00e1c quy \u0111\u1ecbnh n\u1ed9i b\u1ed9 v\u00e0 b\u00ean ngo\u00e0i (GDPR, ki\u1ec3m to\u00e1n ng\u00e0nh gi\u00e1o d\u1ee5c...)</li> <li>\u0110\u1ea3m b\u1ea3o audit kh\u00f4ng ph\u1ee5 thu\u1ed9c backend, t\u1eadp trung t\u1ea1i \u0111i\u1ec3m trung gian</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Log qu\u00e1 nhi\u1ec1u \u2192 g\u00e2y noise Ch\u1ec9 audit h\u00e0nh vi theo danh s\u00e1ch cho ph\u00e9p, audit_level r\u00f5 r\u00e0ng Log ch\u1ee9a d\u1eef li\u1ec7u nh\u1ea1y c\u1ea3m Kh\u00f4ng log payload, ch\u1ec9 log ID/t\u00ean field; hash n\u1ebfu c\u1ea7n x\u00e1c minh Truy c\u1eadp tr\u00e1i ph\u00e9p log audit T\u00e1ch vai tr\u00f2, logging truy c\u1eadp log, principle of least privilege"},{"location":"ADR/adr-012-audit-logging/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Ch\u1ec9 audit \u1edf backend: kh\u00f4ng ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c to\u00e0n b\u1ed9 h\u00e0nh vi, thi\u1ebfu th\u00f4ng tin n\u1ebfu b\u1ecb ch\u1eb7n b\u1edfi RBAC t\u1eeb gateway</li> <li>G\u1ed9p audit v\u00e0o log h\u1ec7 th\u1ed1ng: g\u00e2y l\u1eabn l\u1ed9n, kh\u00f3 filter &amp; kh\u00f4ng h\u1ed7 tr\u1ee3 ph\u00e2n quy\u1ec1n ri\u00eang</li> </ul>"},{"location":"ADR/adr-012-audit-logging/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Middleware: <code>utils/audit_logger.py</code></li> <li>Dev Guide \u2013 Logging Strategy: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-005-observability.md</code></li> </ul> <p>\u201c\u0110\u1eebng ch\u1ec9 log h\u1ec7 th\u1ed1ng \u2013 h\u00e3y log h\u00e0nh vi ng\u01b0\u1eddi d\u00f9ng quan tr\u1ecdng \u0111\u1ec3 b\u1ea3o v\u1ec7 h\u1ecd v\u00e0 ch\u00ednh b\u1ea1n.\u201d</p>"},{"location":"ADR/adr-013-autoscaling-strategy/","title":"ADR-013: Chi\u1ebfn l\u01b0\u1ee3c autoscaling cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 27/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Minh T (Infrastructure Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 \u0111i\u1ec3m \u0111\u1ea7u ti\u1ebfp nh\u1eadn to\u00e0n b\u1ed9 l\u01b0u l\u01b0\u1ee3ng t\u1eeb frontend v\u00e0 \u0111\u1ecbnh tuy\u1ebfn \u0111\u1ebfn backend. L\u01b0u l\u01b0\u1ee3ng c\u00f3 th\u1ec3 bi\u1ebfn \u0111\u1ed9ng m\u1ea1nh theo th\u1eddi \u0111i\u1ec3m (gi\u1edd cao \u0111i\u1ec3m, nh\u1eadp h\u1ecdc, chi\u1ebfn d\u1ecbch truy\u1ec1n th\u00f4ng...). \u0110\u1ec3 \u0111\u1ea3m b\u1ea3o t\u00ednh s\u1eb5n s\u00e0ng, hi\u1ec7u n\u0103ng v\u00e0 t\u1ed1i \u01b0u chi ph\u00ed, c\u1ea7n c\u00f3 chi\u1ebfn l\u01b0\u1ee3c autoscaling linh ho\u1ea1t, ph\u1ea3n \u1ee9ng nhanh v\u00e0 ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c.</p>"},{"location":"ADR/adr-013-autoscaling-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Tri\u1ec3n khai autoscaling d\u1ef1a tr\u00ean Cloud Run v\u1edbi c\u00e1c th\u00f4ng s\u1ed1 tinh ch\u1ec9nh c\u1ee5 th\u1ec3, k\u1ebft h\u1ee3p scaling theo concurrency v\u00e0 alert-based pre-scaling.</p>"},{"location":"ADR/adr-013-autoscaling-strategy/#cau-hinh-autoscaling-chi-tiet","title":"\u2699\ufe0f C\u1ea5u h\u00ecnh autoscaling chi ti\u1ebft","text":""},{"location":"ADR/adr-013-autoscaling-strategy/#1-nen-tang-cloud-run-fully-managed","title":"1. N\u1ec1n t\u1ea3ng: Cloud Run (fully managed)","text":"<ul> <li>T\u1ef1 \u0111\u1ed9ng scale-out instance khi c\u00f3 nhi\u1ec1u request \u0111\u1ed3ng th\u1eddi</li> <li>T\u1ef1 \u0111\u1ed9ng scale-in khi idle, ti\u1ebft ki\u1ec7m chi ph\u00ed</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#2-tham-so-chinh","title":"2. Tham s\u1ed1 ch\u00ednh","text":"Tham s\u1ed1 Gi\u00e1 tr\u1ecb \u0111\u1ec1 xu\u1ea5t <code>max-instances</code> 50 (c\u00f3 th\u1ec3 n\u00e2ng l\u00ean theo nhu c\u1ea7u) <code>min-instances</code> 1 (gi\u1eef \u1ea5m 1 pod, tr\u00e1nh cold start) <code>concurrency</code> 40 request/instance (gi\u00e1 tr\u1ecb kh\u1edfi \u0111\u1ea7u ph\u00f9 h\u1ee3p I/O-bound, c\u1ea7n \u0111\u01b0\u1ee3c tinh ch\u1ec9nh d\u1ef1a tr\u00ean k\u1ebft qu\u1ea3 load testing th\u1ef1c t\u1ebf) <code>cpu-throttling</code> disabled (gi\u1eef CPU active cho min instance)"},{"location":"ADR/adr-013-autoscaling-strategy/#3-pre-scaling-theo-canh-bao-alert-based-burst-prep","title":"3. Pre-scaling theo c\u1ea3nh b\u00e1o (alert-based burst prep)","text":"<ul> <li>N\u1ebfu l\u01b0\u1ee3ng request &gt; 80% t\u1ed5ng capacity trong 2 ph\u00fat \u2192 t\u0103ng <code>min-instances</code> t\u1ea1m th\u1eddi (qua script ho\u1eb7c GitHub Actions)</li> <li>N\u1ebfu c\u00f3 l\u1ecbch cao \u0111i\u1ec3m d\u1ef1 \u0111o\u00e1n (v\u00ed d\u1ee5: 8h s\u00e1ng th\u1ee9 2) \u2192 t\u0103ng min tr\u01b0\u1edbc 15 ph\u00fat</li> <li>Qu\u1ea3n l\u00fd qua <code>gcloud run services update</code> ho\u1eb7c th\u00f4ng qua Terraform k\u1ebft h\u1ee3p v\u1edbi scheduler/bot \u0111\u1ec3 gi\u1eef tr\u1ea1ng th\u00e1i h\u1ea1 t\u1ea7ng nh\u1ea5t qu\u00e1n</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#4-han-che-va-fallback","title":"4. H\u1ea1n ch\u1ebf v\u00e0 fallback","text":"<ul> <li>N\u1ebfu \u0111\u1ea1t <code>max-instances</code>, Cloud Run s\u1ebd tr\u1ea3 429</li> <li>H\u1ec7 th\u1ed1ng log + alert n\u1ebfu rate 429 &gt; 1% trong 5 ph\u00fat</li> <li>Cho ph\u00e9p m\u1edf r\u1ed9ng <code>max-instances</code> qua Alert Policy ho\u1eb7c dashboard th\u1ee7 c\u00f4ng nhanh ch\u00f3ng</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#5-giam-sat-va-thu-nghiem-chien-luoc","title":"5. Gi\u00e1m s\u00e1t v\u00e0 th\u1eed nghi\u1ec7m chi\u1ebfn l\u01b0\u1ee3c","text":"<ul> <li>S\u1eed d\u1ee5ng load testing \u0111\u1ecbnh k\u1ef3 \u0111\u1ec3 \u0111\u00e1nh gi\u00e1 ph\u1ea3n \u1ee9ng autoscaling</li> <li>Theo d\u00f5i metric: <code>container/busy_request_count</code>, <code>concurrent_requests</code>, <code>cold_start_duration</code></li> <li>Tinh ch\u1ec9nh <code>concurrency</code>, <code>min/max-instances</code> d\u1ef1a tr\u00ean d\u1eef li\u1ec7u th\u1ef1c t\u1ebf</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>\u0110\u00e1p \u1ee9ng l\u01b0u l\u01b0\u1ee3ng bi\u1ebfn \u0111\u1ed9ng m\u1ea1nh m\u00e0 kh\u00f4ng c\u1ea7n scale th\u1ee7 c\u00f4ng</li> <li>T\u1ed1i \u01b0u chi ph\u00ed (ch\u1ec9 duy tr\u00ec s\u1ed1 l\u01b0\u1ee3ng instance t\u1ed1i thi\u1ec3u c\u1ea7n thi\u1ebft, c\u00f3 th\u1ec3 scale xu\u1ed1ng 1 instance khi idle)</li> <li>Gi\u1ea3m cold-start nh\u1edd <code>min-instances</code></li> <li>T\u1ef1 \u0111\u1ed9ng ph\u1ea3n \u1ee9ng v\u1edbi traffic \u0111\u1ed9t bi\u1ebfn qua Alert pre-scaling</li> <li>H\u1ea1 t\u1ea7ng serverless \u0111\u01a1n gi\u1ea3n nh\u01b0ng hi\u1ec7u qu\u1ea3 cao</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Cold start g\u00e2y tr\u1ec5 request \u0111\u1ea7u ti\u00ean Duy tr\u00ec <code>min-instances: 1</code>, gi\u1eef CPU active v\u00e0 theo d\u00f5i th\u1eddi gian cold start \u0110\u1ea1t tr\u1ea7n <code>max-instances</code> qu\u00e1 s\u1edbm Theo d\u00f5i alert + t\u1ef1 \u0111\u1ed9ng t\u0103ng gi\u1edbi h\u1ea1n qua Terraform ho\u1eb7c CLI khi c\u1ea7n Autoscaling kh\u00f4ng ph\u1ea3n \u1ee9ng k\u1ecbp v\u1edbi burst ng\u1eafn D\u00f9ng Alert-based pre-scaling + h\u1ecdc l\u1ecbch s\u1eed traffic \u0111\u1ec3 ch\u1ee7 \u0111\u1ed9ng t\u0103ng min tr\u01b0\u1edbc"},{"location":"ADR/adr-013-autoscaling-strategy/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>GKE / Kubernetes HPA: Qu\u1ea3n l\u00fd ph\u1ee9c t\u1ea1p h\u01a1n, kh\u00f4ng c\u1ea7n thi\u1ebft v\u1edbi Gateway stateless</li> <li>Always-on fixed pod count: T\u1ed1n chi ph\u00ed, kh\u00f4ng t\u1eadn d\u1ee5ng \u0111\u01b0\u1ee3c serverless</li> <li>Manual scaling: Ph\u1ea3n \u1ee9ng ch\u1eadm, kh\u00f4ng ph\u00f9 h\u1ee3p h\u1ec7 th\u1ed1ng real-time traffic bi\u1ebfn \u0111\u1ed9ng</li> </ul>"},{"location":"ADR/adr-013-autoscaling-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Cloud Run autoscaling: https://cloud.google.com/run/docs/about-autoscaling</li> <li>Script pre-scaling: <code>scripts/pre_scale.sh</code></li> <li>Dev Guide \u2013 Deployment: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-010-deployment-strategy.md</code></li> </ul> <p>\u201cAutoscaling kh\u00f4ng ch\u1ec9 l\u00e0 m\u1edf r\u1ed9ng \u2013 m\u00e0 l\u00e0 ph\u1ea3n \u1ee9ng th\u00f4ng minh v\u1edbi s\u1ef1 thay \u0111\u1ed5i.\u201d</p>"},{"location":"ADR/adr-014-multi-env-config/","title":"ADR-014: Chi\u1ebfn l\u01b0\u1ee3c c\u1ea5u h\u00ecnh \u0111a m\u00f4i tr\u01b0\u1eddng (Multi-Environment Configuration) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 28/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Th\u1ecb D (DevOps)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway c\u1ea7n ho\u1ea1t \u0111\u1ed9ng \u1ed5n \u0111\u1ecbnh tr\u00ean nhi\u1ec1u m\u00f4i tr\u01b0\u1eddng kh\u00e1c nhau (dev, staging, production) v\u1edbi c\u1ea5u h\u00ecnh ph\u00f9 h\u1ee3p t\u1eebng m\u1ee5c \u0111\u00edch. C\u00e1c th\u00f4ng s\u1ed1 nh\u01b0 endpoint backend, bi\u1ebfn m\u00f4i tr\u01b0\u1eddng, database URL, JWT key, logging level... s\u1ebd kh\u00e1c nhau gi\u1eefa c\u00e1c m\u00f4i tr\u01b0\u1eddng.</p> <p>Vi\u1ec7c qu\u1ea3n l\u00fd c\u1ea5u h\u00ecnh \u0111a m\u00f4i tr\u01b0\u1eddng c\u1ea7n:</p> <ul> <li>T\u00e1ch bi\u1ec7t r\u00f5 c\u1ea5u h\u00ecnh t\u1eebng m\u00f4i tr\u01b0\u1eddng</li> <li>Kh\u00f4ng hard-code gi\u00e1 tr\u1ecb theo m\u00f4i tr\u01b0\u1eddng v\u00e0o m\u00e3 ngu\u1ed3n</li> <li>D\u1ec5 t\u00edch h\u1ee3p v\u1edbi CI/CD, Cloud Run, v\u00e0 Terraform</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c c\u1ea5u h\u00ecnh \u0111a m\u00f4i tr\u01b0\u1eddng b\u1eb1ng c\u00e1ch ph\u00e2n t\u00e1ch c\u1ea5u h\u00ecnh theo profile (env), s\u1eed d\u1ee5ng bi\u1ebfn m\u00f4i tr\u01b0\u1eddng v\u00e0 secrets \u0111\u01b0\u1ee3c inject th\u00f4ng qua GitHub Actions, Google Secret Manager ho\u1eb7c Terraform khi deploy l\u00ean Cloud Run.</p>"},{"location":"ADR/adr-014-multi-env-config/#thiet-ke","title":"\ud83d\udee0 Thi\u1ebft k\u1ebf","text":""},{"location":"ADR/adr-014-multi-env-config/#1-cau-truc-thu-muc-cau-hinh-cho-local-dev-va-ci-build-time","title":"1. C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c c\u1ea5u h\u00ecnh (cho local dev v\u00e0 CI build-time)","text":"<pre><code>/config\n  \u251c\u2500\u2500 base.env\n  \u251c\u2500\u2500 dev.env\n  \u251c\u2500\u2500 staging.env\n  \u2514\u2500\u2500 prod.env\n</code></pre> <ul> <li><code>base.env</code>: c\u1ea5u h\u00ecnh m\u1eb7c \u0111\u1ecbnh d\u00f9ng chung</li> <li><code>*.env</code>: override theo t\u1eebng m\u00f4i tr\u01b0\u1eddng c\u1ee5 th\u1ec3</li> <li>C\u00e1c file <code>.env</code> n\u00e0y kh\u00f4ng \u0111\u01b0\u1ee3c build v\u00e0o Docker image, ch\u1ec9 d\u00f9ng \u0111\u1ec3 h\u1ed7 tr\u1ee3 local development ho\u1eb7c \u0111\u1ec3 CI/CD pipeline load v\u00e0 inject ch\u00ednh x\u00e1c bi\u1ebfn m\u00f4i tr\u01b0\u1eddng khi deploy</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#2-bien-moi-truong-quan-trong","title":"2. Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng quan tr\u1ecdng","text":"Key M\u00f4 t\u1ea3 ENV dev / staging / prod LOG_LEVEL debug / info / warning BACKEND_URL_SIS URL k\u1ebft n\u1ed1i t\u1edbi SIS service JWT_SECRET Secret d\u00f9ng \u0111\u1ec3 k\u00fd JWT RATE_LIMIT_PER_MIN S\u1ed1 request cho ph\u00e9p / user / ph\u00fat"},{"location":"ADR/adr-014-multi-env-config/#3-cach-nap-cau-hinh","title":"3. C\u00e1ch n\u1ea1p c\u1ea5u h\u00ecnh","text":"<ul> <li>App s\u1eed d\u1ee5ng th\u01b0 vi\u1ec7n nh\u01b0 <code>pydantic-settings</code> ho\u1eb7c <code>python-dotenv</code></li> <li> <p>Th\u1ee9 t\u1ef1 \u01b0u ti\u00ean c\u1ea5u h\u00ecnh:</p> </li> <li> <p>Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng h\u1ec7 th\u1ed1ng (Cloud Run inject ho\u1eb7c Terraform inject)</p> </li> <li>File <code>.env</code> n\u1ebfu c\u00f3 (d\u00e0nh cho local dev)</li> <li>Gi\u00e1 tr\u1ecb m\u1eb7c \u0111\u1ecbnh trong code (base config)</li> <li> <p>Khi deploy l\u00ean Cloud Run:</p> </li> <li> <p>Bi\u1ebfn m\u00f4i tr\u01b0\u1eddng \u0111\u01b0\u1ee3c inject qua GitHub Actions, <code>gcloud run deploy</code>, ho\u1eb7c Terraform (preferred \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o IaC)</p> </li> <li>Secrets nh\u01b0 <code>JWT_SECRET</code>, <code>DB_PASSWORD</code> \u0111\u01b0\u1ee3c inject t\u1eeb Google Secret Manager, theo m\u00f4i tr\u01b0\u1eddng t\u01b0\u01a1ng \u1ee9ng</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#4-tich-hop-cicd","title":"4. T\u00edch h\u1ee3p CI/CD","text":"<ul> <li> <p>Workflow GitHub Actions x\u00e1c \u0111\u1ecbnh m\u00f4i tr\u01b0\u1eddng qua branch ho\u1eb7c tag:</p> </li> <li> <p><code>dev</code> \u2192 <code>ENV=dev</code></p> </li> <li><code>main</code> \u2192 <code>ENV=prod</code></li> <li>Pipeline \u0111\u1ecdc <code>.env</code> t\u01b0\u01a1ng \u1ee9ng (ch\u1ec9 ch\u1ee9a non-secret) ho\u1eb7c inject bi\u1ebfn tr\u1ef1c ti\u1ebfp</li> <li>Secrets staging/prod kh\u00f4ng \u0111\u01b0\u1ee3c log ho\u1eb7c output ra artifact</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#5-kiem-soat-cau-hinh-an-toan","title":"5. Ki\u1ec3m so\u00e1t c\u1ea5u h\u00ecnh an to\u00e0n","text":"<ul> <li>Validate c\u1ea5u h\u00ecnh b\u1eb1ng schema (<code>pydantic.BaseSettings</code>)</li> <li>Secrets kh\u00f4ng \u0111\u01b0\u1ee3c l\u01b0u trong <code>.env</code>, d\u00f9ng placeholder nh\u01b0 <code>JWT_SECRET=__INJECTED__</code></li> <li>IAM c\u1ee7a Secret Manager t\u00e1ch ri\u00eang theo m\u00f4i tr\u01b0\u1eddng</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#6-quy-uoc-phan-biet-hanh-vi-theo-moi-truong","title":"6. Quy \u01b0\u1edbc ph\u00e2n bi\u1ec7t h\u00e0nh vi theo m\u00f4i tr\u01b0\u1eddng","text":"<ul> <li>Debug tool, OpenAPI docs ch\u1ec9 b\u1eadt n\u1ebfu <code>ENV != prod</code></li> <li> <p>Logging:</p> </li> <li> <p><code>dev</code>: log \u0111\u1ea7y \u0111\u1ee7 <code>debug</code></p> </li> <li><code>prod</code>: ch\u1ec9 log <code>warning</code> tr\u1edf l\u00ean</li> <li> <p>CORS:</p> </li> <li> <p><code>dev</code>: <code>*</code></p> </li> <li><code>prod/staging</code>: ch\u1ec9 cho ph\u00e9p domain c\u1ee5 th\u1ec3</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>C\u1ea5u h\u00ecnh r\u00f5 r\u00e0ng, d\u1ec5 ki\u1ec3m so\u00e1t theo t\u1eebng m\u00f4i tr\u01b0\u1eddng</li> <li>Kh\u00f4ng ph\u1ee5 thu\u1ed9c code branch logic ph\u1ee9c t\u1ea1p</li> <li>Secrets \u0111\u01b0\u1ee3c t\u00e1ch bi\u1ec7t v\u00e0 qu\u1ea3n l\u00fd an to\u00e0n</li> <li>CI/CD d\u1ec5 tri\u1ec3n khai, kh\u00f4ng r\u00f2 r\u1ec9 gi\u00e1 tr\u1ecb nh\u1ea1y c\u1ea3m</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Nh\u1ea7m bi\u1ebfn m\u00f4i tr\u01b0\u1eddng khi deploy CI/CD log r\u00f5 <code>ENV</code>, \u0111\u1eb7t tag revision r\u00f5 r\u00e0ng (vd: <code>vas-api-gw:staging-2025-05-28</code>) Secrets sai m\u00f4i tr\u01b0\u1eddng T\u00e1ch Secret theo m\u00f4i tr\u01b0\u1eddng, ph\u00e2n quy\u1ec1n IAM r\u00f5 r\u00e0ng <code>.env</code> b\u1ecb commit nh\u1ea7m <code>.gitignore</code>, CI hook + scan check tr\u01b0\u1edbc khi merge"},{"location":"ADR/adr-014-multi-env-config/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Hard-code c\u1ea5u h\u00ecnh trong m\u00e3 ngu\u1ed3n: Kh\u00f4ng audit \u0111\u01b0\u1ee3c, kh\u00f3 maintain</li> <li>D\u00f9ng chung secret cho m\u1ecdi m\u00f4i tr\u01b0\u1eddng: R\u1ea5t r\u1ee7i ro, xoay v\u00f2ng kh\u00f4ng linh ho\u1ea1t</li> <li>Ch\u1ec9 d\u00f9ng GitHub Secrets cho m\u1ecdi bi\u1ebfn: Kh\u00f4ng \u0111\u1ee7 cho runtime, kh\u00f3 ph\u00e2n quy\u1ec1n chi ti\u1ebft</li> </ul>"},{"location":"ADR/adr-014-multi-env-config/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>C\u1ea5u h\u00ecnh base: <code>config/base.env</code></li> <li>Dev Guide \u2013 Configuration section: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-011-secrets-rotation.md</code></li> </ul> <p>\u201cM\u1ed9t m\u00f4i tr\u01b0\u1eddng, m\u1ed9t c\u1ea5u h\u00ecnh \u2013 t\u00e1ch bi\u1ec7t r\u00f5 r\u00e0ng \u0111\u1ec3 v\u1eadn h\u00e0nh an to\u00e0n.\u201d</p>"},{"location":"ADR/adr-015-cost-observability/","title":"ADR-015: Chi\u1ebfn l\u01b0\u1ee3c quan s\u00e1t chi ph\u00ed v\u1eadn h\u00e0nh (Cost Observability Strategy) cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 29/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n V\u0103n B (FinOps + DevOps)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway v\u1eadn h\u00e0nh tr\u00ean n\u1ec1n t\u1ea3ng Cloud Run v\u00e0 s\u1eed d\u1ee5ng c\u00e1c t\u00e0i nguy\u00ean li\u00ean quan nh\u01b0:</p> <ul> <li>Redis (memory store)</li> <li>Cloud Logging / Monitoring</li> <li>Secret Manager, IAM, v\u00e0 g\u1ecdi \u0111\u1ebfn c\u00e1c backend nh\u01b0 SIS, CRM, LMS</li> </ul> <p>Chi ph\u00ed c\u00f3 th\u1ec3 t\u0103ng \u0111\u1ed9t bi\u1ebfn n\u1ebfu kh\u00f4ng \u0111\u01b0\u1ee3c gi\u00e1m s\u00e1t. V\u00ec v\u1eady, c\u1ea7n c\u00f3 chi\u1ebfn l\u01b0\u1ee3c Cost Observability gi\u00fap:</p> <ul> <li>Hi\u1ec3u r\u00f5 chi ph\u00ed theo m\u00f4i tr\u01b0\u1eddng, th\u00e0nh ph\u1ea7n, t\u00ednh n\u0103ng</li> <li>C\u1ea3nh b\u00e1o s\u1edbm khi chi ph\u00ed v\u01b0\u1ee3t ng\u01b0\u1ee1ng b\u1ea5t th\u01b0\u1eddng</li> <li>H\u1ed7 tr\u1ee3 t\u1ed1i \u01b0u h\u00f3a h\u1ea1 t\u1ea7ng, autoscaling v\u00e0 usage pattern</li> <li>\u0110\u00e1p \u1ee9ng y\u00eau c\u1ea7u t\u1eeb CTO, t\u00e0i ch\u00ednh, v\u00e0 b\u1ea3o v\u1ec7 ng\u00e2n s\u00e1ch k\u1ef9 thu\u1eadt</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c Cost Observability to\u00e0n di\u1ec7n b\u1eb1ng c\u00e1ch g\u1eafn nh\u00e3n (label), ph\u00e2n nh\u00f3m t\u00e0i nguy\u00ean theo m\u00f4i tr\u01b0\u1eddng, s\u1eed d\u1ee5ng Cloud Billing Export k\u1ebft h\u1ee3p BigQuery + Looker Studio \u0111\u1ec3 theo d\u00f5i v\u00e0 c\u1ea3nh b\u00e1o.</p>"},{"location":"ADR/adr-015-cost-observability/#thanh-phan-chinh-cua-chien-luoc","title":"\ud83d\udcca Th\u00e0nh ph\u1ea7n ch\u00ednh c\u1ee7a chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-015-cost-observability/#1-gan-nhan-chi-phi-theo-moi-truong-va-module","title":"1. G\u1eafn nh\u00e3n chi ph\u00ed theo m\u00f4i tr\u01b0\u1eddng v\u00e0 module","text":"<ul> <li> <p>G\u1eafn label khi deploy Cloud Run, Redis, Secret Manager:</p> </li> <li> <p><code>env=dev|staging|prod</code></p> </li> <li><code>component=api-gateway</code></li> <li><code>application=api-gateway</code></li> <li><code>owner=dx-vas</code></li> <li>D\u00f9ng Terraform ho\u1eb7c GitHub Actions \u0111\u1ec3 enforce t\u1ef1 \u0111\u1ed9ng g\u1eafn label</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#2-export-billing-sang-bigquery","title":"2. Export Billing sang BigQuery","text":"<ul> <li>B\u1eadt Cloud Billing Export \u2192 BigQuery (daily ho\u1eb7c realtime)</li> <li>T\u1ea1o b\u1ea3ng <code>billing_dx_vas</code> theo format chu\u1ea9n c\u1ee7a Google Cloud</li> <li>K\u1ebft n\u1ed1i v\u1edbi Looker Studio ho\u1eb7c Data Studio \u0111\u1ec3 t\u1ea1o dashboard</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#3-dashboard-chi-phi-theo-chieu","title":"3. Dashboard chi ph\u00ed theo chi\u1ec1u:","text":"<ul> <li>Theo th\u1eddi gian (ng\u00e0y, tu\u1ea7n, th\u00e1ng)</li> <li>Theo m\u00f4i tr\u01b0\u1eddng: <code>dev</code>, <code>staging</code>, <code>prod</code></li> <li>Theo d\u1ecbch v\u1ee5: Cloud Run, Redis, Secret Manager, Logging...</li> <li>Theo endpoint (n\u1ebfu c\u00f3 usage-based pricing nh\u01b0 GPT API/Zalo...)</li> <li>Theo t\u00ednh n\u0103ng (feature): n\u1ebfu mapping \u0111\u01b0\u1ee3c request ho\u1eb7c resource v\u1edbi feature c\u1ee5 th\u1ec3 (d\u1ef1a tr\u00ean labeling ho\u1eb7c usage metadata)</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#4-alert-vuot-nguong-bat-thuong","title":"4. Alert v\u01b0\u1ee3t ng\u01b0\u1ee1ng b\u1ea5t th\u01b0\u1eddng","text":"<ul> <li> <p>C\u1ea3nh b\u00e1o qua Cloud Monitoring ho\u1eb7c Cloud Billing Budgets:</p> </li> <li> <p>Khi chi ph\u00ed t\u0103ng &gt; 30% so v\u1edbi tu\u1ea7n tr\u01b0\u1edbc</p> </li> <li>Khi v\u01b0\u1ee3t 70%, 90% budget theo th\u00e1ng</li> <li>G\u1eedi c\u1ea3nh b\u00e1o qua email + Slack (channel <code>#infra-alert</code>)</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#5-best-practice-kiem-soat-chi-phi","title":"5. Best practice &amp; ki\u1ec3m so\u00e1t chi ph\u00ed","text":"<ul> <li>D\u1ecdn log c\u0169: Logging retention gi\u1eef 30 ng\u00e0y (default), kh\u00f4ng gi\u1eef qu\u00e1 d\u00e0i n\u1ebfu kh\u00f4ng c\u1ea7n</li> <li><code>min-instances</code>: gi\u1eef h\u1ee3p l\u00fd \u0111\u1ec3 tr\u00e1nh cold start nh\u01b0ng kh\u00f4ng ti\u00eau t\u1ed1n t\u00e0i nguy\u00ean</li> <li>Logging/Tracing ch\u1ec9 b\u1eadt DEBUG \u1edf <code>dev</code>, b\u1eadt sampling \u1edf <code>staging</code></li> <li>Ki\u1ec3m so\u00e1t request outbound (Zalo/GPT) n\u1ebfu t\u00ednh ph\u00ed per-call</li> <li>Ch\u1ecdn \u0111\u00fang machine type/size cho Cloud Run instance (CPU/RAM) ph\u00f9 h\u1ee3p workload</li> <li>Review v\u00e0 x\u00f3a c\u00e1c t\u00e0i nguy\u00ean kh\u00f4ng s\u1eed d\u1ee5ng (unattached disk, old snapshots, idle services...)</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#6-trinh-bay-inh-ky-visibility","title":"6. Tr\u00ecnh b\u00e0y \u0111\u1ecbnh k\u1ef3 (visibility)","text":"<ul> <li>G\u1eedi b\u00e1o c\u00e1o chi ph\u00ed t\u1ef1 \u0111\u1ed9ng h\u00e0ng tu\u1ea7n cho Tech Lead &amp; CTO</li> <li>C\u00f3 dashboard th\u1eddi gian th\u1ef1c \u0111\u1ec3 theo d\u00f5i spike b\u1ea5t th\u01b0\u1eddng</li> <li>H\u1ecdp FinOps h\u00e0ng qu\u00fd \u0111\u1ec3 review chi ph\u00ed, c\u01a1 h\u1ed9i t\u1ed1i \u01b0u, v\u00e0 c\u1eadp nh\u1eadt ng\u01b0\u1ee1ng c\u1ea3nh b\u00e1o</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ch\u1ee7 \u0111\u1ed9ng ki\u1ec3m so\u00e1t ng\u00e2n s\u00e1ch v\u00e0 tr\u00e1nh s\u1ed1c chi ph\u00ed</li> <li>Ph\u00e2n t\u00edch chi ph\u00ed chi ti\u1ebft theo m\u00f4i tr\u01b0\u1eddng, th\u00e0nh ph\u1ea7n, t\u00ednh n\u0103ng</li> <li>T\u0103ng kh\u1ea3 n\u0103ng d\u1ef1 b\u00e1o t\u00e0i ch\u00ednh v\u00e0 b\u00e1o c\u00e1o k\u1ef9 thu\u1eadt minh b\u1ea1ch</li> <li>G\u1eafn li\u1ec1n DevOps \u2194 FinOps, h\u1ed7 tr\u1ee3 t\u1ed1i \u01b0u chi ph\u00ed k\u1ef9 thu\u1eadt chi\u1ebfn l\u01b0\u1ee3c</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p T\u00e0i nguy\u00ean b\u1ecb deploy thi\u1ebfu label Terraform enforce ho\u1eb7c validate CI/CD step Billing export delay \u1ea3nh h\u01b0\u1edfng c\u1ea3nh b\u00e1o K\u1ebft h\u1ee3p Cloud Billing Budgets + BigQuery refresh th\u01b0\u1eddng xuy\u00ean Developer kh\u00f4ng hi\u1ec3u dashboard chi ph\u00ed \u0110\u00e0o t\u1ea1o + ch\u00fa th\u00edch r\u00f5 filter <code>env</code>, <code>service</code>, <code>application</code>, <code>owner</code> trong dashboard"},{"location":"ADR/adr-015-cost-observability/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Theo d\u00f5i chi ph\u00ed th\u1ee7 c\u00f4ng t\u1eeb billing UI: Kh\u00f4ng chi ti\u1ebft theo m\u00f4i tr\u01b0\u1eddng / component</li> <li>Kh\u00f4ng c\u1ea3nh b\u00e1o chi ph\u00ed t\u0103ng \u0111\u1ed9t bi\u1ebfn: Nguy c\u01a1 v\u01b0\u1ee3t ng\u00e2n s\u00e1ch m\u00e0 kh\u00f4ng bi\u1ebft</li> <li>Kh\u00f4ng g\u1eafn label t\u00e0i nguy\u00ean: Kh\u00f4ng th\u1ec3 truy v\u1ebft chi ph\u00ed theo nh\u00f3m</li> </ul>"},{"location":"ADR/adr-015-cost-observability/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Terraform Label Enforcement: <code>infra/modules/labels.tf</code></li> <li>Dev Guide \u2013 FinOps: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-013-autoscaling-strategy.md</code></li> </ul> <p>\u201cB\u1ea1n kh\u00f4ng th\u1ec3 t\u1ed1i \u01b0u \u0111i\u1ec1u m\u00ecnh kh\u00f4ng \u0111o l\u01b0\u1eddng \u2013 chi ph\u00ed c\u0169ng c\u1ea7n observability nh\u01b0 h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-016-resilience-fallback-strategy/","title":"ADR-016: Chi\u1ebfn l\u01b0\u1ee3c Resilience v\u00e0 Fallback cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 30/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Tr\u1ea7n Qu\u1ed1c H (Backend Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 \u0111i\u1ec3m trung t\u00e2m \u0111i\u1ec1u ph\u1ed1i request t\u1eeb frontend \u0111\u1ebfn c\u00e1c backend nh\u01b0 SIS, CRM, LMS. M\u1ed9t s\u1ed1 backend c\u00f3 th\u1ec3 t\u1ea1m th\u1eddi ch\u1eadm, l\u1ed7i, ho\u1eb7c kh\u00f4ng s\u1eb5n s\u00e0ng. \u0110\u1ec3 duy tr\u00ec tr\u1ea3i nghi\u1ec7m ng\u01b0\u1eddi d\u00f9ng v\u00e0 \u0111\u1ed9 \u1ed5n \u0111\u1ecbnh h\u1ec7 th\u1ed1ng, c\u1ea7n x\u00e2y d\u1ef1ng chi\u1ebfn l\u01b0\u1ee3c resilience v\u00e0 fallback r\u00f5 r\u00e0ng t\u1ea1i gateway.</p>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c Resilience &amp; Fallback t\u1ea1i API Gateway v\u1edbi c\u00e1c k\u1ef9 thu\u1eadt: timeout, retry c\u00f3 ki\u1ec3m so\u00e1t, circuit breaker, v\u00e0 graceful fallback logic cho t\u1eebng nh\u00f3m API.</p>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#thanh-phan-cua-chien-luoc","title":"\ud83d\udee1 Th\u00e0nh ph\u1ea7n c\u1ee7a chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-016-resilience-fallback-strategy/#1-timeout-chuan-hoa","title":"1. Timeout chu\u1ea9n h\u00f3a","text":"<ul> <li> <p>\u00c1p d\u1ee5ng timeout t\u1ed1i \u0111a cho request outbound t\u1edbi backend (qua httpx):</p> </li> <li> <p><code>connect_timeout = 1s</code></p> </li> <li><code>read_timeout = 3s</code></li> <li>C\u00f3 th\u1ec3 override theo backend \u0111\u1eb7c bi\u1ec7t (v\u00ed d\u1ee5: CRM sync 5s)</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#2-retry-co-kiem-soat-idempotent-only","title":"2. Retry c\u00f3 ki\u1ec3m so\u00e1t (idempotent only)","text":"<ul> <li>\u00c1p d\u1ee5ng retry v\u1edbi method <code>GET</code>, <code>HEAD</code> n\u1ebfu l\u1ed7i l\u00e0 network error ho\u1eb7c 5xx (tr\u1eeb 501)</li> <li>S\u1eed d\u1ee5ng th\u01b0 vi\u1ec7n <code>tenacity</code> ho\u1eb7c logic retry t\u00edch h\u1ee3p trong httpx</li> <li>S\u1ed1 l\u1ea7n retry: t\u1ed1i \u0111a 2</li> <li>Delay gi\u1eefa l\u1ea7n retry: exponential backoff (e.g., 100ms, 300ms)</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#3-circuit-breaker-so-khoi","title":"3. Circuit Breaker (s\u01a1 kh\u1edfi)","text":"<ul> <li>N\u1ebfu 50% request t\u1edbi backend A l\u1ed7i trong v\u00f2ng 1 ph\u00fat \u2192 \u0111\u00f3ng circuit trong 2 ph\u00fat</li> <li>Trong th\u1eddi gian \u0111\u00f3ng: tr\u1ea3 l\u1ed7i fallback (503 + message chu\u1ea9n h\u00f3a)</li> <li>Sau th\u1eddi gian \u0111\u00f3: th\u1eed 1 request \u2192 n\u1ebfu th\u00e0nh c\u00f4ng \u2192 m\u1edf l\u1ea1i circuit</li> <li>C\u01a1 ch\u1ebf n\u00e0y \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n t\u1ea1m th\u1eddi qua Redis ho\u1eb7c memory (FastAPI middleware)</li> <li>H\u01b0\u1edbng n\u00e2ng c\u1ea5p: s\u1eed d\u1ee5ng th\u01b0 vi\u1ec7n nh\u01b0 <code>pybreaker</code> ho\u1eb7c d\u1ecbch v\u1ee5 chuy\u00ean bi\u1ec7t (Cloud Trace + metric-based circuit breaker) \u0111\u1ec3 h\u1ed7 tr\u1ee3 l\u01b0u tr\u1ea1ng th\u00e1i resilient theo v\u00f9ng/lifecycle container</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#4-graceful-fallback","title":"4. Graceful Fallback","text":"<ul> <li> <p>Cho m\u1ed9t s\u1ed1 API ph\u1ee5 tr\u1ee3 (non-critical), tr\u1ea3 v\u1ec1 d\u1eef li\u1ec7u default/cached n\u1ebfu backend l\u1ed7i:</p> </li> <li> <p>V\u00ed d\u1ee5: <code>/profile/avatar</code> \u2192 fallback URL \u1ea3nh m\u1eb7c \u0111\u1ecbnh</p> </li> <li><code>/recommendation</code> \u2192 tr\u1ea3 danh s\u00e1ch tr\u1ed1ng ho\u1eb7c th\u00f4ng b\u00e1o \"\u0110ang t\u1ea3i...\"</li> <li>Khi d\u00f9ng fallback/cached, c\u00f3 header <code>X-Fallback: true</code> v\u00e0 th\u00f4ng b\u00e1o r\u00f5 r\u00e0ng tr\u00ean giao di\u1ec7n ng\u01b0\u1eddi d\u00f9ng \u0111\u1ec3 minh b\u1ea1ch v\u00e0 gi\u1ea3m nh\u1ea7m l\u1eabn</li> <li>Kh\u00f4ng \u00e1p d\u1ee5ng fallback cho API c\u1eadp nh\u1eadt d\u1eef li\u1ec7u (PUT/POST quan tr\u1ecdng)</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#5-logging-metric","title":"5. Logging &amp; Metric","text":"<ul> <li>Log ri\u00eang khi retry, timeout, ho\u1eb7c circuit breaker \u0111\u01b0\u1ee3c k\u00edch ho\u1ea1t</li> <li> <p>Metric quan tr\u1ecdng:</p> </li> <li> <p><code>gateway_backend_latency_ms</code></p> </li> <li><code>gateway_backend_error_rate</code></li> <li><code>circuit_open_count</code></li> <li> <p>T\u00edch h\u1ee3p c\u1ea3nh b\u00e1o n\u1ebfu:</p> </li> <li> <p>Latency t\u0103ng &gt; 300% baseline</p> </li> <li>Circuit breaker k\u00edch ho\u1ea1t &gt; 5 l\u1ea7n/ph\u00fat</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#6-kiem-thu-resilience-tu-ong","title":"6. Ki\u1ec3m th\u1eed resilience t\u1ef1 \u0111\u1ed9ng","text":"<ul> <li>S\u1eed d\u1ee5ng <code>chaos testing</code> \u0111\u01a1n gi\u1ea3n v\u1edbi m\u00f4 ph\u1ecfng backend l\u1ed7i (return 503)</li> <li> <p>Ki\u1ec3m tra h\u1ec7 th\u1ed1ng c\u00f3:</p> </li> <li> <p>Tr\u1ea3 \u0111\u00fang fallback/error</p> </li> <li>Kh\u00f4ng retry qu\u00e1 gi\u1edbi h\u1ea1n</li> <li>Log \u0111\u1ee7 th\u00f4ng tin \u0111\u1ec3 debug</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Gi\u1ea3m downtime khi backend g\u1eb7p s\u1ef1 c\u1ed1</li> <li>B\u1ea3o v\u1ec7 ng\u01b0\u1eddi d\u00f9ng kh\u1ecfi l\u1ed7i lan r\u1ed9ng</li> <li>C\u1ea3i thi\u1ec7n hi\u1ec7u n\u0103ng t\u1ed5ng th\u1ec3 b\u1eb1ng c\u00e1ch gi\u1edbi h\u1ea1n retry qu\u00e1 m\u1ee9c</li> <li>D\u1ec5 quan s\u00e1t v\u00e0 ki\u1ec3m th\u1eed h\u00e0nh vi resilience qua log/metrics</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Circuit breaker k\u00edch ho\u1ea1t sai Tuning threshold h\u1ee3p l\u00fd + window sliding + test offline tr\u01b0\u1edbc Fallback kh\u00f4ng ph\u00f9 h\u1ee3p v\u1edbi business logic Ch\u1ec9 d\u00f9ng fallback cho endpoint r\u00f5 r\u00e0ng l\u00e0 non-critical v\u00e0 hi\u1ec3n th\u1ecb r\u00f5 v\u1edbi ng\u01b0\u1eddi d\u00f9ng Retry g\u00e2y qu\u00e1 t\u1ea3i backend \u00c1p d\u1ee5ng retry cho idempotent API + exponential backoff + gi\u1edbi h\u1ea1n t\u1ed1i \u0111a 2 l\u1ea7n"},{"location":"ADR/adr-016-resilience-fallback-strategy/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng retry ho\u1eb7c fallback: g\u00e2y l\u1ed7i to\u00e0n b\u1ed9 h\u1ec7 th\u1ed1ng frontend n\u1ebfu 1 backend g\u1eb7p s\u1ef1 c\u1ed1</li> <li>Retry t\u1ea5t c\u1ea3 method (POST/PUT): nguy c\u01a1 l\u1eb7p thao t\u00e1c, sai d\u1eef li\u1ec7u</li> <li>D\u00f9ng service mesh (Istio): qu\u00e1 ph\u1ee9c t\u1ea1p v\u1edbi ki\u1ebfn tr\u00fac Cloud Run hi\u1ec7n t\u1ea1i</li> </ul>"},{"location":"ADR/adr-016-resilience-fallback-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Middleware circuit breaker: <code>utils/circuit_breaker.py</code></li> <li>Dev Guide \u2013 Resilience &amp; Fault Tolerance: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-005-observability.md</code></li> </ul> <p>\u201cKh\u00f4ng h\u1ec7 th\u1ed1ng n\u00e0o tr\u00e1nh \u0111\u01b0\u1ee3c l\u1ed7i \u2013 resilience l\u00e0 c\u00e1ch ch\u00fang ta \u1ee9ng x\u1eed khi l\u1ed7i x\u1ea3y ra.\u201d</p>"},{"location":"ADR/adr-017-caching-strategy/","title":"ADR-017: Chi\u1ebfn l\u01b0\u1ee3c Caching cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 31/05/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Th\u1ecb T (Backend Architect)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway x\u1eed l\u00fd l\u01b0\u1ee3ng l\u1edbn request \u0111\u1ebfn c\u00e1c backend (SIS, CRM, LMS...). Nhi\u1ec1u endpoint c\u00f3 d\u1eef li\u1ec7u \u1ed5n \u0111\u1ecbnh trong th\u1eddi gian ng\u1eafn (profile, config, avatar, dropdown lists...). N\u1ebfu kh\u00f4ng c\u00f3 cache, h\u1ec7 th\u1ed1ng s\u1ebd:</p> <ul> <li>L\u00e3ng ph\u00ed t\u00e0i nguy\u00ean backend v\u1edbi request l\u1eb7p l\u1ea1i</li> <li>G\u00e2y \u0111\u1ed9 tr\u1ec5 kh\u00f4ng c\u1ea7n thi\u1ebft</li> <li>L\u00e0m gi\u1ea3m kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng c\u1ee7a to\u00e0n h\u1ec7 th\u1ed1ng</li> </ul> <p>C\u1ea7n c\u00f3 chi\u1ebfn l\u01b0\u1ee3c caching h\u1ee3p l\u00fd \u1edf gateway nh\u1eb1m t\u0103ng hi\u1ec7u su\u1ea5t v\u00e0 gi\u1ea3m t\u1ea3i.</p>"},{"location":"ADR/adr-017-caching-strategy/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c caching theo t\u1ea7ng t\u1ea1i API Gateway g\u1ed3m in-memory (short-term) v\u00e0 Redis (shared), k\u1ebft h\u1ee3p cache header chu\u1ea9n \u0111\u1ec3 t\u1eadn d\u1ee5ng CDN t\u01b0\u01a1ng lai.</p>"},{"location":"ADR/adr-017-caching-strategy/#thanh-phan-cua-chien-luoc","title":"\ud83d\udd27 Th\u00e0nh ph\u1ea7n c\u1ee7a chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-017-caching-strategy/#1-in-memory-cache-local-short-lived","title":"1. In-memory cache (local, short-lived)","text":"<ul> <li>D\u00f9ng <code>lru_cache</code> ho\u1eb7c <code>cachetools.TTLCache</code></li> <li> <p>D\u00e0nh cho c\u00e1c endpoint r\u1ea5t nh\u1eb9, d\u1eef li\u1ec7u kh\u00f4ng thay \u0111\u1ed5i th\u01b0\u1eddng xuy\u00ean:</p> </li> <li> <p><code>/config/options</code></p> </li> <li><code>/profile/avatar</code></li> <li>TTL: 30s\u201360s</li> <li>L\u01b0u \u00fd: Cloud Run c\u00f3 th\u1ec3 ch\u1ea1y nhi\u1ec1u instance \u2192 m\u1ed7i instance c\u00f3 cache ri\u00eang bi\u1ec7t \u2192 in-memory cache kh\u00f4ng \u0111\u1ed3ng b\u1ed9 gi\u1eefa c\u00e1c instance \u2192 ch\u1ea5p nh\u1eadn cache kh\u00f4ng nh\u1ea5t qu\u00e1n t\u1ea1m th\u1eddi \u0111\u1ec3 \u0111\u1ed5i l\u1ea5y t\u1ed1c \u0111\u1ed9 v\u00e0 gi\u1ea3m t\u1ea3i Redis</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#2-redis-cache-shared-medium-lived","title":"2. Redis cache (shared, medium-lived)","text":"<ul> <li> <p>D\u00e0nh cho c\u00e1c d\u1eef li\u1ec7u chia s\u1ebb gi\u1eefa nhi\u1ec1u instance:</p> </li> <li> <p><code>/user/profile</code></p> </li> <li><code>/school/calendar</code></li> <li>TTL: 5 ph\u00fat (tu\u1ef3 lo\u1ea1i)</li> <li>Key convention: <code>cache:{env}:{path}:{user_id}</code> ho\u1eb7c <code>cache:calendar:school_id</code></li> <li> <p>Cache invalidation:</p> </li> <li> <p>Khi c\u00f3 PUT/POST c\u1eadp nh\u1eadt, x\u00f3a key c\u1ee5 th\u1ec3 ho\u1eb7c theo pattern</p> </li> <li>C\u00f3 th\u1ec3 d\u00f9ng pub/sub c\u1ee7a Redis \u0111\u1ec3 c\u00e1c instance \u0111\u01b0\u1ee3c th\u00f4ng b\u00e1o v\u00e0 x\u00f3a cache local li\u00ean quan</li> <li>C\u1ea7n ph\u1ed1i h\u1ee3p logic \u0111\u1ec3 tr\u00e1nh race-condition gi\u1eefa cache v\u00e0 write-through</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#3-http-cache-header-chuan-cache-control","title":"3. HTTP cache header chu\u1ea9n (Cache-Control)","text":"<ul> <li>Tr\u1ea3 header <code>Cache-Control: public, max-age=60</code> cho endpoint ph\u00f9 h\u1ee3p</li> <li>H\u1ed7 tr\u1ee3 t\u01b0\u01a1ng lai t\u00edch h\u1ee3p CDN / API Gateway layer (Cloud CDN)</li> <li>Tu\u1ef3 theo <code>auth</code>/<code>public</code>, quy\u1ebft \u0111\u1ecbnh private/public cache \u0111\u01b0\u1ee3c hay kh\u00f4ng</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#4-cache-fallback-tuy-chon-resilience","title":"4. Cache fallback (t\u00f9y ch\u1ecdn resilience)","text":"<ul> <li>N\u1ebfu backend l\u1ed7i, c\u00f3 th\u1ec3 d\u00f9ng d\u1eef li\u1ec7u cache c\u0169 (expired nh\u01b0ng c\u00f2n usable)</li> <li>\u00c1p d\u1ee5ng cho d\u1eef li\u1ec7u kh\u00f4ng critical (v\u00ed d\u1ee5: avatar, menu)</li> <li>G\u1eafn header <code>X-Cache-Fallback: true</code> \u0111\u1ec3 frontend bi\u1ebft l\u00e0 d\u1eef li\u1ec7u kh\u00f4ng m\u1edbi nh\u1ea5t</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#5-bypass-cache-khi-can","title":"5. Bypass cache khi c\u1ea7n","text":"<ul> <li>Cho ph\u00e9p client g\u1eedi <code>Cache-Control: no-cache</code> ho\u1eb7c <code>X-Bypass-Cache: true</code></li> <li>H\u1eefu \u00edch khi admin c\u1ea7n force reload d\u1eef li\u1ec7u ho\u1eb7c debug</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#6-giam-hien-tuong-cache-stampede","title":"6. Gi\u1ea3m hi\u1ec7n t\u01b0\u1ee3ng cache stampede","text":"<ul> <li> <p>Khi nhi\u1ec1u request c\u00f9ng \u0111\u1ebfn key v\u1eeba h\u1ebft h\u1ea1n:</p> </li> <li> <p>D\u00f9ng lock nh\u1eb9 (Redis SETNX) \u0111\u1ec3 ch\u1ec9 cho 1 request refresh t\u1eeb backend</p> </li> <li> <p>C\u00e1c request kh\u00e1c c\u00f3 th\u1ec3:</p> <ul> <li>Ch\u1edd (spin lock, TTL timeout)</li> <li>Ho\u1eb7c d\u00f9ng l\u1ea1i gi\u00e1 tr\u1ecb cache c\u0169 th\u00eam 1\u20132s n\u1eefa n\u1ebfu c\u00f2n usable</li> <li>Chi\u1ebfn l\u01b0\u1ee3c n\u00e0y gi\u1ea3m nguy c\u01a1 backend b\u1ecb \u0111\u00e1nh h\u1ed9i \u0111\u1ed3ng do cache miss \u0111\u1ed3ng lo\u1ea1t</li> </ul> </li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#7-logging-va-metrics","title":"7. Logging v\u00e0 metrics","text":"<ul> <li>Ghi log <code>cache_hit</code>, <code>cache_miss</code>, <code>cache_expired</code></li> <li> <p>Metric:</p> </li> <li> <p><code>cache_hit_ratio</code></p> </li> <li><code>redis_cache_latency</code></li> <li><code>cache_fallback_count</code></li> <li> <p>Alert n\u1ebfu:</p> </li> <li> <p>Cache hit rate &lt; 60% trong 5 ph\u00fat</p> </li> <li>Redis latency &gt; 100ms</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Gi\u1ea3m t\u1ea3i \u0111\u00e1ng k\u1ec3 cho backend</li> <li>C\u1ea3i thi\u1ec7n t\u1ed1c \u0111\u1ed9 ph\u1ea3n h\u1ed3i cho user</li> <li>T\u0103ng kh\u1ea3 n\u0103ng ch\u1ecbu l\u1ed7i v\u00e0 \u1ed5n \u0111\u1ecbnh trong th\u1eddi gian backend gi\u00e1n \u0111o\u1ea1n</li> <li>Chu\u1ea9n b\u1ecb cho CDN/API caching n\u1ebfu scale l\u1edbn h\u01a1n</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Cache stale g\u00e2y nh\u1ea7m l\u1eabn ng\u01b0\u1eddi d\u00f9ng TTL ng\u1eafn + cho ph\u00e9p bypass + hi\u1ec3n th\u1ecb r\u00f5 fallback khi c\u00f3 D\u1eef li\u1ec7u private b\u1ecb cache sai Ph\u00e2n bi\u1ec7t cache theo user_id / scope r\u00f5 r\u00e0ng + kh\u00f4ng d\u00f9ng public cache n\u1ebfu c\u1ea7n auth Redis down \u2192 to\u00e0n b\u1ed9 cache m\u1ea5t Cho ph\u00e9p fallback in-memory + degrade m\u1ec1m n\u1ebfu c\u1ea7n Cache stampede khi cache h\u1ebft h\u1ea1n D\u00f9ng locking ho\u1eb7c grace window \u0111\u1ec3 gi\u1ea3m hi\u1ec7u \u1ee9ng herd"},{"location":"ADR/adr-017-caching-strategy/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng cache g\u00ec c\u1ea3: G\u00e2y qu\u00e1 t\u1ea3i backend, t\u0103ng \u0111\u1ed9 tr\u1ec5</li> <li>Ch\u1ec9 d\u00f9ng CDN layer (Cloud CDN): Kh\u00f4ng x\u1eed l\u00fd \u0111\u01b0\u1ee3c cache theo user_id ho\u1eb7c auth scope</li> <li>Cache to\u00e0n b\u1ed9 response m\u1ecdi th\u1ee9: D\u1ec5 g\u00e2y l\u1ed7i logic, stale data kh\u00f3 debug</li> </ul>"},{"location":"ADR/adr-017-caching-strategy/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Cache middleware: <code>utils/cache.py</code></li> <li>Dev Guide \u2013 Performance &amp; Caching: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-016-resilience-fallback-strategy.md</code></li> </ul> <p>\u201cCache t\u1ed1t kh\u00f4ng ch\u1ec9 gi\u00fap t\u0103ng t\u1ed1c \u2013 m\u00e0 c\u00f2n l\u00e0 m\u1ed9t l\u1edbp resilience cho h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-018-api-governance/","title":"ADR-018: Chi\u1ebfn l\u01b0\u1ee3c API Governance cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 01/06/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Minh Q (Tech Lead Backend)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-018-api-governance/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 \u0111i\u1ec3m truy c\u1eadp ch\u00ednh cho to\u00e0n b\u1ed9 frontend v\u00e0 third-party t\u00edch h\u1ee3p. Vi\u1ec7c ph\u00e1t tri\u1ec3n API m\u1edbi v\u00e0 duy tr\u00ec API c\u0169 c\u1ea7n c\u00f3 m\u1ed9t h\u1ec7 th\u1ed1ng governance r\u00f5 r\u00e0ng \u0111\u1ec3:</p> <ul> <li>\u0110\u1ea3m b\u1ea3o ch\u1ea5t l\u01b0\u1ee3ng v\u00e0 t\u00ednh nh\u1ea5t qu\u00e1n c\u1ee7a API</li> <li>D\u1ec5 d\u00e0ng m\u1edf r\u1ed9ng v\u00e0 duy tr\u00ec l\u00e2u d\u00e0i</li> <li>H\u1ea1n ch\u1ebf r\u1ee7i ro g\u00e2y l\u1ed7i khi nhi\u1ec1u team c\u00f9ng ph\u00e1t tri\u1ec3n</li> <li>\u0110\u1ea3m b\u1ea3o backward compatibility v\u00e0 t\u00e0i li\u1ec7u r\u00f5 r\u00e0ng</li> </ul>"},{"location":"ADR/adr-018-api-governance/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c API Governance chu\u1ea9n h\u00f3a d\u1ef1a tr\u00ean OpenAPI 3.1, k\u1ebft h\u1ee3p quy \u01b0\u1edbc \u0111\u1eb7t t\u00ean, ki\u1ec3m tra schema linting CI, versioning r\u00f5 r\u00e0ng, t\u1ef1 \u0111\u1ed9ng ho\u00e1 t\u00e0i li\u1ec7u v\u00e0 tu\u00e2n th\u1ee7 nguy\u00ean t\u1eafc thi\u1ebft k\u1ebf API hi\u1ec7n \u0111\u1ea1i.</p>"},{"location":"ADR/adr-018-api-governance/#thanh-phan-cua-chien-luoc","title":"\ud83d\udccf Th\u00e0nh ph\u1ea7n c\u1ee7a chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-018-api-governance/#1-su-dung-openapi-31-yaml","title":"1. S\u1eed d\u1ee5ng OpenAPI 3.1 (YAML)","text":"<ul> <li>M\u1ed7i module (auth, user, rbac...) c\u00f3 m\u1ed9t file schema OpenAPI ri\u00eang</li> <li>C\u00e1c schema ri\u00eang c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng <code>$ref</code> \u0111\u1ec3 li\u00ean k\u1ebft gi\u1eefa c\u00e1c ph\u1ea7n t\u1eed (components) ho\u1eb7c \u0111\u01b0\u1ee3c t\u1ed5ng h\u1ee3p l\u1ea1i b\u1eb1ng tool nh\u01b0 <code>redocly bundle</code> \u0111\u1ec3 t\u1ea1o schema to\u00e0n c\u1ee5c cho API Gateway</li> <li>T\u00edch h\u1ee3p v\u1edbi Swagger UI &amp; ReDoc t\u1eeb FastAPI <code>/docs</code>, <code>/redoc</code></li> <li>T\u1ef1 \u0111\u1ed9ng xu\u1ea5t ra t\u1eeb code (Pydantic model + route) v\u00e0 ch\u1ec9nh th\u1ee7 c\u00f4ng khi c\u1ea7n override</li> </ul>"},{"location":"ADR/adr-018-api-governance/#2-lint-validate-openapi-trong-ci","title":"2. Lint &amp; validate OpenAPI trong CI","text":"<ul> <li> <p>S\u1eed d\u1ee5ng <code>speccy</code>, <code>openapi-cli</code>, <code>redocly lint</code> ho\u1eb7c <code>oas-tools</code> \u0111\u1ec3 ki\u1ec3m tra:</p> </li> <li> <p>T\u00ean path, tag, description \u0111\u1ea7y \u0111\u1ee7</p> </li> <li>Thi\u1ebfu type, enum, example, status code</li> <li>Duplicate path ho\u1eb7c thi\u1ebfu version prefix</li> <li>H\u1ed7 tr\u1ee3 quy t\u1eafc linting tu\u1ef3 ch\u1ec9nh n\u1ed9i b\u1ed9 n\u1ebfu team c\u00f3 y\u00eau c\u1ea7u ri\u00eang (v\u00ed d\u1ee5: y\u00eau c\u1ea7u t\u1ea5t c\u1ea3 response \u0111\u1ec1u c\u00f3 <code>trace_id</code>)</li> <li>CI ch\u1eb7n merge n\u1ebfu c\u00f3 l\u1ed7i OpenAPI lint nghi\u00eam tr\u1ecdng</li> </ul>"},{"location":"ADR/adr-018-api-governance/#3-quy-uoc-at-ten-cau-truc","title":"3. Quy \u01b0\u1edbc \u0111\u1eb7t t\u00ean &amp; c\u1ea5u tr\u00fac","text":"<ul> <li> <p>Path d\u1ea1ng RESTful chu\u1ea9n:</p> </li> <li> <p><code>GET /students/{id}</code></p> </li> <li><code>POST /students</code></li> <li><code>GET /schools/{school_id}/classes</code></li> <li>\u0110\u1eb7t t\u00ean schema theo PascalCase: <code>StudentProfile</code>, <code>CreateTeacherRequest</code></li> <li>Enum r\u00f5 r\u00e0ng, type c\u1ee5 th\u1ec3, v\u00ed d\u1ee5:</li> </ul> <pre><code>status:\n  type: string\n  enum: [active, inactive, locked]\n</code></pre>"},{"location":"ADR/adr-018-api-governance/#4-versioning-api","title":"4. Versioning API","text":"<ul> <li>D\u00f9ng prefix <code>/api/v1/</code>, <code>/api/v2/</code></li> <li>Kh\u00f4ng thay \u0111\u1ed5i h\u00e0nh vi breaking trong c\u00f9ng 1 version</li> <li> <p>Khi n\u00e2ng version:</p> </li> <li> <p>T\u1ea1o route m\u1edbi song song (v2)</p> </li> <li>V2 c\u00f3 th\u1ec3 reuse schema nh\u01b0ng c\u1ea7n override l\u1ea1i OpenAPI description r\u00f5 r\u00e0ng</li> </ul>"},{"location":"ADR/adr-018-api-governance/#5-tu-ong-hoa-tai-lieu-changelog","title":"5. T\u1ef1 \u0111\u1ed9ng ho\u00e1 t\u00e0i li\u1ec7u &amp; changelog","text":"<ul> <li>S\u1eed d\u1ee5ng <code>redocly</code>, <code>docusaurus</code> ho\u1eb7c <code>sphinx</code> \u0111\u1ec3 publish API docs</li> <li>M\u1ed7i API schema thay \u0111\u1ed5i \u2192 update changelog.md (semi-auto script ho\u1eb7c git diff)</li> <li>C\u00f3 trang public ho\u1eb7c n\u1ed9i b\u1ed9 cho t\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt REST API</li> </ul>"},{"location":"ADR/adr-018-api-governance/#6-review-phe-duyet-schema","title":"6. Review &amp; ph\u00ea duy\u1ec7t schema","text":"<ul> <li>B\u1ea5t k\u1ef3 API m\u1edbi ho\u1eb7c thay \u0111\u1ed5i API \u0111\u1ec1u c\u1ea7n review b\u1edfi API Lead ho\u1eb7c Backend Tech Lead</li> <li> <p>Checklist review:</p> </li> <li> <p>RESTful design</p> </li> <li>T\u00ean chu\u1ea9n, status code h\u1ee3p l\u00fd</li> <li>Tr\u1ea3 l\u1ed7i \u0111\u00fang format (c\u00f3 message + code + trace_id)</li> <li>C\u00f3 m\u00f4 t\u1ea3 (<code>description</code>) v\u00e0 v\u00ed d\u1ee5 (<code>example</code>) trong response</li> </ul>"},{"location":"ADR/adr-018-api-governance/#7-api-design-principles-tham-chieu-tu-dev_guidemd","title":"7. API Design Principles (tham chi\u1ebfu t\u1eeb DEV_GUIDE.md)","text":"<ul> <li>Stateless: m\u1ed7i request ph\u1ea3i \u0111\u1ee7 th\u00f4ng tin \u0111\u1ec3 x\u1eed l\u00fd \u0111\u1ed9c l\u1eadp</li> <li>Idempotent: c\u00e1c method nh\u01b0 <code>PUT</code>, <code>DELETE</code> ph\u1ea3i idempotent</li> <li>S\u1eed d\u1ee5ng \u0111\u00fang HTTP verbs (GET, POST, PUT, DELETE...)</li> <li>H\u1ed7 tr\u1ee3 ph\u00e2n trang (<code>limit</code>, <code>offset</code>), l\u1ecdc (<code>filter[]</code>) v\u00e0 s\u1eafp x\u1ebfp (<code>sort_by</code>) theo quy \u01b0\u1edbc</li> <li>Tr\u1ea3 l\u1ed7i r\u00f5 r\u00e0ng v\u00e0 c\u00f3 chu\u1ea9n h\u00f3a JSON</li> </ul>"},{"location":"ADR/adr-018-api-governance/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>API r\u00f5 r\u00e0ng, d\u1ec5 hi\u1ec3u v\u00e0 d\u1ec5 duy tr\u00ec</li> <li>Gi\u1ea3m l\u1ed7i khi c\u00e1c team frontend/backend ph\u1ed1i h\u1ee3p</li> <li>Gi\u00fap d\u1ec5 d\u00e0ng m\u1edf r\u1ed9ng API trong t\u01b0\u01a1ng lai m\u00e0 kh\u00f4ng ph\u00e1 v\u1ee1 client c\u0169</li> <li>H\u1ed7 tr\u1ee3 frontend, mobile, b\u00ean th\u1ee9 ba t\u00edch h\u1ee3p API d\u1ec5 h\u01a1n</li> <li>T\u00e0i li\u1ec7u k\u1ef9 thu\u1eadt lu\u00f4n c\u1eadp nh\u1eadt, nh\u1ea5t qu\u00e1n v\u1edbi codebase</li> </ul>"},{"location":"ADR/adr-018-api-governance/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Schema kh\u00f4ng \u0111\u1ed3ng b\u1ed9 v\u1edbi code T\u1ef1 \u0111\u1ed9ng xu\u1ea5t OpenAPI t\u1eeb FastAPI + ki\u1ec3m tra CI API v\u1ee1 backward compatibility Ki\u1ec3m tra schema diff + version r\u00f5 r\u00e0ng + test t\u1ef1 \u0111\u1ed9ng contract Team ch\u01b0a quen governance Checklist, training, example schema + CI lint gi\u00fap enforce"},{"location":"ADR/adr-018-api-governance/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng versioning: D\u1eabn \u0111\u1ebfn breaking changes kh\u00f4ng ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c</li> <li>Vi\u1ebft t\u00e0i li\u1ec7u API b\u1eb1ng tay ho\u00e0n to\u00e0n: Kh\u00f4ng \u0111\u1ea3m b\u1ea3o sync v\u1edbi code, l\u1ed7i d\u1ec5 x\u1ea3y ra</li> <li>Kh\u00f4ng enforce lint/check OpenAPI: G\u00e2y l\u1ed7i khi ph\u00e1t h\u00e0nh ho\u1eb7c t\u00edch h\u1ee3p</li> </ul>"},{"location":"ADR/adr-018-api-governance/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>OpenAPI schema: <code>schemas/openapi/</code></li> <li>CI Linting: <code>.github/workflows/api-lint.yml</code></li> <li>Dev Guide \u2013 API Standards &amp; Design Principles: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-014-multi-env-config.md</code></li> </ul> <p>\u201cAPI kh\u00f4ng ch\u1ec9 l\u00e0 m\u1ed9t \u0111i\u1ec3m k\u1ebft n\u1ed1i \u2013 n\u00f3 l\u00e0 giao di\u1ec7n ch\u00ednh gi\u1eefa con ng\u01b0\u1eddi v\u00e0 h\u1ec7 th\u1ed1ng.\u201d</p>"},{"location":"ADR/adr-019-contract-testing/","title":"ADR-019: Chi\u1ebfn l\u01b0\u1ee3c Contract Testing cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 02/06/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Ng\u1ecdc L (Quality Engineering Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway c\u1ee7a DX VAS ph\u1ee5c v\u1ee5 nhi\u1ec1u frontend (web, mobile), c\u0169ng nh\u01b0 t\u00edch h\u1ee3p v\u1edbi b\u00ean th\u1ee9 ba. Khi backend ho\u1eb7c gateway thay \u0111\u1ed5i, c\u00f3 nguy c\u01a1 ph\u00e1 v\u1ee1 h\u1ee3p \u0111\u1ed3ng (contract) gi\u1eefa producer (backend) v\u00e0 consumer (client). V\u00ec v\u1eady, c\u1ea7n chi\u1ebfn l\u01b0\u1ee3c contract testing \u0111\u1ec3:</p> <ul> <li>\u0110\u1ea3m b\u1ea3o m\u1ecdi thay \u0111\u1ed5i v\u1eabn t\u01b0\u01a1ng th\u00edch v\u1edbi client \u0111\u00e3 t\u1ed3n t\u1ea1i</li> <li>Gi\u1ea3m l\u1ed7i t\u00edch h\u1ee3p kh\u00f3 debug</li> <li>T\u1ef1 tin tri\u1ec3n khai backend v\u00e0 gateway \u0111\u1ed9c l\u1eadp</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c contract testing d\u1ef1a tr\u00ean Pact cho c\u00e1c API n\u1ed9i b\u1ed9 v\u00e0 b\u00ean ngo\u00e0i, t\u00edch h\u1ee3p ki\u1ec3m tra t\u1ef1 \u0111\u1ed9ng trong CI/CD, \u0111\u1ed3ng b\u1ed9 v\u1edbi OpenAPI Schema.</p>"},{"location":"ADR/adr-019-contract-testing/#thanh-phan-chinh","title":"\ud83e\udd1d Th\u00e0nh ph\u1ea7n ch\u00ednh","text":""},{"location":"ADR/adr-019-contract-testing/#1-phan-vai-tro-contract","title":"1. Ph\u00e2n vai tr\u00f2 contract","text":"<ul> <li>Producer: API Gateway (ho\u1eb7c c\u00e1c backend service \u0111\u01b0\u1ee3c proxy qua)</li> <li>Consumer: Frontend app, mobile app, external integrators (CRM, Zalo...)</li> <li>Ng\u01b0\u1eddi ch\u1ecbu tr\u00e1ch nhi\u1ec7m t\u1ea1o contract test ph\u00eda consumer: team frontend ho\u1eb7c t\u00edch h\u1ee3p b\u00ean th\u1ee9 ba, theo h\u01b0\u1edbng d\u1eabn v\u00e0 checklist \u0111\u01b0\u1ee3c cung c\u1ea5p trong <code>DEV_GUIDE.md</code> ho\u1eb7c <code>CONTRIBUTING.md</code></li> </ul>"},{"location":"ADR/adr-019-contract-testing/#2-su-dung-pact-e-ghi-va-kiem-tra-contract","title":"2. S\u1eed d\u1ee5ng Pact \u0111\u1ec3 ghi v\u00e0 ki\u1ec3m tra contract","text":"<ul> <li>Frontend ghi l\u1ea1i pact file (expectations)</li> <li>Backend/Gateway verify c\u00e1c pact file \u0111\u00f3 (Pact Provider Verification)</li> <li>Pact file l\u01b0u trong repo (giai \u0111o\u1ea1n \u0111\u1ea7u) ho\u1eb7c publish l\u00ean Pact Broker (self-host ho\u1eb7c SaaS)</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#3-anh-xa-voi-openapi","title":"3. \u00c1nh x\u1ea1 v\u1edbi OpenAPI","text":"<ul> <li>Pact contract test t\u1eadp trung v\u00e0o t\u01b0\u01a1ng t\u00e1c c\u1ee5 th\u1ec3</li> <li>OpenAPI l\u00e0 \u0111\u1ecbnh ngh\u0129a to\u00e0n b\u1ed9 interface \u2192 sync \u0111\u1ecbnh k\u1ef3 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o alignment</li> <li>C\u00f3 th\u1ec3 d\u00f9ng <code>swagger-mock-validator</code> ho\u1eb7c <code>schemathesis</code> \u0111\u1ec3 ki\u1ec3m tra contract test c\u00f3 kh\u1edbp schema</li> <li>B\u01b0\u1edbc n\u00e0y \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n trong CI sau khi pact file \u0111\u01b0\u1ee3c t\u1ea1o, tr\u01b0\u1edbc b\u01b0\u1edbc provider verification \u0111\u1ec3 s\u1edbm ph\u00e1t hi\u1ec7n b\u1ea5t \u0111\u1ed3ng gi\u1eefa contract v\u00e0 schema chu\u1ea9n</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#4-tich-hop-cicd","title":"4. T\u00edch h\u1ee3p CI/CD","text":"<ul> <li>M\u1ed7i khi backend/gateway c\u1eadp nh\u1eadt \u2192 CI job th\u1ef1c thi verify contract t\u1eeb frontend</li> <li>N\u1ebfu fail \u2192 ch\u1eb7n merge / deploy</li> <li>C\u00e1c m\u00f4i tr\u01b0\u1eddng <code>dev</code>, <code>staging</code> \u0111\u01b0\u1ee3c verify v\u1edbi c\u00e1c b\u1ea3n pact g\u1ea7n nh\u1ea5t</li> <li>Pact broker d\u00f9ng tag theo version (v1.0.0, staging, prod) \u0111\u1ec3 ki\u1ec3m so\u00e1t v\u00f2ng \u0111\u1eddi contract</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#5-consumer-driven-contract","title":"5. Consumer-driven Contract","text":"<ul> <li>H\u1ed7 tr\u1ee3 frontend t\u1ea1o pact t\u1eeb test/unit ho\u1eb7c Postman \u2192 publish l\u00ean broker</li> <li>Backend/gateway verify l\u1ea1i expectation \u0111\u00f3 theo t\u1eebng release</li> <li>\u0110\u1ea3m b\u1ea3o backward compatibility ch\u1ee7 \u0111\u1ed9ng t\u1eeb consumer ph\u00eda client</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#6-to-chuc-repo-versioning","title":"6. T\u1ed5 ch\u1ee9c repo &amp; versioning","text":"<ul> <li>Pact files \u0111\u01b0\u1ee3c l\u01b0u ri\u00eang trong folder <code>/contracts</code></li> <li>\u0110\u1eb7t t\u00ean theo: <code>consumer-provider-version.json</code></li> <li>G\u1eafn version git hash / release tag \u0111\u1ec3 trace \u0111\u01b0\u1ee3c</li> <li>L\u01b0u \u00fd: khi s\u1ed1 l\u01b0\u1ee3ng consumer t\u0103ng, vi\u1ec7c l\u01b0u pact trong repo c\u00f3 th\u1ec3 g\u00e2y n\u1eb7ng \u2192 \u01b0u ti\u00ean n\u00e2ng c\u1ea5p l\u00ean Pact Broker \u0111\u1ec3 qu\u1ea3n l\u00fd hi\u1ec7u qu\u1ea3 h\u01a1n</li> <li>T\u1ef1 \u0111\u1ed9ng d\u1ecdn c\u00e1c pact file c\u0169 sau X ng\u00e0y n\u1ebfu kh\u00f4ng d\u00f9ng</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#7-trien-khai-ban-au","title":"7. Tri\u1ec3n khai ban \u0111\u1ea7u","text":"<ul> <li>\u00c1p d\u1ee5ng cho c\u00e1c module \u1ed5n \u0111\u1ecbnh tr\u01b0\u1edbc (auth, rbac, profile)</li> <li>L\u01b0u pact file trong Git repo (giai \u0111o\u1ea1n \u0111\u1ea7u)</li> <li>K\u1ebf ho\u1ea1ch n\u00e2ng c\u1ea5p l\u00ean Pact Broker (GCP VM ho\u1eb7c Docker hosted)</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Ph\u00e1t hi\u1ec7n s\u1edbm l\u1ed7i giao ti\u1ebfp gi\u1eefa frontend \u2194 backend</li> <li>D\u1ec5 CI/CD \u0111\u1ed9c l\u1eadp gi\u1eefa team m\u00e0 v\u1eabn \u0111\u1ea3m b\u1ea3o t\u01b0\u01a1ng th\u00edch</li> <li>R\u00fat ng\u1eafn th\u1eddi gian debug l\u1ed7i t\u00edch h\u1ee3p</li> <li>T\u0103ng \u0111\u1ed9 tin c\u1eady khi refactor ho\u1eb7c thay \u0111\u1ed5i schema backend</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Pact file l\u1ed7i th\u1eddi kh\u00f4ng ph\u1ea3n \u00e1nh client th\u1ef1c t\u1ebf \u0110\u1ed3ng b\u1ed9 t\u1eeb test th\u1eadt + h\u1ea1n s\u1eed d\u1ee5ng + cleanup t\u1ef1 \u0111\u1ed9ng Contract test gi\u1ea3 \u0111\u1ecbnh behavior kh\u00f4ng th\u1ef1c t\u1ebf T\u1ea1o pact t\u1eeb test th\u1eadt ho\u1eb7c Postman collection th\u1ef1c t\u1ebf Kh\u00f3 duy tr\u00ec khi c\u00f3 nhi\u1ec1u consumer T\u1ef1 \u0111\u1ed9ng ho\u00e1 broker + tagging + ph\u00e2n quy\u1ec1n truy c\u1eadp r\u00f5 r\u00e0ng"},{"location":"ADR/adr-019-contract-testing/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Ch\u1ec9 ki\u1ec3m tra schema (OpenAPI): Kh\u00f4ng ki\u1ec3m tra dynamic behavior / payload th\u1ef1c t\u1ebf</li> <li>Test end-to-end th\u1ee7 c\u00f4ng: M\u1ea5t th\u1eddi gian, kh\u00f3 scale</li> <li>Kh\u00f4ng test g\u00ec c\u1ea3: D\u1ec5 g\u00e2y l\u1ed7i breaking production</li> </ul>"},{"location":"ADR/adr-019-contract-testing/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Pact documentation: https://docs.pact.io/</li> <li>Folder contract: <code>/contracts</code></li> <li>CI: <code>.github/workflows/contract-test.yml</code></li> <li>ADR li\u00ean quan: <code>adr-018-api-governance.md</code></li> </ul> <p>\u201cContract l\u00e0 l\u1eddi h\u1ee9a gi\u1eefa c\u00e1c h\u1ec7 th\u1ed1ng \u2013 test \u0111\u1ec3 l\u1eddi h\u1ee9a kh\u00f4ng b\u1ecb ph\u00e1 v\u1ee1.\u201d</p>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/","title":"ADR-020: Chi\u1ebfn l\u01b0\u1ee3c API Lifecycle &amp; Deprecation cho API Gateway (DX VAS)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 03/06/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n V\u0103n D (API Governance Champion)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway \u0111\u00f3ng vai tr\u00f2 trung t\u00e2m t\u00edch h\u1ee3p v\u00e0 ph\u1ee5c v\u1ee5 c\u00e1c client n\u1ed9i b\u1ed9, frontend, mobile app, v\u00e0 b\u00ean th\u1ee9 ba. Khi h\u1ec7 th\u1ed1ng ph\u00e1t tri\u1ec3n, m\u1ed9t s\u1ed1 endpoint s\u1ebd c\u1ea7n \u0111\u01b0\u1ee3c:</p> <ul> <li>Th\u00eam m\u1edbi (v\u1edbi feature m\u1edbi)</li> <li>C\u1eadp nh\u1eadt (non-breaking ho\u1eb7c breaking)</li> <li>Ng\u1eebng s\u1eed d\u1ee5ng (deprecated)</li> </ul> <p>C\u1ea7n c\u00f3 m\u1ed9t chi\u1ebfn l\u01b0\u1ee3c r\u00f5 r\u00e0ng \u0111\u1ec3 qu\u1ea3n l\u00fd API Lifecycle gi\u00fap:</p> <ul> <li>Giao ti\u1ebfp nh\u1ea5t qu\u00e1n v\u1ec1 thay \u0111\u1ed5i v\u1edbi c\u00e1c b\u00ean s\u1eed d\u1ee5ng API</li> <li>\u0110\u1ea3m b\u1ea3o backward compatibility h\u1ee3p l\u00fd</li> <li>Tr\u00e1nh ph\u00e1 v\u1ee1 client \u0111ang d\u00f9ng version c\u0169</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng quy tr\u00ecnh qu\u1ea3n l\u00fd API lifecycle v\u1edbi c\u00e1c tr\u1ea1ng th\u00e1i r\u00f5 r\u00e0ng (experimental, stable, deprecated, retired), k\u1ebft h\u1ee3p v\u1edbi versioning, th\u1eddi gian c\u1ea3nh b\u00e1o deprecation r\u00f5 r\u00e0ng, v\u00e0 t\u00e0i li\u1ec7u c\u1eadp nh\u1eadt t\u1ef1 \u0111\u1ed9ng.</p>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#trang-thai-api-lifecycle","title":"\ud83d\udcd8 Tr\u1ea1ng th\u00e1i API Lifecycle","text":"Tr\u1ea1ng th\u00e1i M\u00f4 t\u1ea3 <code>experimental</code> API th\u1eed nghi\u1ec7m, c\u00f3 th\u1ec3 thay \u0111\u1ed5i, kh\u00f4ng khuy\u1ebfn ngh\u1ecb d\u00f9ng trong production <code>stable</code> API \u0111\u00e3 \u1ed5n \u0111\u1ecbnh, backward compatible trong c\u00f9ng major version <code>deprecated</code> API chu\u1ea9n b\u1ecb ng\u1eebng d\u00f9ng, c\u00f3 khuy\u1ebfn c\u00e1o thay th\u1ebf r\u00f5 r\u00e0ng <code>retired</code> API \u0111\u00e3 b\u1ecb xo\u00e1 ho\u00e0n to\u00e0n (tr\u1ea3 410 Gone ho\u1eb7c kh\u00f4ng c\u00f2n route) <ul> <li> <p>Tr\u1ea1ng th\u00e1i hi\u1ec3n th\u1ecb trong OpenAPI:</p> </li> <li> <p><code>deprecated: true</code> (chu\u1ea9n OpenAPI cho operation/parameter)</p> </li> <li><code>x-api-status: experimental|stable|retired</code> (custom extension cho tr\u1ea1ng th\u00e1i chi ti\u1ebft h\u01a1n)</li> <li>Swagger UI / ReDoc c\u00f3 th\u1ec3 hi\u1ec7n th\u1ecb c\u00e1c tr\u1ea1ng th\u00e1i \u0111\u1eb7c bi\u1ec7t b\u1eb1ng banner ho\u1eb7c highlight</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#quy-trinh-deprecate-api","title":"\ud83d\udd00 Quy tr\u00ecnh deprecate API","text":"<ol> <li>\u0110\u00e1nh d\u1ea5u <code>deprecated</code> trong OpenAPI + changelog</li> <li>Th\u00f4ng b\u00e1o qua changelog, Slack n\u1ed9i b\u1ed9, email \u0111\u1ed1i t\u00e1c</li> <li> <p>Th\u1eddi gian duy tr\u00ec (sunset):</p> </li> <li> <p>\u00cdt nh\u1ea5t 90 ng\u00e0y k\u1ec3 t\u1eeb ng\u00e0y deprecated</p> </li> <li>Tr\u1ea3 header HTTP:</li> </ol> <p><pre><code>Deprecation: true\nSunset: Tue, 10 Sep 2025 00:00:00 GMT\nLink: &lt;https://docs.dxvas.vn/api/v2/students&gt;; rel=\"successor-version\"\nWarning: 299 - \"API v1/students s\u1ebd b\u1ecb ng\u1eebng v\u00e0o ng\u00e0y 10/09/2025, vui l\u00f2ng chuy\u1ec3n sang v2\"\n</code></pre> 5. Sau khi h\u1ebft h\u1ea1n:</p> <ul> <li>C\u00f3 th\u1ec3 tr\u1ea3 <code>410 Gone</code> ho\u1eb7c redirect \u0111\u1ebfn endpoint m\u1edbi (n\u1ebfu ph\u00f9 h\u1ee3p)</li> <li>G\u1ee1 kh\u1ecfi docs public nh\u01b0ng v\u1eabn gi\u1eef changelog</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#ket-hop-versioning","title":"\ud83d\udcd0 K\u1ebft h\u1ee3p versioning","text":"<ul> <li>T\u1ea5t c\u1ea3 API \u0111\u1ec1u c\u00f3 prefix version: <code>/api/v1/</code>, <code>/api/v2/</code></li> <li>Khi c\u00f3 breaking change \u2192 t\u1ea1o version m\u1edbi (v2) song song</li> <li>Deprecate version c\u0169 sau khi client \u0111\u00e3 n\u00e2ng c\u1ea5p \u1ed5n \u0111\u1ecbnh</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#tai-lieu-va-thong-bao","title":"\ud83d\udcda T\u00e0i li\u1ec7u v\u00e0 th\u00f4ng b\u00e1o","text":"<ul> <li>T\u1ef1 \u0111\u1ed9ng t\u1ea1o changelog t\u1eeb Git diff ho\u1eb7c OpenAPI commit message</li> <li>C\u00f3 <code>/changelog.md</code> v\u00e0 <code>/api/lifecycle.json</code> m\u00f4 t\u1ea3 tr\u1ea1ng th\u00e1i theo th\u1eddi gian</li> <li>Trang <code>/docs/deprecation</code> li\u1ec7t k\u00ea API s\u1eafp b\u1ecb g\u1ee1</li> <li>G\u1eedi th\u00f4ng b\u00e1o deprecation \u0111\u1ecbnh k\u1ef3 (email, Slack #api-client)</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Giao ti\u1ebfp r\u00f5 r\u00e0ng, tr\u00e1nh ph\u00e1 v\u1ee1 h\u1ec7 th\u1ed1ng client \u0111ang ho\u1ea1t \u0111\u1ed9ng</li> <li>Qu\u1ea3n l\u00fd version hi\u1ec7u qu\u1ea3, \u0111\u1ed3ng h\u00e0nh c\u00f9ng ph\u00e1t tri\u1ec3n s\u1ea3n ph\u1ea9m</li> <li>H\u1ea1n ch\u1ebf technical debt t\u1eeb API \"ma\" ho\u1eb7c kh\u00f4ng c\u00f2n duy tr\u00ec</li> <li>H\u1ed7 tr\u1ee3 audit, compliance v\u00e0 c\u1eadp nh\u1eadt t\u00e0i li\u1ec7u t\u1ef1 \u0111\u1ed9ng</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Client kh\u00f4ng bi\u1ebft API b\u1ecb deprecated G\u1eedi email + Slack + log warning + header HTTP r\u00f5 r\u00e0ng Team backend g\u1ee1 nh\u1ea7m API c\u00f2n \u0111ang d\u00f9ng API kh\u00f4ng \u0111\u01b0\u1ee3c retire n\u1ebfu ch\u01b0a h\u1ebft <code>sunset window</code> + th\u1ed1ng k\u00ea usage qua Cloud Logging/Monitoring, xu\u1ea5t log request theo path \u2192 alert n\u1ebfu c\u00f3 request sau ng\u00e0y sunset Kh\u00f4ng ki\u1ec3m so\u00e1t \u0111\u01b0\u1ee3c API \"\u1ea9n\" trong code Review OpenAPI + CI fail n\u1ebfu c\u00f3 route kh\u00f4ng khai b\u00e1o + x\u00f3a stale route"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng versioning: d\u1ec5 breaking client, kh\u00f4ng rollback \u0111\u01b0\u1ee3c</li> <li>Xo\u00e1 API m\u00e0 kh\u00f4ng c\u1ea3nh b\u00e1o: g\u00e2y outage cho client</li> <li>Ch\u1ec9 vi\u1ebft deprecation trong changelog: kh\u00f4ng \u0111\u1ee7 visibility cho frontend / mobile / \u0111\u1ed1i t\u00e1c</li> </ul>"},{"location":"ADR/adr-020-api-lifecycle-deprecation/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Changelog: <code>/docs/changelog.md</code></li> <li>API Lifecycle JSON: <code>/api/lifecycle.json</code></li> <li>Dev Guide \u2013 API Versioning &amp; Deprecation: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-018-api-governance.md</code></li> </ul> <p>\u201cKh\u00f4ng ph\u1ea3i API n\u00e0o c\u0169ng s\u1ed1ng m\u00e3i \u2013 h\u00e3y qu\u1ea3n l\u00fd v\u00f2ng \u0111\u1eddi API nh\u01b0 m\u1ed9t c\u00f4ng d\u00e2n c\u00f3 tr\u00e1ch nhi\u1ec7m.\u201d</p>"},{"location":"ADR/adr-021-zero-downtime-deployment/","title":"ADR-021: Zero-Downtime Deployment for APIs (Tri\u1ec3n khai kh\u00f4ng gi\u00e1n \u0111o\u1ea1n)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 04/06/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Tr\u1ea7n Quang H (DevOps Lead)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway l\u00e0 tuy\u1ebfn \u0111\u1ea7u x\u1eed l\u00fd to\u00e0n b\u1ed9 request t\u1eeb client (web, mobile, partner). Vi\u1ec7c deploy phi\u00ean b\u1ea3n m\u1edbi (gateway, route logic, auth middleware...) kh\u00f4ng \u0111\u01b0\u1ee3c ph\u00e9p g\u00e2y downtime, v\u00ec s\u1ebd \u1ea3nh h\u01b0\u1edfng ngay \u0111\u1ebfn ng\u01b0\u1eddi d\u00f9ng. M\u1ed9t s\u1ed1 deployment c\u0169ng y\u00eau c\u1ea7u n\u00e2ng c\u1ea5p schema, ch\u1ec9nh s\u1eeda logic header, ho\u1eb7c c\u1eadp nh\u1eadt OpenAPI m\u00e0 kh\u00f4ng ph\u00e1 v\u1ee1 k\u1ebft n\u1ed1i \u0111ang t\u1ed3n t\u1ea1i.</p>"},{"location":"ADR/adr-021-zero-downtime-deployment/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c tri\u1ec3n khai kh\u00f4ng gi\u00e1n \u0111o\u1ea1n (Zero-Downtime Deployment) d\u1ef1a tr\u00ean Cloud Run revisions, canary rollout theo traffic splitting, backward compatibility, v\u00e0 ki\u1ec3m tra t\u1ef1 \u0111\u1ed9ng tr\u01b0\u1edbc/sau deploy.</p>"},{"location":"ADR/adr-021-zero-downtime-deployment/#thanh-phan-cua-chien-luoc","title":"\u2699\ufe0f Th\u00e0nh ph\u1ea7n c\u1ee7a chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-021-zero-downtime-deployment/#1-canary-rollout-bang-cloud-run-traffic-splitting","title":"1. Canary rollout b\u1eb1ng Cloud Run traffic splitting","text":"<ul> <li>M\u1ed7i deploy t\u1ea1o 1 revision m\u1edbi</li> <li> <p>Rollout theo giai \u0111o\u1ea1n:</p> </li> <li> <p>5% traffic trong 3 ph\u00fat \u2192 25% \u2192 100% n\u1ebfu kh\u00f4ng c\u00f3 l\u1ed7i</p> </li> <li>D\u00f9ng GitHub Actions + gcloud CLI \u0111\u1ec3 ki\u1ec3m so\u00e1t rollout</li> <li>C\u00f3 th\u1ec3 rollback nhanh v\u1ec1 revision c\u0169 ch\u1ec9 v\u1edbi 1 l\u1ec7nh CLI (gcloud) ho\u1eb7c qua UI Console</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#2-backward-compatibility","title":"2. Backward Compatibility","text":"<ul> <li>Kh\u00f4ng deploy breaking change n\u1ebfu ch\u01b0a c\u00f3 version m\u1edbi (/v2)</li> <li>Middleware m\u1edbi, logic auth, header m\u1edbi ph\u1ea3i kh\u00f4ng thay \u0111\u1ed5i h\u00e0nh vi cho client hi\u1ec7n t\u1ea1i</li> <li>N\u1ebfu c\u1ea7n thay \u0111\u1ed5i schema \u2192 \u0111\u00e1nh d\u1ea5u optional ho\u1eb7c gi\u1edbi thi\u1ec7u field m\u1edbi qua versioned model</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#3-sticky-traffic-long-lived-connections","title":"3. Sticky traffic &amp; long-lived connections","text":"<ul> <li>Tr\u00e1nh thay \u0111\u1ed5i c\u1ea5u tr\u00fac header ho\u1eb7c token \u0111\u1ed9t ng\u1ed9t gi\u1eefa c\u00e1c revision</li> <li>Cho ph\u00e9p request c\u0169 (ch\u01b0a c\u00f3 header m\u1edbi) ho\u1ea1t \u0111\u1ed9ng song song</li> <li>Cloud Run h\u1ed7 tr\u1ee3 x\u1eed l\u00fd graceful shutdown: gi\u1eef c\u00e1c HTTP keep-alive ho\u1eb7c long-polling connection \u0111ang m\u1edf tr\u00ean revision c\u0169 cho \u0111\u1ebfn khi k\u1ebft th\u00fac</li> <li>N\u1ebfu d\u00f9ng gRPC: \u0111\u1ea3m b\u1ea3o client c\u00f3 retry logic v\u00e0 reconnect timeout ph\u00f9 h\u1ee3p</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#4-database-migration-khong-blocking","title":"4. Database migration kh\u00f4ng blocking","text":"<ul> <li>Kh\u00f4ng th\u1ef1c hi\u1ec7n destructive migration \u0111\u1ed3ng th\u1eddi v\u1edbi deploy</li> <li> <p>\u00c1p d\u1ee5ng chi\u1ebfn l\u01b0\u1ee3c migration 2 b\u01b0\u1edbc:</p> </li> <li> <p>Add column m\u1edbi \u2192 deploy \u2192 migrate d\u1eef li\u1ec7u \u2192 xo\u00e1 ho\u1eb7c \u0111\u1ed5i schema sau (post-deploy)</p> </li> <li>S\u1eed d\u1ee5ng <code>alembic</code> \u0111\u1ec3 qu\u1ea3n l\u00fd migration theo version + CI ki\u1ec3m tra checksum</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#5-tu-ong-hoa-kiem-tra-truoc-va-sau-khi-deploy","title":"5. T\u1ef1 \u0111\u1ed9ng ho\u00e1 ki\u1ec3m tra tr\u01b0\u1edbc v\u00e0 sau khi deploy","text":"<ul> <li> <p>Tr\u01b0\u1edbc deploy:</p> </li> <li> <p>Ki\u1ec3m tra schema diff b\u1eb1ng <code>oasdiff</code> ho\u1eb7c <code>schemathesis diff</code></p> </li> <li>Contract testing (Pact) v\u1edbi c\u00e1c consumer hi\u1ec7n t\u1ea1i</li> <li> <p>Sau deploy:</p> </li> <li> <p>Gi\u00e1m s\u00e1t log error, circuit breaker, latency spike (Cloud Monitoring)</p> </li> <li>N\u1ebfu pass 100% \u2192 g\u1eedi Slack confirmation + \u0111\u00e1nh tag revision \u1ed5n \u0111\u1ecbnh</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#6-health-check-revision-warm-up","title":"6. Health check &amp; revision warm-up","text":"<ul> <li>D\u00f9ng endpoint <code>/healthz</code> (kh\u00f4ng ph\u1ee5 thu\u1ed9c DB) \u0111\u1ec3 x\u00e1c \u0111\u1ecbnh readiness</li> <li>G\u1ecdi warm-up request tr\u01b0\u1edbc rollout \u0111\u1ec3 cache schema/middleware/token verifier</li> <li>Cloud Run gi\u1eef min-instances &gt; 0 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o kh\u00f4ng cold-start khi switch revision</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#7-rollback-chien-luoc","title":"7. Rollback chi\u1ebfn l\u01b0\u1ee3c","text":"<ul> <li>M\u1ed7i deploy c\u00f3 tag c\u1ee5 th\u1ec3 (<code>deploy-20240604T0930-githash1234</code>)</li> <li> <p>N\u1ebfu c\u00f3 l\u1ed7i:</p> </li> <li> <p>Ch\u1ea1y: <code>gcloud run services update-traffic --to-revisions=rev_sha=100</code></p> </li> <li>H\u1ec7 th\u1ed1ng tr\u1edf l\u1ea1i revision \u1ed5n \u0111\u1ecbnh trong v\u00f2ng &lt; 30s, bao g\u1ed3m th\u1eddi gian ph\u00e1t hi\u1ec7n, x\u00e1c nh\u1eadn l\u1ed7i, v\u00e0 th\u1ef1c hi\u1ec7n rollback th\u1ee7 c\u00f4ng ho\u1eb7c t\u1eeb alert automation (Slack \u2192 Bot \u2192 CLI)</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Tr\u00e1nh downtime cho API critical</li> <li>Rollback nhanh v\u00e0 traceable</li> <li>Gi\u00e1m s\u00e1t v\u00e0 ki\u1ec3m so\u00e1t rollout r\u00f5 r\u00e0ng t\u1eebng revision</li> <li>T\u0103ng \u0111\u1ed9 tin c\u1eady khi tri\u1ec3n khai t\u00ednh n\u0103ng m\u1edbi, migration, ho\u1eb7c refactor l\u1edbn</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Breaking change ch\u01b0a versioned \u2192 l\u1ed7i client B\u1eaft bu\u1ed9c ki\u1ec3m tra schema diff + test contract tr\u01b0\u1edbc khi rollout L\u1ed7i logic nh\u01b0ng kh\u00f4ng fail request \u2192 rollout ti\u1ebfp t\u1ee5c T\u00edch h\u1ee3p metric + alert n\u1ebfu error rate b\u1ea5t th\u01b0\u1eddng d\u00f9 response l\u00e0 200 Cold start khi switch revision D\u00f9ng min-instances + warm-up logic \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o readiness"},{"location":"ADR/adr-021-zero-downtime-deployment/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Recreate service thay v\u00ec revision: g\u00e2y downtime, m\u1ea5t traceability</li> <li>Blue/Green b\u1eb1ng 2 service kh\u00e1c nhau: t\u0103ng chi ph\u00ed + kh\u00f3 qu\u1ea3n l\u00fd domain + IAM routing</li> <li>Kh\u00f4ng ki\u1ec3m tra g\u00ec tr\u01b0\u1edbc rollout 100%: t\u0103ng nguy c\u01a1 g\u00e2y outage cho production</li> </ul>"},{"location":"ADR/adr-021-zero-downtime-deployment/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Rollout GitHub Workflow: <code>.github/workflows/deploy.yml</code></li> <li>Canary Strategy Config: <code>infra/deploy/canary.yaml</code></li> <li>Dev Guide \u2013 Deployment &amp; Release: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-010-deployment-strategy.md</code></li> </ul> <p>\u201cTri\u1ec3n khai kh\u00f4ng gi\u00e1n \u0111o\u1ea1n kh\u00f4ng ph\u1ea3i l\u00e0 l\u1ef1a ch\u1ecdn xa x\u1ec9 \u2013 m\u00e0 l\u00e0 ti\u00eau chu\u1ea9n cho API hi\u1ec7n \u0111\u1ea1i.\u201d</p>"},{"location":"ADR/adr-022-observability-third-party/","title":"ADR-022: Observability cho t\u00edch h\u1ee3p b\u00ean th\u1ee9 ba (Third-Party Integrations)","text":"<ul> <li>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn \u2705</li> <li>Ng\u00e0y: 04/06/2025</li> <li>Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: Nguy\u1ec5n Thanh H (SRE + Partner Engineering)</li> <li>B\u1ed1i c\u1ea3nh: D\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#boi-canh","title":"\ud83d\udccc B\u1ed1i c\u1ea3nh","text":"<p>API Gateway c\u1ee7a DX VAS t\u00edch h\u1ee3p v\u1edbi nhi\u1ec1u b\u00ean th\u1ee9 ba nh\u01b0:</p> <ul> <li>Zalo Notification API</li> <li>Google OAuth</li> <li>CRM h\u1ec7 th\u1ed1ng \u0111\u1ed1i t\u00e1c</li> </ul> <p>Nh\u1eefng t\u00edch h\u1ee3p n\u00e0y n\u1eb1m ngo\u00e0i quy\u1ec1n ki\u1ec3m so\u00e1t tr\u1ef1c ti\u1ebfp c\u1ee7a \u0111\u1ed9i ng\u0169 DX, nh\u01b0ng c\u00f3 t\u00e1c \u0111\u1ed9ng quan tr\u1ecdng \u0111\u1ebfn tr\u1ea3i nghi\u1ec7m ng\u01b0\u1eddi d\u00f9ng. V\u00ec v\u1eady, c\u1ea7n c\u00f3 chi\u1ebfn l\u01b0\u1ee3c observability ri\u00eang cho third-party nh\u1eb1m:</p> <ul> <li>Gi\u00e1m s\u00e1t \u0111\u1ed9 tr\u1ec5, t\u1ea7n su\u1ea5t l\u1ed7i, th\u00f4ng l\u01b0\u1ee3ng</li> <li>Hi\u1ec3u \u0111\u01b0\u1ee3c l\u00fd do v\u00e0 ngu\u1ed3n l\u1ed7i (do \u0111\u1ed1i t\u00e1c, gateway hay timeout)</li> <li>Ph\u1ea3n \u1ee9ng k\u1ecbp th\u1eddi khi \u0111\u1ed1i t\u00e1c thay \u0111\u1ed5i API ho\u1eb7c c\u00f3 outage</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#quyet-inh","title":"\ud83e\udde0 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Thi\u1ebft l\u1eadp observability t\u1ea7ng t\u00edch h\u1ee3p b\u00ean th\u1ee9 ba qua centralized logging, metric chu\u1ea9n h\u00f3a, c\u1ea3nh b\u00e1o theo error rate + timeout, dashboard theo endpoint v\u00e0 health check ch\u1ee7 \u0111\u1ed9ng.</p>"},{"location":"ADR/adr-022-observability-third-party/#thanh-phan-chinh-cua-chien-luoc","title":"\ud83d\udd0d Th\u00e0nh ph\u1ea7n ch\u00ednh c\u1ee7a chi\u1ebfn l\u01b0\u1ee3c","text":""},{"location":"ADR/adr-022-observability-third-party/#1-logging-chuan-hoa-khi-goi-oi-tac","title":"1. Logging chu\u1ea9n ho\u00e1 khi g\u1ecdi \u0111\u1ed1i t\u00e1c","text":"<ul> <li> <p>M\u1ed7i request outbound t\u1edbi h\u1ec7 th\u1ed1ng b\u00ean th\u1ee9 ba s\u1ebd log:</p> </li> <li> <p>URL, method</p> </li> <li>Status code (c\u1ee7a \u0111\u1ed1i t\u00e1c)</li> <li>Error message (n\u1ebfu c\u00f3, ch\u1ec9 ghi ph\u1ea7n ng\u1eafn g\u1ecdn, kh\u00f4ng log to\u00e0n b\u1ed9 body \u0111\u1ec3 tr\u00e1nh l\u1ed9 th\u00f4ng tin nh\u1ea1y c\u1ea3m)</li> <li>Th\u1eddi gian th\u1ef1c thi (latency)</li> <li>request_id + trace_id</li> <li>M\u1eabu log chu\u1ea9n:</li> </ul> <pre><code>{\n  \"type\": \"third_party_call\",\n  \"partner\": \"zalo\",\n  \"url\": \"https://api.zalo.me/...\",\n  \"status\": 500,\n  \"latency_ms\": 1234,\n  \"error\": \"upstream timeout\",\n  \"request_id\": \"abc-xyz-123\"\n}\n</code></pre>"},{"location":"ADR/adr-022-observability-third-party/#2-metric-dashboard-theo-partner","title":"2. Metric &amp; Dashboard theo partner","text":"<ul> <li> <p>Metric g\u1eedi l\u00ean Cloud Monitoring:</p> </li> <li> <p><code>third_party_latency{partner=\"zalo\"}</code></p> </li> <li><code>third_party_error_rate{partner=\"crm\"}</code></li> <li><code>third_party_success_count{partner=\"oauth\"}</code></li> <li><code>third_party_5xx_count</code>, <code>third_party_4xx_count</code></li> <li> <p>C\u00f3 dashboard:</p> </li> <li> <p>T\u1ed5ng quan theo ng\u00e0y</p> </li> <li>Breakdown theo partner</li> <li>Alert channel ri\u00eang: <code>#infra-partner-alerts</code></li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#3-timeout-retry-rieng-cho-tung-partner","title":"3. Timeout &amp; Retry ri\u00eang cho t\u1eebng partner","text":"<ul> <li>Timeout default: 3s (ho\u1eb7c theo SLA \u0111\u1ed1i t\u00e1c c\u1ee5 th\u1ec3)</li> <li>Retry: ch\u1ec9 cho ph\u00e9p v\u1edbi GET/idempotent method</li> <li>S\u1eed d\u1ee5ng retry c\u00f3 backoff + circuit breaker n\u1ebfu partner l\u1ed7i li\u00ean t\u1ee5c</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#4-circuit-breaker-cho-ben-thu-ba","title":"4. Circuit Breaker cho b\u00ean th\u1ee9 ba","text":"<ul> <li> <p>N\u1ebfu 50% request l\u1ed7i trong 2 ph\u00fat:</p> </li> <li> <p>\u0110\u00f3ng circuit trong 5 ph\u00fat \u2192 tr\u1ea3 fallback ho\u1eb7c 503</p> </li> <li>Gi\u00fap b\u1ea3o v\u1ec7 h\u1ec7 th\u1ed1ng kh\u1ecfi cascade failure do \u0111\u1ed1i t\u00e1c g\u1eb7p s\u1ef1 c\u1ed1</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#5-canh-bao-phan-ung","title":"5. C\u1ea3nh b\u00e1o + ph\u1ea3n \u1ee9ng","text":"<ul> <li> <p>N\u1ebfu:</p> </li> <li> <p><code>error_rate &gt; 10%</code> trong 5 ph\u00fat</p> </li> <li><code>latency &gt; 1000ms</code> li\u00ean t\u1ee5c</li> <li> <p>Th\u00ec:</p> </li> <li> <p>G\u1eedi Slack + email alert</p> </li> <li>T\u1ea1m disable integration n\u1ebfu c\u00f3 switch/toggle (flags)</li> <li>Ghi issue \"Partner degraded\" trong h\u1ec7 th\u1ed1ng n\u1ed9i b\u1ed9</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#6-truy-xuat-trace-va-correlation-id","title":"6. Truy xu\u1ea5t (trace) v\u00e0 correlation ID","text":"<ul> <li>M\u1ed7i call \u0111i t\u1eeb user request \u2192 third-party \u0111\u1ec1u c\u00f3 <code>trace_id</code></li> <li>Cho ph\u00e9p truy v\u1ea5n log t\u1eeb ng\u01b0\u1eddi d\u00f9ng \u0111\u1ebfn l\u1ed7i b\u00ean ngo\u00e0i</li> <li>H\u1ed7 tr\u1ee3 debugging li\u00ean d\u1ecbch v\u1ee5 / li\u00ean h\u1ec7 v\u1edbi \u0111\u1ed1i t\u00e1c d\u1ec5 d\u00e0ng</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#7-health-check-chu-ong-voi-oi-tac-synthetic-probes","title":"7. Health Check ch\u1ee7 \u0111\u1ed9ng v\u1edbi \u0111\u1ed1i t\u00e1c (synthetic probes)","text":"<ul> <li>N\u1ebfu partner c\u00f3 endpoint <code>/health</code> ho\u1eb7c <code>/ping</code> \u2192 g\u1ecdi \u0111\u1ecbnh k\u1ef3 (1\u20135 ph\u00fat/l\u1ea7n)</li> <li>Log k\u1ebft qu\u1ea3 v\u00e0 g\u1eafn tag <code>synthetic_check=true</code></li> <li>C\u1ea3nh b\u00e1o s\u1edbm n\u1ebfu partner m\u1ea5t k\u1ebft n\u1ed1i ho\u1eb7c c\u00f3 l\u1ed7i tr\u01b0\u1edbc khi \u1ea3nh h\u01b0\u1edfng ng\u01b0\u1eddi d\u00f9ng th\u1eadt</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#loi-ich","title":"\u2705 L\u1ee3i \u00edch","text":"<ul> <li>Hi\u1ec3u r\u00f5 nguy\u00ean nh\u00e2n l\u1ed7i li\u00ean quan b\u00ean th\u1ee9 ba</li> <li>T\u0103ng kh\u1ea3 n\u0103ng ph\u00f2ng ng\u1eeba v\u00e0 ph\u1ea3n \u1ee9ng ch\u1ee7 \u0111\u1ed9ng</li> <li>B\u1ea3o v\u1ec7 backend n\u1ed9i b\u1ed9 kh\u1ecfi l\u1ed7i lan t\u1eeb d\u1ecbch v\u1ee5 b\u00ean ngo\u00e0i</li> <li>Gi\u00fap th\u1ed1ng k\u00ea SLA th\u1ef1c t\u1ebf c\u1ee7a t\u00edch h\u1ee3p external</li> <li>C\u00f3 th\u1ec3 ph\u00e1t hi\u1ec7n s\u1ef1 c\u1ed1 tr\u01b0\u1edbc khi ng\u01b0\u1eddi d\u00f9ng ph\u1ea3n \u00e1nh</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#rui-ro-giai-phap","title":"\u274c R\u1ee7i ro &amp; Gi\u1ea3i ph\u00e1p","text":"R\u1ee7i ro Gi\u1ea3i ph\u00e1p Ghi log qu\u00e1 chi ti\u1ebft g\u00e2y overload ho\u1eb7c r\u00f2 r\u1ec9 nh\u1ea1y c\u1ea3m Ch\u1ec9 log error ng\u1eafn g\u1ecdn, masking token, sampling success logs Sai timeout d\u1eabn \u0111\u1ebfn retry l\u1ed7i Tinh ch\u1ec9nh timeout ri\u00eang cho t\u1eebng partner d\u1ef1a tr\u00ean quan s\u00e1t th\u1ef1c t\u1ebf Kh\u00f4ng alert k\u1ecbp th\u1eddi khi partner down T\u00edch h\u1ee3p synthetic check + metric alert + check manual m\u1ed7i s\u00e1ng"},{"location":"ADR/adr-022-observability-third-party/#cac-lua-chon-a-loai-bo","title":"\ud83d\udd04 C\u00e1c l\u1ef1a ch\u1ecdn \u0111\u00e3 lo\u1ea1i b\u1ecf","text":"<ul> <li>Kh\u00f4ng log ri\u00eang cho call external: kh\u00f3 truy v\u1ea5n + kh\u00f4ng r\u00f5 nguy\u00ean nh\u00e2n l\u1ed7i</li> <li>Ch\u1ec9 d\u00f9ng metric chung (latency/error): kh\u00f4ng th\u1ec3 ph\u00e2n bi\u1ec7t l\u1ed7i do ai</li> <li>Lu\u00f4n retry m\u1ecdi call l\u1ed7i: g\u00e2y th\u1eaft c\u1ed5 chai v\u00e0 cascade failure</li> </ul>"},{"location":"ADR/adr-022-observability-third-party/#tai-lieu-lien-quan","title":"\ud83d\udcce T\u00e0i li\u1ec7u li\u00ean quan","text":"<ul> <li>Logging structure: <code>utils/logging_third_party.py</code></li> <li>Monitoring config: <code>infra/observability/third_party_alert.yaml</code></li> <li>Dev Guide \u2013 Partner Integration: <code>DEV_GUIDE.md</code></li> <li>ADR li\u00ean quan: <code>adr-005-observability.md</code></li> </ul> <p>\u201cT\u00edch h\u1ee3p b\u00ean ngo\u00e0i l\u00e0 m\u1eaft x\u00edch y\u1ebfu nh\u1ea5t \u2013 h\u00e3y \u0111o l\u01b0\u1eddng v\u00e0 b\u1ea3o v\u1ec7 n\u00f3 \u0111\u00fang c\u00e1ch.\u201d</p>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/","title":"ADR-023: H\u1ea1 t\u1ea7ng d\u01b0\u1edbi d\u1ea1ng m\u00e3 ngu\u1ed3n (IaC) \u2013 Chi\u1ebfn l\u01b0\u1ee3c d\u00f9ng Terraform","text":"<p>Tr\u1ea1ng th\u00e1i: \u0110\u00e3 ch\u1ea5p thu\u1eadn Ng\u00e0y: 2025-05-18 Ng\u01b0\u1eddi \u0111\u1ec1 xu\u1ea5t: DevOps Team \u2013 DX VAS</p>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#boi-canh","title":"\ud83c\udfaf B\u1ed1i c\u1ea3nh","text":"<p>H\u1ec7 th\u1ed1ng API Gateway v\u00e0 c\u00e1c d\u1ecbch v\u1ee5 li\u00ean quan c\u1ee7a d\u1ef1 \u00e1n Chuy\u1ec3n \u0111\u1ed5i s\u1ed1 VAS \u0111ang \u0111\u01b0\u1ee3c tri\u1ec3n khai tr\u00ean n\u1ec1n t\u1ea3ng Google Cloud Platform (GCP).</p> <p>Ch\u00fang t\u00f4i mu\u1ed1n \u0111\u1ea3m b\u1ea3o r\u1eb1ng vi\u1ec7c qu\u1ea3n l\u00fd h\u1ea1 t\u1ea7ng \u0111\u01b0\u1ee3c:</p> <ul> <li>L\u1eb7p l\u1ea1i \u0111\u01b0\u1ee3c (reproducible)</li> <li>D\u1ec5 theo d\u00f5i thay \u0111\u1ed5i (trackable in Git)</li> <li>T\u1ef1 \u0111\u1ed9ng h\u00f3a &amp; ki\u1ec3m th\u1eed \u0111\u01b0\u1ee3c (testable in CI/CD)</li> <li>Chia s\u1ebb d\u1ec5 d\u00e0ng gi\u1eefa c\u00e1c m\u00f4i tr\u01b0\u1eddng (staging/production)</li> </ul> <p>Hi\u1ec7n t\u1ea1i, h\u1ea1 t\u1ea7ng g\u1ed3m c\u00e1c th\u00e0nh ph\u1ea7n ch\u00ednh:</p> <ul> <li>Google Cloud Run (tri\u1ec3n khai container)</li> <li>Cloud SQL (PostgreSQL)</li> <li>Redis Instance (Memory Store)</li> <li>IAM Roles v\u00e0 Service Accounts</li> <li>Cloud Logging &amp; Monitoring</li> </ul>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#quyet-inh","title":"\ud83d\udca1 Quy\u1ebft \u0111\u1ecbnh","text":"<p>Ch\u00fang t\u00f4i quy\u1ebft \u0111\u1ecbnh s\u1eed d\u1ee5ng Terraform l\u00e0m c\u00f4ng c\u1ee5 ch\u00ednh cho qu\u1ea3n l\u00fd h\u1ea1 t\u1ea7ng, v\u1edbi c\u00e1c \u0111\u1eb7c \u0111i\u1ec3m sau:</p>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#cau-truc-thu-muc-terraform-e-xuat","title":"\ud83e\uddf1 C\u1ea5u tr\u00fac th\u01b0 m\u1ee5c Terraform \u0111\u1ec1 xu\u1ea5t","text":"<pre><code>infra/terraform/\n\u251c\u2500\u2500 modules/\n\u2502   \u251c\u2500\u2500 cloud_run_service/\n\u2502   \u251c\u2500\u2500 cloud_sql_instance/\n\u2502   \u251c\u2500\u2500 redis_instance/\n\u2502   \u251c\u2500\u2500 iam/\n\u2502   \u2514\u2500\u2500 monitoring/\n\u2502\n\u251c\u2500\u2500 envs/\n\u2502   \u251c\u2500\u2500 staging/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u251c\u2500\u2500 outputs.tf\n\u2502   \u2502   \u2514\u2500\u2500 staging.tfvars\n\u2502   \u2514\u2500\u2500 production/\n\u2502       \u251c\u2500\u2500 main.tf\n\u2502       \u251c\u2500\u2500 variables.tf\n\u2502       \u251c\u2500\u2500 outputs.tf\n\u2502       \u2514\u2500\u2500 production.tfvars\n\u2502\n\u251c\u2500\u2500 backend.tf  # c\u1ea5u h\u00ecnh backend chung ho\u1eb7c ri\u00eang cho t\u1eebng env\n\u2514\u2500\u2500 README.md   # h\u01b0\u1edbng d\u1eabn ch\u1ea1y v\u00e0 c\u1ea5u tr\u00fac\n</code></pre> <p>\ud83e\udde9 Modules gi\u00fap t\u00e1i s\u1eed d\u1ee5ng &amp; chu\u1ea9n h\u00f3a resource l\u1eb7p l\u1ea1i. M\u1ed7i m\u00f4i tr\u01b0\u1eddng staging/production ch\u1ec9 c\u1ea7n g\u1ecdi c\u00e1c module n\u00e0y v\u00e0 truy\u1ec1n bi\u1ebfn ph\u00f9 h\u1ee3p.</p>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#chien-luoc-su-dung","title":"\u2699\ufe0f Chi\u1ebfn l\u01b0\u1ee3c s\u1eed d\u1ee5ng","text":"<ul> <li>State file: l\u01b0u tr\u1eef tr\u00ean GCS bucket, b\u1eadt versioning v\u00e0 encryption</li> <li> <p>Environment separation:</p> </li> <li> <p>D\u00f9ng <code>envs/staging/</code> v\u00e0 <code>envs/production/</code> \u0111\u1ec3 t\u00e1ch to\u00e0n b\u1ed9 c\u1ea5u h\u00ecnh v\u00e0 state</p> </li> <li>M\u1ed7i env c\u00f3 th\u1ec3 c\u00f3 backend ri\u00eang ho\u1eb7c d\u00f9ng workspace n\u1ebfu mu\u1ed1n \u0111\u01a1n gi\u1ea3n h\u01a1n</li> <li>Secrets: kh\u00f4ng hardcode. \u0110\u01b0\u1ee3c inject qua CI/CD ho\u1eb7c t\u1eeb GCP Secrets Manager</li> <li>Terraform Cloud (n\u00e2ng cao): d\u00f9ng \u0111\u1ec3 enforce policy, approve production apply</li> </ul>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#uu-iem","title":"\u2705 \u01afu \u0111i\u1ec3m","text":"<ul> <li>D\u1ec5 d\u00e0ng nh\u00e2n b\u1ea3n m\u00f4i tr\u01b0\u1eddng m\u1edbi (test, staging)</li> <li>Review h\u1ea1 t\u1ea7ng nh\u01b0 review code</li> <li>Qu\u1ea3n l\u00fd lifecycle c\u1ee7a resource (t\u1ea1o, c\u1eadp nh\u1eadt, x\u00f3a)</li> <li>Chu\u1ea9n ho\u00e1 vi\u1ec7c g\u00e1n quy\u1ec1n IAM v\u00e0 b\u1ea3o m\u1eadt</li> <li>D\u1ec5 d\u00e0ng m\u1edf r\u1ed9ng v\u00e0 t\u00edch h\u1ee3p v\u1edbi h\u1ec7 th\u1ed1ng gi\u00e1m s\u00e1t (monitoring)</li> </ul>"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#cac-phuong-an-khac-a-can-nhac","title":"\ud83d\udd01 C\u00e1c ph\u01b0\u01a1ng \u00e1n kh\u00e1c \u0111\u00e3 c\u00e2n nh\u1eafc","text":"Gi\u1ea3i ph\u00e1p L\u00fd do kh\u00f4ng ch\u1ecdn GCP Console th\u1ee7 c\u00f4ng Kh\u00f4ng l\u1eb7p l\u1ea1i \u0111\u01b0\u1ee3c, d\u1ec5 sai l\u1ec7ch gi\u1eefa m\u00f4i tr\u01b0\u1eddng Google Cloud Deployment Manager \u00cdt ph\u1ed5 bi\u1ebfn, t\u00e0i li\u1ec7u h\u1ea1n ch\u1ebf h\u01a1n Terraform Pulumi M\u1ea1nh nh\u01b0ng c\u1ea7n h\u1ecdc th\u00eam TypeScript/Python SDK, \u00edt ph\u1ed5 bi\u1ebfn h\u01a1n trong team"},{"location":"ADR/adr-023-infrastructure-as-code-terraform-strategy/#hanh-ong-tiep-theo","title":"\ud83d\udccc H\u00e0nh \u0111\u1ed9ng ti\u1ebfp theo","text":"<ul> <li> Kh\u1edfi t\u1ea1o repo <code>infra/terraform/</code></li> <li> Thi\u1ebft l\u1eadp GCS bucket l\u00e0m remote state backend (ri\u00eang cho staging v\u00e0 production)</li> <li> Vi\u1ebft c\u00e1c module chu\u1ea9n h\u00f3a cho: Cloud Run, Cloud SQL, Redis, IAM, Monitoring</li> <li> Thi\u1ebft l\u1eadp m\u00f4i tr\u01b0\u1eddng <code>staging</code> v\u00e0 <code>production</code> trong th\u01b0 m\u1ee5c <code>envs/</code></li> <li> <p> Vi\u1ebft script CI/CD:</p> </li> <li> <p><code>terraform validate</code></p> </li> <li><code>terraform plan</code> + l\u01b0u file <code>.tfplan</code> d\u01b0\u1edbi d\u1ea1ng artifact</li> <li><code>terraform apply</code> t\u1ef1 \u0111\u1ed9ng cho staging, manual approval cho production</li> <li> \u00c1p d\u1ee5ng ch\u00ednh s\u00e1ch review b\u1eaft bu\u1ed9c tr\u01b0\u1edbc khi apply l\u00ean production</li> <li> (T\u00f9y ch\u1ecdn) T\u00edch h\u1ee3p Policy as Code (OPA) \u0111\u1ec3 enforce quy \u0111\u1ecbnh n\u1ed9i b\u1ed9 tr\u01b0\u1edbc khi apply</li> </ul> <p>Quy\u1ebft \u0111\u1ecbnh n\u00e0y gi\u00fap chu\u1ea9n ho\u00e1 h\u1ea1 t\u1ea7ng c\u1ee7a h\u1ec7 th\u1ed1ng, \u0111\u1ea3m b\u1ea3o an to\u00e0n \u2013 v\u00e0 quan tr\u1ecdng h\u01a1n, bi\u1ebfn n\u00f3 th\u00e0nh m\u1ed9t ph\u1ea7n c\u1ee7a quy tr\u00ecnh ph\u00e1t tri\u1ec3n ph\u1ea7n m\u1ec1m hi\u1ec7n \u0111\u1ea1i.</p>"},{"location":"OFFBOARDING_notes/template/","title":"\ud83d\udcdd OFFBOARDING NOTES TEMPLATE \u2013 DX VAS","text":"<p>S\u1eed d\u1ee5ng m\u1eabu n\u00e0y khi b\u1ea1n chu\u1ea9n b\u1ecb r\u1eddi d\u1ef1 \u00e1n. M\u1ee5c ti\u00eau l\u00e0 l\u01b0u l\u1ea1i tri th\u1ee9c, kinh nghi\u1ec7m c\u00e1 nh\u00e2n, gi\u00fap ng\u01b0\u1eddi ti\u1ebfp qu\u1ea3n c\u00f4ng vi\u1ec7c nhanh ch\u00f3ng v\u00e0 team c\u00f3 th\u1ec3 duy tr\u00ec ch\u1ea5t l\u01b0\u1ee3ng li\u00ean t\u1ee5c.</p>"},{"location":"OFFBOARDING_notes/template/#thong-tin-ca-nhan","title":"\ud83d\udc64 Th\u00f4ng tin c\u00e1 nh\u00e2n","text":"<ul> <li>H\u1ecd t\u00ean:</li> <li>Email li\u00ean h\u1ec7 (n\u1ebfu c\u1ea7n):</li> <li>Th\u1eddi gian tham gia d\u1ef1 \u00e1n: DD/MM/YYYY \u2013 DD/MM/YYYY</li> <li>V\u1ecb tr\u00ed/role:</li> </ul>"},{"location":"OFFBOARDING_notes/template/#cac-modulephan-viec-ban-a-phu-trach","title":"\ud83d\udce6 C\u00e1c module/ph\u1ea7n vi\u1ec7c b\u1ea1n \u0111\u00e3 ph\u1ee5 tr\u00e1ch","text":"Module Vai tr\u00f2 ch\u00ednh / M\u1ee9c \u0111\u1ed9 tham gia <code>auth</code> <code>rbac</code> <code>notify</code> CI/CD pipeline Cloud Run / GCP Docs / Dev Guide Kh\u00e1c"},{"location":"OFFBOARDING_notes/template/#ghi-chu-ky-thuat-quan-trong","title":"\ud83e\udde0 Ghi ch\u00fa k\u1ef9 thu\u1eadt quan tr\u1ecdng","text":"<ul> <li> <p>Contacts quan tr\u1ecdng (n\u1ebfu c\u00f3):</p> </li> <li> <p>T\u00ean, vai tr\u00f2, li\u00ean h\u1ec7 (email/Slack), li\u00ean quan \u0111\u1ebfn module n\u00e0o</p> </li> </ul>"},{"location":"OFFBOARDING_notes/template/#meo-debug-dev-local","title":"M\u1eb9o debug / dev local:","text":""},{"location":"OFFBOARDING_notes/template/#cac-servicescript-ac-biet-ban-a-viet-hoac-dung","title":"C\u00e1c service/script \u0111\u1eb7c bi\u1ec7t b\u1ea1n \u0111\u00e3 vi\u1ebft ho\u1eb7c d\u00f9ng:","text":""},{"location":"OFFBOARDING_notes/template/#luu-y-khi-deploy-config-ac-thu","title":"L\u01b0u \u00fd khi deploy / config \u0111\u1eb7c th\u00f9:","text":""},{"location":"OFFBOARDING_notes/template/#cam-bay-loi-thuong-gap","title":"C\u1ea1m b\u1eaby / l\u1ed7i th\u01b0\u1eddng g\u1eb7p:","text":""},{"location":"OFFBOARDING_notes/template/#cac-quyet-inh-thiet-ke-ban-tung-tham-gia-chua-co-trong-adr","title":"C\u00e1c quy\u1ebft \u0111\u1ecbnh thi\u1ebft k\u1ebf b\u1ea1n t\u1eebng tham gia (ch\u01b0a c\u00f3 trong ADR):","text":""},{"location":"OFFBOARDING_notes/template/#ban-giao-cong-viec","title":"\ud83d\uddc2 B\u00e0n giao c\u00f4ng vi\u1ec7c","text":"<ul> <li> <p>C\u00e1c nh\u00e1nh ch\u01b0a merge:</p> </li> <li> <p><code>feature/xxx</code>: m\u00f4 t\u1ea3 tr\u1ea1ng th\u00e1i, TODO, ai ti\u1ebfp qu\u1ea3n</p> </li> <li> <p>Issue c\u00f2n m\u1edf:</p> </li> <li> <p>Link \u0111\u1ebfn issue, g\u1ee3i \u00fd x\u1eed l\u00fd ti\u1ebfp theo</p> </li> <li> <p>T\u00e0i li\u1ec7u li\u00ean quan (ngo\u00e0i code):</p> </li> <li> <p>Google Docs, b\u1ea3n thi\u1ebft k\u1ebf, Gist, link n\u1ed9i b\u1ed9, v.v.</p> </li> <li> </li> </ul>"},{"location":"OFFBOARDING_notes/template/#filecode-can-chu-y-ac-biet","title":"File/code c\u1ea7n ch\u00fa \u00fd \u0111\u1eb7c bi\u1ec7t:","text":""},{"location":"OFFBOARDING_notes/template/#kien-thuc-chuyen-sau-deep-dives-neu-co","title":"\ud83e\udde0 Ki\u1ebfn th\u1ee9c chuy\u00ean s\u00e2u (Deep Dives \u2013 n\u1ebfu c\u00f3)","text":"<p>N\u1ebfu b\u1ea1n c\u00f3 hi\u1ec3u bi\u1ebft \u0111\u1eb7c bi\u1ec7t s\u00e2u v\u1ec1 m\u1ed9t ch\u1ee7 \u0111\u1ec1/module, h\u00e3y m\u00f4 t\u1ea3 th\u00eam ho\u1eb7c d\u1eabn link \u0111\u1ebfn t\u00e0i li\u1ec7u \u0111\u00e3 vi\u1ebft</p> <ul> <li>L\u0129nh v\u1ef1c:</li> <li>M\u00f4 t\u1ea3 / Link:</li> </ul>"},{"location":"OFFBOARDING_notes/template/#cong-cu-thu-vien-yeu-thich-ban-a-su-dung-trong-du-an","title":"\ud83d\udee0 C\u00f4ng c\u1ee5 / th\u01b0 vi\u1ec7n y\u00eau th\u00edch b\u1ea1n \u0111\u00e3 s\u1eed d\u1ee5ng trong d\u1ef1 \u00e1n","text":"<p>G\u1ee3i \u00fd nh\u1eefng c\u00f4ng c\u1ee5 \u0111\u00e1ng d\u00f9ng, c\u00f9ng l\u00fd do v\u00ec sao b\u1ea1n th\u1ea5y hi\u1ec7u qu\u1ea3</p> <ul> <li>T\u00ean c\u00f4ng c\u1ee5/th\u01b0 vi\u1ec7n:</li> <li>S\u1eed d\u1ee5ng \u1edf \u0111\u00e2u:</li> <li>L\u00fd do y\u00eau th\u00edch:</li> </ul>"},{"location":"OFFBOARDING_notes/template/#loi-nhan","title":"\u2764\ufe0f L\u1eddi nh\u1eafn","text":"<p>Vi\u1ebft \u0111i\u1ec1u b\u1ea1n mu\u1ed1n \u0111\u1ec3 l\u1ea1i cho team \u2013 c\u1ea3m \u01a1n, kh\u00edch l\u1ec7, ho\u1eb7c \u0111\u01a1n gi\u1ea3n l\u00e0 l\u1eddi ch\u00e0o th\u00e2n t\u00ecnh \u2728</p>"}]}